<!DOCTYPE html>  <html> <head>   <title>jquerypp.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="jquerypp.html">                 jquerypp.js               </a>                                           <a class="source" href="animate.html">                 animate.js               </a>                                           <a class="source" href="compare.html">                 compare.js               </a>                                           <a class="source" href="cookie.html">                 cookie.js               </a>                                           <a class="source" href="dimensions.html">                 dimensions.js               </a>                                           <a class="source" href="form_params.html">                 form_params.js               </a>                                           <a class="source" href="range.html">                 range.js               </a>                                           <a class="source" href="selection.html">                 selection.js               </a>                                           <a class="source" href="styles.html">                 styles.js               </a>                                           <a class="source" href="within.html">                 within.js               </a>                                           <a class="source" href="default.html">                 default.js               </a>                                           <a class="source" href="destroyed.html">                 destroyed.js               </a>                                           <a class="source" href="drag.html">                 drag.js               </a>                                           <a class="source" href="core.html">                 core.js               </a>                                           <a class="source" href="limit.html">                 limit.js               </a>                                           <a class="source" href="scroll.html">                 scroll.js               </a>                                           <a class="source" href="step.html">                 step.js               </a>                                           <a class="source" href="drop.html">                 drop.js               </a>                                           <a class="source" href="fastfix.html">                 fastfix.js               </a>                                           <a class="source" href="hover.html">                 hover.js               </a>                                           <a class="source" href="key.html">                 key.js               </a>                                           <a class="source" href="livehack.html">                 livehack.js               </a>                                           <a class="source" href="pause.html">                 pause.js               </a>                                           <a class="source" href="resize.html">                 resize.js               </a>                                           <a class="source" href="reverse.html">                 reverse.js               </a>                                           <a class="source" href="swipe.html">                 swipe.js               </a>                                           <a class="source" href="json.html">                 json.js               </a>                                           <a class="source" href="vector.html">                 vector.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               jquerypp.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nb">window</span><span class="p">,</span> <span class="nx">$</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h2>jquery/dom/styles/styles.js</h2>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">getComputedStyle</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">defaultView</span> <span class="o">&amp;&amp;</span> <span class="nb">document</span><span class="p">.</span><span class="nx">defaultView</span><span class="p">.</span><span class="nx">getComputedStyle</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>The following variables are used to convert camelcased attribute names
into dashed names, e.g. borderWidth to border-width</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">rupper</span> <span class="o">=</span> <span class="sr">/([A-Z])/g</span><span class="p">,</span>
    <span class="nx">rdashAlpha</span> <span class="o">=</span> <span class="sr">/-([a-z])/ig</span><span class="p">,</span>
    <span class="nx">fcamelCase</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">all</span><span class="p">,</span> <span class="nx">letter</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">letter</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">();</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Returns the computed style for an elementn</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">getStyle</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">elem</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">getComputedStyle</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">getComputedStyle</span><span class="p">(</span><span class="nx">elem</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">elem</span><span class="p">.</span><span class="nx">currentStyle</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">currentStyle</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Checks for float px and numeric values</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">rfloat</span> <span class="o">=</span> <span class="sr">/float/i</span><span class="p">,</span>
    <span class="nx">rnumpx</span> <span class="o">=</span> <span class="sr">/^-?\d+(?:px)?$/i</span><span class="p">,</span>
    <span class="nx">rnum</span> <span class="o">=</span> <span class="sr">/^-?\d/</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Returns a list of styles for a given element</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">$</span><span class="p">.</span><span class="nx">styles</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">styles</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">currentS</span> <span class="o">=</span> <span class="nx">getStyle</span><span class="p">(</span><span class="nx">el</span><span class="p">),</span>
      <span class="nx">oldName</span><span class="p">,</span> <span class="nx">val</span><span class="p">,</span> <span class="nx">style</span> <span class="o">=</span> <span class="nx">el</span><span class="p">.</span><span class="nx">style</span><span class="p">,</span>
      <span class="nx">results</span> <span class="o">=</span> <span class="p">{},</span>
      <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nx">left</span><span class="p">,</span> <span class="nx">rsLeft</span><span class="p">,</span> <span class="nx">camelCase</span><span class="p">,</span> <span class="nx">name</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Go through each style</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">for</span> <span class="p">(;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">styles</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">name</span> <span class="o">=</span> <span class="nx">styles</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="nx">oldName</span> <span class="o">=</span> <span class="nx">name</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">rdashAlpha</span><span class="p">,</span> <span class="nx">fcamelCase</span><span class="p">);</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">rfloat</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">name</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">name</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">support</span><span class="p">.</span><span class="nx">cssFloat</span> <span class="o">?</span> <span class="s2">&quot;float&quot;</span> <span class="o">:</span> <span class="s2">&quot;styleFloat&quot;</span><span class="p">;</span>
        <span class="nx">oldName</span> <span class="o">=</span> <span class="s2">&quot;cssFloat&quot;</span><span class="p">;</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>If we have getComputedStyle available</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">getComputedStyle</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>convert camelcased property names to dashed name</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">rupper</span><span class="p">,</span> <span class="s2">&quot;-$1&quot;</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>use getPropertyValue of the current style object</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">val</span> <span class="o">=</span> <span class="nx">currentS</span><span class="p">.</span><span class="nx">getPropertyValue</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>default opacity is 1</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">name</span> <span class="o">===</span> <span class="s2">&quot;opacity&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">val</span> <span class="o">===</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">val</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">results</span><span class="p">[</span><span class="nx">oldName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Without getComputedStyles</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">camelCase</span> <span class="o">=</span> <span class="nx">name</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">rdashAlpha</span><span class="p">,</span> <span class="nx">fcamelCase</span><span class="p">);</span>
        <span class="nx">results</span><span class="p">[</span><span class="nx">oldName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">currentS</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">||</span> <span class="nx">currentS</span><span class="p">[</span><span class="nx">camelCase</span><span class="p">];</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>convert to px</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">rnumpx</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">results</span><span class="p">[</span><span class="nx">oldName</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">rnum</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">results</span><span class="p">[</span><span class="nx">oldName</span><span class="p">]))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Remember the original values</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">left</span> <span class="o">=</span> <span class="nx">style</span><span class="p">.</span><span class="nx">left</span><span class="p">;</span>
          <span class="nx">rsLeft</span> <span class="o">=</span> <span class="nx">el</span><span class="p">.</span><span class="nx">runtimeStyle</span><span class="p">.</span><span class="nx">left</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Put in the new values to get a computed value out</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">el</span><span class="p">.</span><span class="nx">runtimeStyle</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="nx">el</span><span class="p">.</span><span class="nx">currentStyle</span><span class="p">.</span><span class="nx">left</span><span class="p">;</span>
          <span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="nx">camelCase</span> <span class="o">===</span> <span class="s2">&quot;fontSize&quot;</span> <span class="o">?</span> <span class="s2">&quot;1em&quot;</span> <span class="o">:</span> <span class="p">(</span><span class="nx">results</span><span class="p">[</span><span class="nx">oldName</span><span class="p">]</span> <span class="o">||</span> <span class="mi">0</span><span class="p">);</span>
          <span class="nx">results</span><span class="p">[</span><span class="nx">oldName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">style</span><span class="p">.</span><span class="nx">pixelLeft</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Revert the changed values</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="nx">left</span><span class="p">;</span>
          <span class="nx">el</span><span class="p">.</span><span class="nx">runtimeStyle</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="nx">rsLeft</span><span class="p">;</span>
        <span class="p">}</span>

      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">results</span><span class="p">;</span>
  <span class="p">};</span>


  <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">styles</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Pass the arguments as an array to $.styles</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="nx">$</span><span class="p">.</span><span class="nx">styles</span><span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">$</span><span class="p">.</span><span class="nx">makeArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">));</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <h2>jquery/dom/animate/animate.js</h2>

<p>Overwrites <code>jQuery.fn.animate</code> to use CSS 3 animations if possible</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>The global animation counter</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">animationNum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>The stylesheet for our animations</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">styleSheet</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>The animation cache</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">cache</span> <span class="o">=</span> <span class="p">[],</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Stores the browser properties like transition end event name and prefix</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">browser</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Store the original $.fn.animate</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">oldanimate</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">animate</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Return the stylesheet, create it if it doesn't exists</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">getStyleSheet</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">styleSheet</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">style</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;style&#39;</span><span class="p">);</span>
        <span class="nx">style</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;text/css&quot;</span><span class="p">);</span>
        <span class="nx">style</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&quot;media&quot;</span><span class="p">,</span> <span class="s2">&quot;screen&quot;</span><span class="p">);</span>

        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;head&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">style</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">window</span><span class="p">.</span><span class="nx">createPopup</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">style</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createTextNode</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">));</span>
        <span class="p">}</span>

        <span class="nx">styleSheet</span> <span class="o">=</span> <span class="nx">style</span><span class="p">.</span><span class="nx">sheet</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="nx">styleSheet</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>removes an animation rule from a sheet</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">removeAnimation</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">sheet</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="nx">sheet</span><span class="p">.</span><span class="nx">cssRules</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">rule</span> <span class="o">=</span> <span class="nx">sheet</span><span class="p">.</span><span class="nx">cssRules</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>7 means the keyframe rule</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">rule</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="mi">7</span> <span class="o">&amp;&amp;</span> <span class="nx">rule</span><span class="p">.</span><span class="nx">name</span> <span class="o">==</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">sheet</span><span class="p">.</span><span class="nx">deleteRule</span><span class="p">(</span><span class="nx">j</span><span class="p">)</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Returns whether the animation should be passed to the original $.fn.animate.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">passThrough</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">props</span><span class="p">,</span> <span class="nx">ops</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">nonElement</span> <span class="o">=</span> <span class="o">!</span><span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">nodeType</span><span class="p">),</span>
        <span class="nx">isInline</span> <span class="o">=</span> <span class="o">!</span><span class="nx">nonElement</span> <span class="o">&amp;&amp;</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;display&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;inline&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;none&quot;</span><span class="p">;</span>

      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">name</span> <span class="k">in</span> <span class="nx">props</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>jQuery does something with these values</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">props</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;show&#39;</span> <span class="o">||</span> <span class="nx">props</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;hide&#39;</span> <span class="o">||</span> <span class="nx">props</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;toggle&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>Arrays for individual easing</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="o">||</span> <span class="nx">$</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">props</span><span class="p">[</span><span class="nx">name</span><span class="p">])</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>Negative values not handled the same</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="o">||</span> <span class="nx">props</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>unit-less value</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="o">||</span> <span class="nx">name</span> <span class="o">==</span> <span class="s1">&#39;zIndex&#39;</span> <span class="o">||</span> <span class="nx">name</span> <span class="o">==</span> <span class="s1">&#39;z-index&#39;</span> <span class="o">||</span> <span class="nx">name</span> <span class="o">==</span> <span class="s1">&#39;scrollTop&#39;</span> <span class="o">||</span> <span class="nx">name</span> <span class="o">==</span> <span class="s1">&#39;scrollLeft&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="nx">props</span><span class="p">.</span><span class="nx">jquery</span> <span class="o">===</span> <span class="kc">true</span> <span class="o">||</span> <span class="nx">getBrowser</span><span class="p">()</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">||</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>Animating empty properties</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">$</span><span class="p">.</span><span class="nx">isEmptyObject</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="o">||</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>We can't do custom easing</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="p">(</span><span class="nx">ops</span> <span class="o">&amp;&amp;</span> <span class="nx">ops</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">ops</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">ops</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="o">||</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>Second parameter is an object - we can only handle primitives</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">$</span><span class="p">.</span><span class="nx">isPlainObject</span><span class="p">(</span><span class="nx">ops</span><span class="p">)</span> <span class="o">||</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>Inline and non elements</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">isInline</span> <span class="o">||</span> <span class="nx">nonElement</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>Gets a CSS number (with px added as the default unit if the value is a number)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">cssValue</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">origName</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">value</span> <span class="o">===</span> <span class="s2">&quot;number&quot;</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">$</span><span class="p">.</span><span class="nx">cssNumber</span><span class="p">[</span><span class="nx">origName</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">value</span> <span class="o">+=</span> <span class="s2">&quot;px&quot;</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>Feature detection borrowed by http://modernizr.com/</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">getBrowser</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">browser</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">t</span><span class="p">,</span> <span class="nx">el</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;fakeelement&#39;</span><span class="p">),</span>
          <span class="nx">transitions</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;transition&#39;</span><span class="o">:</span> <span class="p">{</span>
              <span class="nx">transitionEnd</span><span class="o">:</span> <span class="s1">&#39;transitionEnd&#39;</span><span class="p">,</span>
              <span class="nx">prefix</span><span class="o">:</span> <span class="s1">&#39;&#39;</span>
            <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <pre><code>                'OTransition': {
                    transitionEnd : 'oTransitionEnd',
                    prefix : '-o-'
                },
                'MSTransition': {
                    transitionEnd : 'msTransitionEnd',
                    prefix : '-ms-'
                },
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="s1">&#39;MozTransition&#39;</span><span class="o">:</span> <span class="p">{</span>
              <span class="nx">transitionEnd</span><span class="o">:</span> <span class="s1">&#39;animationend&#39;</span><span class="p">,</span>
              <span class="nx">prefix</span><span class="o">:</span> <span class="s1">&#39;-moz-&#39;</span>
            <span class="p">},</span>
            <span class="s1">&#39;WebkitTransition&#39;</span><span class="o">:</span> <span class="p">{</span>
              <span class="nx">transitionEnd</span><span class="o">:</span> <span class="s1">&#39;webkitAnimationEnd&#39;</span><span class="p">,</span>
              <span class="nx">prefix</span><span class="o">:</span> <span class="s1">&#39;-webkit-&#39;</span>
            <span class="p">}</span>
          <span class="p">}</span>

          <span class="k">for</span> <span class="p">(</span><span class="nx">t</span> <span class="k">in</span> <span class="nx">transitions</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">el</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="nx">t</span><span class="p">]</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">browser</span> <span class="o">=</span> <span class="nx">transitions</span><span class="p">[</span><span class="nx">t</span><span class="p">];</span>
            <span class="p">}</span>
          <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">browser</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>Properties that Firefox can't animate if set to 'auto':
https://bugzilla.mozilla.org/show_bug.cgi?id=571344
Provides a converter that returns the actual value</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">ffProps</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">top</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">el</span><span class="p">.</span><span class="nx">position</span><span class="p">().</span><span class="nx">top</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">left</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">el</span><span class="p">.</span><span class="nx">position</span><span class="p">().</span><span class="nx">left</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">width</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">el</span><span class="p">.</span><span class="nx">width</span><span class="p">();</span>
      <span class="p">},</span>
      <span class="nx">height</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">el</span><span class="p">.</span><span class="nx">height</span><span class="p">();</span>
      <span class="p">},</span>
      <span class="nx">fontSize</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;1em&#39;</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>Add browser specific prefix</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">addPrefix</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">properties</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">properties</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">result</span><span class="p">[</span><span class="nx">getBrowser</span><span class="p">().</span><span class="nx">prefix</span> <span class="o">+</span> <span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
      <span class="p">});</span>
      <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>Returns the animation name for a given style. It either uses a cached
version or adds it to the stylesheet, removing the oldest style if the
cache has reached a certain size.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">getAnimation</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">style</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">sheet</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">last</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>Look up the cached style, set it to that name and reset age if found
increment the age for any other animation</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">cache</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">animation</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">style</span> <span class="o">===</span> <span class="nx">animation</span><span class="p">.</span><span class="nx">style</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">name</span> <span class="o">=</span> <span class="nx">animation</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
          <span class="nx">animation</span><span class="p">.</span><span class="nx">age</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">animation</span><span class="p">.</span><span class="nx">age</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">});</span>

      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Add a new style</span>
        <span class="nx">sheet</span> <span class="o">=</span> <span class="nx">getStyleSheet</span><span class="p">();</span>
        <span class="nx">name</span> <span class="o">=</span> <span class="s2">&quot;jquerypp_animation_&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">animationNum</span><span class="o">++</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>get the last sheet and insert this rule into it</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">sheet</span><span class="p">.</span><span class="nx">insertRule</span><span class="p">(</span><span class="s2">&quot;@&quot;</span> <span class="o">+</span> <span class="nx">getBrowser</span><span class="p">().</span><span class="nx">prefix</span> <span class="o">+</span> <span class="s2">&quot;keyframes &quot;</span> <span class="o">+</span> <span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nx">style</span><span class="p">,</span> <span class="p">(</span><span class="nx">sheet</span><span class="p">.</span><span class="nx">cssRules</span> <span class="o">&amp;&amp;</span> <span class="nx">sheet</span><span class="p">.</span><span class="nx">cssRules</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">);</span>
        <span class="nx">cache</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
          <span class="nx">name</span><span class="o">:</span> <span class="nx">name</span><span class="p">,</span>
          <span class="nx">style</span><span class="o">:</span> <span class="nx">style</span><span class="p">,</span>
          <span class="nx">age</span><span class="o">:</span> <span class="mi">0</span>
        <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>Sort the cache by age</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">cache</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">first</span><span class="p">,</span> <span class="nx">second</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">first</span><span class="p">.</span><span class="nx">age</span> <span class="o">-</span> <span class="nx">second</span><span class="p">.</span><span class="nx">age</span><span class="p">;</span>
        <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>Remove the last (oldest) item from the cache if it has more than 20 items</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">cache</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">last</span> <span class="o">=</span> <span class="nx">cache</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
          <span class="nx">removeAnimation</span><span class="p">(</span><span class="nx">sheet</span><span class="p">,</span> <span class="nx">last</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="nx">name</span><span class="p">;</span>
    <span class="p">};</span>


  <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">animate</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">props</span><span class="p">,</span> <span class="nx">speed</span><span class="p">,</span> <span class="nx">easing</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>default to normal animations if browser doesn't support them</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">passThrough</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">oldanimate</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">optall</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">speed</span><span class="p">(</span><span class="nx">speed</span><span class="p">,</span> <span class="nx">easing</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>Add everything to the animation queue</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">queue</span><span class="p">(</span><span class="nx">optall</span><span class="p">.</span><span class="nx">queue</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>current CSS values</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">current</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>The list of properties passed</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">properties</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="nx">to</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="nx">prop</span><span class="p">,</span> <span class="nx">self</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">),</span>
        <span class="nx">duration</span> <span class="o">=</span> <span class="nx">optall</span><span class="p">.</span><span class="nx">duration</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>the animation keyframe name</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">animationName</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>The key used to store the animation hook</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">dataKey</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>the text for the keyframe</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">style</span> <span class="o">=</span> <span class="s2">&quot;{ from {&quot;</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>The animation end event handler.
Will be called both on animation end and after calling .stop()</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">animationEnd</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">currentCSS</span><span class="p">,</span> <span class="nx">exec</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">self</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="nx">currentCSS</span><span class="p">);</span>

          <span class="nx">self</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="nx">addPrefix</span><span class="p">({</span>
            <span class="s2">&quot;animation-duration&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;animation-name&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;animation-fill-mode&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;animation-play-state&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span>
          <span class="p">}));</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>Call the original callback</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">optall</span><span class="p">.</span><span class="nx">old</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">exec</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>Call success, pass the DOM element as the this reference</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">optall</span><span class="p">.</span><span class="nx">old</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">self</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">true</span><span class="p">)</span>
          <span class="p">}</span>

          <span class="nx">$</span><span class="p">.</span><span class="nx">removeData</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="nx">dataKey</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">finishAnimation</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>Call animationEnd using the passed properties</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">animationEnd</span><span class="p">(</span><span class="nx">props</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
          <span class="nx">done</span><span class="p">();</span>
        <span class="p">};</span>

      <span class="k">for</span> <span class="p">(</span><span class="nx">prop</span> <span class="k">in</span> <span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">properties</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">prop</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">getBrowser</span><span class="p">().</span><span class="nx">prefix</span> <span class="o">===</span> <span class="s1">&#39;-moz-&#39;</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>Normalize 'auto' properties in FF</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">properties</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">prop</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">converter</span> <span class="o">=</span> <span class="nx">ffProps</span><span class="p">[</span><span class="nx">$</span><span class="p">.</span><span class="nx">camelCase</span><span class="p">(</span><span class="nx">prop</span><span class="p">)];</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">converter</span> <span class="o">&amp;&amp;</span> <span class="nx">self</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="nx">prop</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="nx">prop</span><span class="p">,</span> <span class="nx">converter</span><span class="p">(</span><span class="nx">self</span><span class="p">));</span>
          <span class="p">}</span>
        <span class="p">});</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>Use $.styles</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">current</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">styles</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="nx">properties</span><span class="p">);</span>
      <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">properties</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">cur</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p>Convert a camelcased property name</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">cur</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/([A-Z]|^ms)/g</span><span class="p">,</span> <span class="s2">&quot;-$1&quot;</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">();</span>
        <span class="nx">style</span> <span class="o">+=</span> <span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot; : &quot;</span> <span class="o">+</span> <span class="nx">cssValue</span><span class="p">(</span><span class="nx">cur</span><span class="p">,</span> <span class="nx">current</span><span class="p">[</span><span class="nx">cur</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;; &quot;</span><span class="p">;</span>
        <span class="nx">to</span> <span class="o">+=</span> <span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot; : &quot;</span> <span class="o">+</span> <span class="nx">cssValue</span><span class="p">(</span><span class="nx">cur</span><span class="p">,</span> <span class="nx">props</span><span class="p">[</span><span class="nx">cur</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;; &quot;</span><span class="p">;</span>
      <span class="p">});</span>

      <span class="nx">style</span> <span class="o">+=</span> <span class="s2">&quot;} to {&quot;</span> <span class="o">+</span> <span class="nx">to</span> <span class="o">+</span> <span class="s2">&quot; }}&quot;</span><span class="p">;</span>

      <span class="nx">animationName</span> <span class="o">=</span> <span class="nx">getAnimation</span><span class="p">(</span><span class="nx">style</span><span class="p">);</span>
      <span class="nx">dataKey</span> <span class="o">=</span> <span class="nx">animationName</span> <span class="o">+</span> <span class="s1">&#39;.run&#39;</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p>Add a hook which will be called when the animation stops</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">$</span><span class="p">.</span><span class="nx">_data</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">dataKey</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">stop</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">gotoEnd</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p>Pause the animation</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">self</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="nx">addPrefix</span><span class="p">({</span>
            <span class="s1">&#39;animation-play-state&#39;</span><span class="o">:</span> <span class="s1">&#39;paused&#39;</span>
          <span class="p">}));</span></pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p>Unbind the animation end handler</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">self</span><span class="p">.</span><span class="nx">off</span><span class="p">(</span><span class="nx">getBrowser</span><span class="p">().</span><span class="nx">transitionEnd</span><span class="p">,</span> <span class="nx">finishAnimation</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">gotoEnd</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p>We were told not to finish the animation
Call animationEnd but set the CSS to the current computed style</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">animationEnd</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">styles</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="nx">properties</span><span class="p">),</span> <span class="kc">false</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p>Finish animaion</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">animationEnd</span><span class="p">(</span><span class="nx">props</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <p>set this element to point to that animation</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">self</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="nx">addPrefix</span><span class="p">({</span>
        <span class="s2">&quot;animation-duration&quot;</span><span class="o">:</span> <span class="nx">duration</span> <span class="o">+</span> <span class="s2">&quot;ms&quot;</span><span class="p">,</span>
        <span class="s2">&quot;animation-name&quot;</span><span class="o">:</span> <span class="nx">animationName</span><span class="p">,</span>
        <span class="s2">&quot;animation-fill-mode&quot;</span><span class="o">:</span> <span class="s2">&quot;forwards&quot;</span>
      <span class="p">}));</span></pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p>Attach the transition end event handler to run only once</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">self</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span><span class="nx">getBrowser</span><span class="p">().</span><span class="nx">transitionEnd</span><span class="p">,</span> <span class="nx">finishAnimation</span><span class="p">);</span>

    <span class="p">});</span>

    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <h2>jquery/dom/compare/compare.js</h2>

<p>See http://ejohn.org/blog/comparing-document-position/</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">compare</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//usually</span>
    <span class="k">try</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <p>Firefox 3 throws an error with XUL - we can't use compare then</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">element</span> <span class="o">=</span> <span class="nx">element</span><span class="p">.</span><span class="nx">jquery</span> <span class="o">?</span> <span class="nx">element</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">:</span> <span class="nx">element</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <p>make sure we aren't coming from XUL element</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">HTMLElement</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="nx">HTMLElement</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">s</span> <span class="o">==</span> <span class="s1">&#39;[xpconnect wrapped native prototype]&#39;</span> <span class="o">||</span> <span class="nx">s</span> <span class="o">==</span> <span class="s1">&#39;[object XULElement]&#39;</span> <span class="o">||</span> <span class="nx">s</span> <span class="o">===</span> <span class="s1">&#39;[object Window]&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">compareDocumentPosition</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <p>For browsers that support it, use compareDocumentPosition
https://developer.mozilla.org/en/DOM/Node.compareDocumentPosition</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">return</span> <span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">compareDocumentPosition</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <p>this[0] contains element</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="nb">document</span> <span class="o">&amp;&amp;</span> <span class="nx">element</span> <span class="o">!=</span> <span class="nb">document</span><span class="p">)</span> <span class="k">return</span> <span class="mi">8</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">number</span> <span class="o">=</span></pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>               <p>this[0] contains element</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!==</span> <span class="nx">element</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">contains</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span></pre></div>             </td>           </tr>                               <tr id="section-73">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-73">&#182;</a>               </div>               <p>element contains this[0]</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="nx">element</span> <span class="o">&amp;&amp;</span> <span class="nx">element</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="mi">8</span><span class="p">),</span>
      <span class="nx">docEl</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-74">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-74">&#182;</a>               </div>               <p>Use the sourceIndex</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">sourceIndex</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-75">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-75">&#182;</a>               </div>               <p>this[0] precedes element</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">number</span> <span class="o">+=</span> <span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">sourceIndex</span> <span class="o">&lt;</span> <span class="nx">element</span><span class="p">.</span><span class="nx">sourceIndex</span> <span class="o">&amp;&amp;</span> <span class="mi">4</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-76">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-76">&#182;</a>               </div>               <p>element precedes foo[0]</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">number</span> <span class="o">+=</span> <span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">sourceIndex</span> <span class="o">&gt;</span> <span class="nx">element</span><span class="p">.</span><span class="nx">sourceIndex</span> <span class="o">&amp;&amp;</span> <span class="mi">2</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-77">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-77">&#182;</a>               </div>               <p>The nodes are in different documents</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">number</span> <span class="o">+=</span> <span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">ownerDocument</span> <span class="o">!==</span> <span class="nx">element</span><span class="p">.</span><span class="nx">ownerDocument</span> <span class="o">||</span> <span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="nx">docEl</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">sourceIndex</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">element</span> <span class="o">!=</span> <span class="nx">docEl</span> <span class="o">&amp;&amp;</span> <span class="nx">element</span><span class="p">.</span><span class="nx">sourceIndex</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="mi">1</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">number</span><span class="p">;</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-78">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-78">&#182;</a>               </div>               <h2>jquery/lang/json/json.js</h2>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">$</span><span class="p">.</span><span class="nx">toJSON</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">replacer</span><span class="p">,</span> <span class="nx">space</span><span class="p">,</span> <span class="nx">recurse</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="nx">JSON</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">)</span> <span class="k">return</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">replacer</span><span class="p">,</span> <span class="nx">space</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">recurse</span> <span class="o">&amp;&amp;</span> <span class="nx">$</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">replacer</span><span class="p">))</span> <span class="nx">o</span> <span class="o">=</span> <span class="nx">replacer</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nx">o</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">space</span> <span class="o">==</span> <span class="s2">&quot;number&quot;</span><span class="p">)</span> <span class="nx">space</span> <span class="o">=</span> <span class="s2">&quot;          &quot;</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">space</span><span class="p">);</span>
    <span class="nx">space</span> <span class="o">=</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">space</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="nx">space</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">type</span> <span class="o">=</span> <span class="k">typeof</span><span class="p">(</span><span class="nx">o</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">o</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="k">return</span> <span class="s2">&quot;null&quot;</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">||</span> <span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;function&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;number&quot;</span> <span class="o">||</span> <span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;boolean&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">o</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">$</span><span class="p">.</span><span class="nx">quoteString</span><span class="p">(</span><span class="nx">o</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">o</span><span class="p">.</span><span class="nx">toJSON</span> <span class="o">==</span> <span class="s2">&quot;function&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">$</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">(),</span> <span class="nx">replacer</span><span class="p">,</span> <span class="nx">space</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">===</span> <span class="nb">Date</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">month</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">getUTCMonth</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">month</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="nx">month</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span> <span class="o">+</span> <span class="nx">month</span><span class="p">;</span>

        <span class="kd">var</span> <span class="nx">day</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">getUTCDate</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">day</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="nx">day</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span> <span class="o">+</span> <span class="nx">day</span><span class="p">;</span>

        <span class="kd">var</span> <span class="nx">year</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">getUTCFullYear</span><span class="p">();</span>

        <span class="kd">var</span> <span class="nx">hours</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">getUTCHours</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">hours</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="nx">hours</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span> <span class="o">+</span> <span class="nx">hours</span><span class="p">;</span>

        <span class="kd">var</span> <span class="nx">minutes</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">getUTCMinutes</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">minutes</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="nx">minutes</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span> <span class="o">+</span> <span class="nx">minutes</span><span class="p">;</span>

        <span class="kd">var</span> <span class="nx">seconds</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">getUTCSeconds</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">seconds</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="nx">seconds</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span> <span class="o">+</span> <span class="nx">seconds</span><span class="p">;</span>

        <span class="kd">var</span> <span class="nx">milli</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">getUTCMilliseconds</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">milli</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">)</span> <span class="nx">milli</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span> <span class="o">+</span> <span class="nx">milli</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">milli</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="nx">milli</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span> <span class="o">+</span> <span class="nx">milli</span><span class="p">;</span>

        <span class="k">return</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="nx">year</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nx">month</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nx">day</span> <span class="o">+</span> <span class="s1">&#39;T&#39;</span> <span class="o">+</span> <span class="nx">hours</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="nx">minutes</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="nx">seconds</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="nx">milli</span> <span class="o">+</span> <span class="s1">&#39;Z&quot;&#39;</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="kd">var</span> <span class="nx">process</span> <span class="o">=</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">replacer</span><span class="p">))</span> <span class="o">?</span>
      <span class="kd">function</span> <span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">replacer</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">v</span><span class="p">);</span>
      <span class="p">}</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">v</span><span class="p">;</span>
      <span class="p">},</span>
        <span class="nx">nl</span> <span class="o">=</span> <span class="p">(</span><span class="nx">space</span><span class="p">)</span> <span class="o">?</span> <span class="s2">&quot;\n&quot;</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="nx">sp</span> <span class="o">=</span> <span class="p">(</span><span class="nx">space</span><span class="p">)</span> <span class="o">?</span> <span class="s2">&quot; &quot;</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">===</span> <span class="nb">Array</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">o</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span>
        <span class="nx">ret</span><span class="p">.</span><span class="nx">push</span><span class="p">((</span><span class="nx">$</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">(</span><span class="nx">process</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">o</span><span class="p">[</span><span class="nx">i</span><span class="p">]),</span> <span class="nx">replacer</span><span class="p">,</span> <span class="nx">space</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span> <span class="o">||</span> <span class="s2">&quot;null&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^/gm</span><span class="p">,</span> <span class="nx">space</span><span class="p">));</span>

        <span class="k">return</span> <span class="s2">&quot;[&quot;</span> <span class="o">+</span> <span class="nx">nl</span> <span class="o">+</span> <span class="nx">ret</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nx">nl</span><span class="p">)</span> <span class="o">+</span> <span class="nx">nl</span> <span class="o">+</span> <span class="s2">&quot;]&quot;</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="kd">var</span> <span class="nx">pairs</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="nx">proplist</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">replacer</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">proplist</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">replacer</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">v</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span> <span class="o">||</span> <span class="k">typeof</span> <span class="nx">v</span> <span class="o">==</span> <span class="s2">&quot;number&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="nx">v</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">});</span>
      <span class="p">}</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">k</span> <span class="k">in</span> <span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">val</span><span class="p">,</span> <span class="nx">type</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">k</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">proplist</span> <span class="o">&amp;&amp;</span> <span class="nx">$</span><span class="p">.</span><span class="nx">inArray</span><span class="p">(</span><span class="nx">k</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nx">proplist</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;number&quot;</span><span class="p">)</span> <span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="nx">k</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">;</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">quoteString</span><span class="p">(</span><span class="nx">k</span><span class="p">);</span>
        <span class="k">else</span> <span class="k">continue</span><span class="p">;</span> <span class="c1">//skip non-string or number keys</span>
        <span class="nx">val</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">(</span><span class="nx">process</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">o</span><span class="p">[</span><span class="nx">k</span><span class="p">]),</span> <span class="nx">replacer</span><span class="p">,</span> <span class="nx">space</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">val</span> <span class="o">==</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span> <span class="c1">//skip pairs where the value is a function.</span>
        <span class="nx">pairs</span><span class="p">.</span><span class="nx">push</span><span class="p">((</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nx">sp</span> <span class="o">+</span> <span class="nx">val</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^/gm</span><span class="p">,</span> <span class="nx">space</span><span class="p">));</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="s2">&quot;{&quot;</span> <span class="o">+</span> <span class="nx">nl</span> <span class="o">+</span> <span class="nx">pairs</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nx">nl</span><span class="p">)</span> <span class="o">+</span> <span class="nx">nl</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span>


  <span class="nx">$</span><span class="p">.</span><span class="nx">evalJSON</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">src</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="nx">JSON</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">)</span> <span class="k">return</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">src</span><span class="p">);</span>
    <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="nx">src</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">);</span>
  <span class="p">};</span>


  <span class="nx">$</span><span class="p">.</span><span class="nx">secureEvalJSON</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">src</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="nx">JSON</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">)</span> <span class="k">return</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">src</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">filtered</span> <span class="o">=</span> <span class="nx">src</span><span class="p">;</span>
    <span class="nx">filtered</span> <span class="o">=</span> <span class="nx">filtered</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\\[&quot;\\\/bfnrtu]/g</span><span class="p">,</span> <span class="s1">&#39;@&#39;</span><span class="p">);</span>
    <span class="nx">filtered</span> <span class="o">=</span> <span class="nx">filtered</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&quot;[^&quot;\\\n\r]*&quot;|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g</span><span class="p">,</span> <span class="s1">&#39;]&#39;</span><span class="p">);</span>
    <span class="nx">filtered</span> <span class="o">=</span> <span class="nx">filtered</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(?:^|:|,)(?:\s*\[)+/g</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="sr">/^[\],:{}\s]*$/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">filtered</span><span class="p">))</span> <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="nx">src</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">);</span>
    <span class="k">else</span> <span class="k">throw</span> <span class="k">new</span> <span class="nx">SyntaxError</span><span class="p">(</span><span class="s2">&quot;Error parsing JSON, source is not valid.&quot;</span><span class="p">);</span>
  <span class="p">};</span>


  <span class="nx">$</span><span class="p">.</span><span class="nx">quoteString</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">string</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">_escapeable</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="nx">string</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">_escapeable</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="nx">_meta</span><span class="p">[</span><span class="nx">a</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">c</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">c</span><span class="p">;</span>
        <span class="nx">c</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">();</span>
        <span class="k">return</span> <span class="s1">&#39;\\u00&#39;</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">c</span> <span class="o">/</span> <span class="mi">16</span><span class="p">).</span><span class="nx">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">c</span> <span class="o">%</span> <span class="mi">16</span><span class="p">).</span><span class="nx">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">);</span>
      <span class="p">})</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="nx">string</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="kd">var</span> <span class="nx">_escapeable</span> <span class="o">=</span> <span class="sr">/[&quot;\\\x00-\x1f\x7f-\x9f]/g</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">_meta</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;\b&#39;</span><span class="o">:</span> <span class="s1">&#39;\\b&#39;</span><span class="p">,</span>
    <span class="s1">&#39;\t&#39;</span><span class="o">:</span> <span class="s1">&#39;\\t&#39;</span><span class="p">,</span>
    <span class="s1">&#39;\n&#39;</span><span class="o">:</span> <span class="s1">&#39;\\n&#39;</span><span class="p">,</span>
    <span class="s1">&#39;\f&#39;</span><span class="o">:</span> <span class="s1">&#39;\\f&#39;</span><span class="p">,</span>
    <span class="s1">&#39;\r&#39;</span><span class="o">:</span> <span class="s1">&#39;\\r&#39;</span><span class="p">,</span>
    <span class="s1">&#39;&quot;&#39;</span><span class="o">:</span> <span class="s1">&#39;\\&quot;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;\\&#39;</span><span class="o">:</span> <span class="s1">&#39;\\\\&#39;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-79">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-79">&#182;</a>               </div>               <h2>jquery/dom/cookie/cookie.js</h2>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">$</span><span class="p">.</span><span class="nx">cookie</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-80">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-80">&#182;</a>               </div>               <p>name and value given, set cookie</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">value</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="nx">options</span><span class="p">.</span><span class="nx">expires</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-81">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-81">&#182;</a>               </div>               <p>convert value to JSON string</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">$</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">value</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="kd">var</span> <span class="nx">expires</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-82">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-82">&#182;</a>               </div>               <p>Set expiry</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">expires</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">options</span><span class="p">.</span><span class="nx">expires</span> <span class="o">==</span> <span class="s1">&#39;number&#39;</span> <span class="o">||</span> <span class="nx">options</span><span class="p">.</span><span class="nx">expires</span><span class="p">.</span><span class="nx">toUTCString</span><span class="p">))</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">date</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">options</span><span class="p">.</span><span class="nx">expires</span> <span class="o">==</span> <span class="s1">&#39;number&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">date</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
          <span class="nx">date</span><span class="p">.</span><span class="nx">setTime</span><span class="p">(</span><span class="nx">date</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">expires</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
          <span class="nx">date</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">expires</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">expires</span> <span class="o">=</span> <span class="s1">&#39;; expires=&#39;</span> <span class="o">+</span> <span class="nx">date</span><span class="p">.</span><span class="nx">toUTCString</span><span class="p">();</span> <span class="c1">// use expires attribute, max-age is not supported by IE</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-83">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-83">&#182;</a>               </div>               <p>CAUTION: Needed to parenthesize options.path and options.domain
in the following expressions, otherwise they evaluate to undefined
in the packed version for some reason...</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">path</span> <span class="o">?</span> <span class="s1">&#39;; path=&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">path</span><span class="p">)</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">domain</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">domain</span> <span class="o">?</span> <span class="s1">&#39;; domain=&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">domain</span><span class="p">)</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">secure</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">secure</span> <span class="o">?</span> <span class="s1">&#39;; secure&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-84">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-84">&#182;</a>               </div>               <p>Set the cookie name=value;expires=;path=;domain=;secure-</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span> <span class="o">=</span> <span class="p">[</span><span class="nx">name</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">value</span><span class="p">),</span> <span class="nx">expires</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">domain</span><span class="p">,</span> <span class="nx">secure</span><span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span> <span class="c1">// only name given, get cookie</span>
      <span class="kd">var</span> <span class="nx">cookieValue</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span> <span class="o">&amp;&amp;</span> <span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">cookies</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">cookies</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">cookie</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">trim</span><span class="p">(</span><span class="nx">cookies</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span></pre></div>             </td>           </tr>                               <tr id="section-85">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-85">&#182;</a>               </div>               <p>Does this cookie string begin with the name we want?</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">if</span> <span class="p">(</span><span class="nx">cookie</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">name</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span><span class="p">))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-86">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-86">&#182;</a>               </div>               <p>Get the cookie value</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">cookieValue</span> <span class="o">=</span> <span class="nb">decodeURIComponent</span><span class="p">(</span><span class="nx">cookie</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="nx">name</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-87">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-87">&#182;</a>               </div>               <p>Parse JSON from the cookie into an object</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">evalJSON</span> <span class="o">&amp;&amp;</span> <span class="nx">cookieValue</span> <span class="o">&amp;&amp;</span> <span class="nx">cookieValue</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^\s*\{/</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
          <span class="nx">cookieValue</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">evalJSON</span><span class="p">(</span><span class="nx">cookieValue</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">cookieValue</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-88">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-88">&#182;</a>               </div>               <h2>jquery/dom/dimensions/dimensions.js</h2>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span></pre></div>             </td>           </tr>                               <tr id="section-89">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-89">&#182;</a>               </div>               <p>margin is inside border</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">weird</span> <span class="o">=</span> <span class="sr">/button|select/i</span><span class="p">,</span>
    <span class="nx">getBoxes</span> <span class="o">=</span> <span class="p">{},</span>
    <span class="nx">checks</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">width</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;Left&quot;</span><span class="p">,</span> <span class="s2">&quot;Right&quot;</span><span class="p">],</span>
      <span class="nx">height</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;Top&#39;</span><span class="p">,</span> <span class="s1">&#39;Bottom&#39;</span><span class="p">],</span>
      <span class="nx">oldOuterHeight</span><span class="o">:</span> <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">outerHeight</span><span class="p">,</span>
      <span class="nx">oldOuterWidth</span><span class="o">:</span> <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">outerWidth</span><span class="p">,</span>
      <span class="nx">oldInnerWidth</span><span class="o">:</span> <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">,</span>
      <span class="nx">oldInnerHeight</span><span class="o">:</span> <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">innerHeight</span>
    <span class="p">},</span>
    <span class="nx">supportsSetter</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">jquery</span> <span class="o">&gt;=</span> <span class="s1">&#39;1.8.0&#39;</span><span class="p">;</span>

  <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">({</span>

    <span class="nx">width</span><span class="o">:</span>

    <span class="s2">&quot;Width&quot;</span><span class="p">,</span>

    <span class="nx">height</span><span class="o">:</span></pre></div>             </td>           </tr>                               <tr id="section-90">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-90">&#182;</a>               </div>               <p>for each 'height' and 'width'</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;Height&quot;</span>
  <span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">lower</span><span class="p">,</span> <span class="nx">Upper</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-91">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-91">&#182;</a>               </div>               <p>used to get the padding and border for an element in a given direction</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">getBoxes</span><span class="p">[</span><span class="nx">lower</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">boxes</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">val</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">weird</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">el</span><span class="p">.</span><span class="nx">nodeName</span><span class="p">))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-92">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-92">&#182;</a>               </div>               <p>make what to check for ....</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">myChecks</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">checks</span><span class="p">[</span><span class="nx">lower</span><span class="p">],</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">direction</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
          <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">boxes</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="nx">myChecks</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">name</span> <span class="o">+</span> <span class="nx">direction</span> <span class="o">+</span> <span class="p">(</span><span class="nx">name</span> <span class="o">==</span> <span class="s1">&#39;border&#39;</span> <span class="o">?</span> <span class="s2">&quot;Width&quot;</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">));</span>
          <span class="p">})</span>
        <span class="p">})</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">styles</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">myChecks</span><span class="p">),</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">val</span> <span class="o">+=</span> <span class="p">(</span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">);</span>
        <span class="p">})</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">val</span><span class="p">;</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-93">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-93">&#182;</a>               </div>               <p>getter / setter</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">supportsSetter</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">[</span><span class="s2">&quot;outer&quot;</span> <span class="o">+</span> <span class="nx">Upper</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="nx">margin</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">first</span> <span class="o">=</span> <span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">v</span> <span class="o">==</span> <span class="s1">&#39;number&#39;</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-94">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-94">&#182;</a>               </div>               <p>Setting the value</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">first</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">[</span><span class="nx">lower</span><span class="p">](</span><span class="nx">v</span> <span class="o">-</span> <span class="nx">getBoxes</span><span class="p">[</span><span class="nx">lower</span><span class="p">](</span><span class="nx">first</span><span class="p">,</span> <span class="p">{</span>
            <span class="nx">padding</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="nx">border</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="nx">margin</span><span class="o">:</span> <span class="nx">margin</span>
          <span class="p">}))</span>
          <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-95">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-95">&#182;</a>               </div>               <p>Return the old value</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">return</span> <span class="nx">first</span> <span class="o">?</span> <span class="nx">checks</span><span class="p">[</span><span class="s2">&quot;oldOuter&quot;</span> <span class="o">+</span> <span class="nx">Upper</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">)</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">[</span><span class="s2">&quot;inner&quot;</span> <span class="o">+</span> <span class="nx">Upper</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">first</span> <span class="o">=</span> <span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">v</span> <span class="o">==</span> <span class="s1">&#39;number&#39;</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-96">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-96">&#182;</a>               </div>               <p>Setting the value</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">first</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">[</span><span class="nx">lower</span><span class="p">](</span><span class="nx">v</span> <span class="o">-</span> <span class="nx">getBoxes</span><span class="p">[</span><span class="nx">lower</span><span class="p">](</span><span class="nx">first</span><span class="p">,</span> <span class="p">{</span>
            <span class="nx">padding</span><span class="o">:</span> <span class="kc">true</span>
          <span class="p">}))</span>
          <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-97">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-97">&#182;</a>               </div>               <p>Return the old value</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">return</span> <span class="nx">first</span> <span class="o">?</span> <span class="nx">checks</span><span class="p">[</span><span class="s2">&quot;oldInner&quot;</span> <span class="o">+</span> <span class="nx">Upper</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">)</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-98">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-98">&#182;</a>               </div>               <p>provides animations</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">animate</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">boxes</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-99">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-99">&#182;</a>               </div>               <p>Return the animation function</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">fx</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">fx</span><span class="p">[</span><span class="nx">supportsSetter</span> <span class="o">?</span> <span class="s1">&#39;pos&#39;</span> <span class="o">:</span> <span class="s1">&#39;state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">fx</span><span class="p">.</span><span class="nx">start</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">fx</span><span class="p">.</span><span class="nx">elem</span><span class="p">)[</span><span class="nx">lower</span><span class="p">]();</span>
          <span class="nx">fx</span><span class="p">.</span><span class="nx">end</span> <span class="o">=</span> <span class="nx">fx</span><span class="p">.</span><span class="nx">end</span> <span class="o">-</span> <span class="nx">getBoxes</span><span class="p">[</span><span class="nx">lower</span><span class="p">](</span><span class="nx">fx</span><span class="p">.</span><span class="nx">elem</span><span class="p">,</span> <span class="nx">boxes</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">fx</span><span class="p">.</span><span class="nx">elem</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="nx">lower</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nx">fx</span><span class="p">.</span><span class="nx">pos</span> <span class="o">*</span> <span class="p">(</span><span class="nx">fx</span><span class="p">.</span><span class="nx">end</span> <span class="o">-</span> <span class="nx">fx</span><span class="p">.</span><span class="nx">start</span><span class="p">)</span> <span class="o">+</span> <span class="nx">fx</span><span class="p">.</span><span class="nx">start</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">fx</span><span class="p">.</span><span class="nx">step</span><span class="p">[</span><span class="s2">&quot;outer&quot;</span> <span class="o">+</span> <span class="nx">Upper</span><span class="p">]</span> <span class="o">=</span> <span class="nx">animate</span><span class="p">({</span>
      <span class="nx">padding</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="nx">border</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">})</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">fx</span><span class="p">.</span><span class="nx">step</span><span class="p">[</span><span class="s2">&quot;outer&quot;</span> <span class="o">+</span> <span class="nx">Upper</span> <span class="o">+</span> <span class="s2">&quot;Margin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">animate</span><span class="p">({</span>
      <span class="nx">padding</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="nx">border</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="nx">margin</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">})</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">fx</span><span class="p">.</span><span class="nx">step</span><span class="p">[</span><span class="s2">&quot;inner&quot;</span> <span class="o">+</span> <span class="nx">Upper</span><span class="p">]</span> <span class="o">=</span> <span class="nx">animate</span><span class="p">({</span>
      <span class="nx">padding</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">})</span>

  <span class="p">})</span></pre></div>             </td>           </tr>                               <tr id="section-100">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-100">&#182;</a>               </div>               <h2>jquery/dom/form<em>params/form</em>params.js</h2>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span></pre></div>             </td>           </tr>                               <tr id="section-101">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-101">&#182;</a>               </div>               <p>use to parse bracket notation like my[name][attribute]</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">keyBreaker</span> <span class="o">=</span> <span class="sr">/[^\[\]]+/g</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-102">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-102">&#182;</a>               </div>               <p>converts values that look like numbers and booleans and removes empty strings</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">convertValue</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">isNumeric</span><span class="p">(</span><span class="nx">value</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">===</span> <span class="s1">&#39;true&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">===</span> <span class="s1">&#39;false&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span> <span class="o">||</span> <span class="nx">value</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-103">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-103">&#182;</a>               </div>               <p>Access nested data</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">nestData</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">elem</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">parts</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">seen</span><span class="p">,</span> <span class="nx">fullName</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">parts</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-104">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-104">&#182;</a>               </div>               <p>Keep track of the dot separated fullname. Used to uniquely track seen values
and if they should be converted to an array or not</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">fullName</span> <span class="o">=</span> <span class="nx">fullName</span> <span class="o">?</span> <span class="nx">fullName</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="nx">name</span> <span class="o">:</span> <span class="nx">name</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">parts</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">data</span><span class="p">[</span><span class="nx">name</span><span class="p">])</span> <span class="p">{</span>
          <span class="nx">data</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-105">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-105">&#182;</a>               </div>               <p>Recursive call</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">nestData</span><span class="p">(</span><span class="nx">elem</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">data</span><span class="p">[</span><span class="nx">name</span><span class="p">],</span> <span class="nx">parts</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">seen</span><span class="p">,</span> <span class="nx">fullName</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-106">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-106">&#182;</a>               </div>               <p>Handle same name case, as well as "last checkbox checked"
case</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">fullName</span> <span class="k">in</span> <span class="nx">seen</span> <span class="o">&amp;&amp;</span> <span class="nx">type</span> <span class="o">!=</span> <span class="s2">&quot;radio&quot;</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">$</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">name</span><span class="p">]))</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">name</span> <span class="k">in</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">data</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nx">data</span><span class="p">[</span><span class="nx">name</span><span class="p">]];</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">data</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
          <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">seen</span><span class="p">[</span><span class="nx">fullName</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-107">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-107">&#182;</a>               </div>               <p>Finally, assign data</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">((</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;radio&quot;</span> <span class="o">||</span> <span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;checkbox&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">elem</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="s2">&quot;:checked&quot;</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">return</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">data</span><span class="p">[</span><span class="nx">name</span><span class="p">])</span> <span class="p">{</span>
          <span class="nx">data</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">data</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
        <span class="p">}</span>


      <span class="p">}</span>

    <span class="p">};</span>


  <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">formParams</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span>

      <span class="kd">var</span> <span class="nx">convert</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-108">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-108">&#182;</a>               </div>               <p>Quick way to determine if something is a boolean</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span> <span class="o">!!</span> <span class="nx">params</span> <span class="o">===</span> <span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">convert</span> <span class="o">=</span> <span class="nx">params</span><span class="p">;</span>
        <span class="nx">params</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">setParams</span><span class="p">(</span><span class="nx">params</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">getParams</span><span class="p">(</span><span class="nx">convert</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">setParams</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-109">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-109">&#182;</a>               </div>               <p>Find all the inputs</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">this</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;[name]&quot;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">$this</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">),</span>
          <span class="nx">value</span> <span class="o">=</span> <span class="nx">params</span><span class="p">[</span><span class="nx">$this</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)];</span></pre></div>             </td>           </tr>                               <tr id="section-110">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-110">&#182;</a>               </div>               <p>Don't do all this work if there's no value</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-111">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-111">&#182;</a>               </div>               <p>Nested these if statements for performance</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">if</span> <span class="p">(</span><span class="nx">$this</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="s2">&quot;:radio&quot;</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">$this</span><span class="p">.</span><span class="nx">val</span><span class="p">()</span> <span class="o">==</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">$this</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;checked&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="p">}</span>
          <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">$this</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="s2">&quot;:checkbox&quot;</span><span class="p">))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-112">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-112">&#182;</a>               </div>               <p>Convert single value to an array to reduce
complexity</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">value</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">?</span> <span class="nx">value</span> <span class="o">:</span> <span class="p">[</span><span class="nx">value</span><span class="p">];</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">inArray</span><span class="p">(</span><span class="nx">$this</span><span class="p">.</span><span class="nx">val</span><span class="p">(),</span> <span class="nx">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">$this</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;checked&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="p">}</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">$this</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">});</span>
    <span class="p">},</span>
    <span class="nx">getParams</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">convert</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{},</span></pre></div>             </td>           </tr>                               <tr id="section-113">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-113">&#182;</a>               </div>               <p>This is used to keep track of the checkbox names that we've
already seen, so we know that we should return an array if
we see it multiple times. Fixes last checkbox checked bug.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">seen</span> <span class="o">=</span> <span class="p">{},</span>
        <span class="nx">current</span><span class="p">;</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;[name]:not(:disabled)&quot;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">$this</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">),</span>
          <span class="nx">type</span> <span class="o">=</span> <span class="nx">$this</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">),</span>
          <span class="nx">name</span> <span class="o">=</span> <span class="nx">$this</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">),</span>
          <span class="nx">value</span> <span class="o">=</span> <span class="nx">$this</span><span class="p">.</span><span class="nx">val</span><span class="p">(),</span>
          <span class="nx">parts</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-114">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-114">&#182;</a>               </div>               <p>Don't accumulate submit buttons and nameless elements</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;submit&quot;</span> <span class="o">||</span> <span class="o">!</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-115">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-115">&#182;</a>               </div>               <p>Figure out name parts</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">parts</span> <span class="o">=</span> <span class="nx">name</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">keyBreaker</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">parts</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">parts</span> <span class="o">=</span> <span class="p">[</span><span class="nx">name</span><span class="p">];</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-116">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-116">&#182;</a>               </div>               <p>Convert the value</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">convert</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">value</span> <span class="o">=</span> <span class="nx">convertValue</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-117">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-117">&#182;</a>               </div>               <p>Assign data recursively</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">nestData</span><span class="p">(</span><span class="nx">$this</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">parts</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">seen</span><span class="p">);</span>

      <span class="p">});</span>

      <span class="k">return</span> <span class="nx">data</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-118">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-118">&#182;</a>               </div>               <h2>jquery/dom/range/range.js</h2>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">range</span> <span class="o">=</span>

  <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Range</span><span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">convertType</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">type</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/([a-z])([a-z]+)/gi</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">all</span><span class="p">,</span> <span class="nx">first</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">first</span> <span class="o">+</span> <span class="nx">next</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span>
    <span class="p">}).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/_/g</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-119">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-119">&#182;</a>               </div>               <p>reverses things like START<em>TO</em>END into END<em>TO</em>START</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">reverse</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">type</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^([a-z]+)_TO_([a-z]+)/i</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">all</span><span class="p">,</span> <span class="nx">first</span><span class="p">,</span> <span class="nx">last</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">last</span> <span class="o">+</span> <span class="s2">&quot;_TO_&quot;</span> <span class="o">+</span> <span class="nx">first</span><span class="p">;</span>
      <span class="p">});</span>
    <span class="p">},</span>
    <span class="nx">getWindow</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">element</span> <span class="o">?</span> <span class="nx">element</span><span class="p">.</span><span class="nx">ownerDocument</span><span class="p">.</span><span class="nx">defaultView</span> <span class="o">||</span> <span class="nx">element</span><span class="p">.</span><span class="nx">ownerDocument</span><span class="p">.</span><span class="nx">parentWindow</span> <span class="o">:</span> <span class="nb">window</span>
    <span class="p">},</span>
    <span class="nx">bisect</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">start</span><span class="p">,</span> <span class="nx">end</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-120">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-120">&#182;</a>               </div>               <p>split the start and end ... figure out who is touching ...</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">end</span> <span class="o">-</span> <span class="nx">start</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">support</span> <span class="o">=</span> <span class="p">{};</span>

  <span class="nx">$</span><span class="p">.</span><span class="nx">Range</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">range</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-121">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-121">&#182;</a>               </div>               <p>If it's called w/o new, call it with new!</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">!==</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Range</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Range</span><span class="p">(</span><span class="nx">range</span><span class="p">);</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-122">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-122">&#182;</a>               </div>               <p>If we are passed a jQuery-wrapped element, get the raw element</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">range</span> <span class="o">&amp;&amp;</span> <span class="nx">range</span><span class="p">.</span><span class="nx">jquery</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">range</span> <span class="o">=</span> <span class="nx">range</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-123">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-123">&#182;</a>               </div>               <p>If we have an element, or nothing</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">range</span> <span class="o">||</span> <span class="nx">range</span><span class="p">.</span><span class="nx">nodeType</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-124">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-124">&#182;</a>               </div>               <p>create a range</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">this</span><span class="p">.</span><span class="nx">win</span> <span class="o">=</span> <span class="nx">getWindow</span><span class="p">(</span><span class="nx">range</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">win</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">createRange</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">range</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">win</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">createRange</span><span class="p">()</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">win</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">win</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">win</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">createTextRange</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">range</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">win</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">createTextRange</span><span class="p">()</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-125">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-125">&#182;</a>               </div>               <p>if we have an element, make the range select it</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">range</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="nx">range</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-126">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-126">&#182;</a>               </div>               <p>if we are given a point</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">range</span><span class="p">.</span><span class="nx">clientX</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">range</span><span class="p">.</span><span class="nx">pageX</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">range</span><span class="p">.</span><span class="nx">left</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">moveToPoint</span><span class="p">(</span><span class="nx">range</span><span class="p">);</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-127">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-127">&#182;</a>               </div>               <p>if we are given a touch event</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">range</span><span class="p">.</span><span class="nx">originalEvent</span> <span class="o">&amp;&amp;</span> <span class="nx">range</span><span class="p">.</span><span class="nx">originalEvent</span><span class="p">.</span><span class="nx">touches</span> <span class="o">&amp;&amp;</span> <span class="nx">range</span><span class="p">.</span><span class="nx">originalEvent</span><span class="p">.</span><span class="nx">touches</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">moveToPoint</span><span class="p">(</span><span class="nx">range</span><span class="p">.</span><span class="nx">originalEvent</span><span class="p">.</span><span class="nx">touches</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-128">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-128">&#182;</a>               </div>               <p>if we are a normal event</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">range</span><span class="p">.</span><span class="nx">originalEvent</span> <span class="o">&amp;&amp;</span> <span class="nx">range</span><span class="p">.</span><span class="nx">originalEvent</span><span class="p">.</span><span class="nx">changedTouches</span> <span class="o">&amp;&amp;</span> <span class="nx">range</span><span class="p">.</span><span class="nx">originalEvent</span><span class="p">.</span><span class="nx">changedTouches</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">moveToPoint</span><span class="p">(</span><span class="nx">range</span><span class="p">.</span><span class="nx">originalEvent</span><span class="p">.</span><span class="nx">changedTouches</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-129">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-129">&#182;</a>               </div>               <p>given a TextRange or something else?</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">else</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">range</span> <span class="o">=</span> <span class="nx">range</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="nx">$</span><span class="p">.</span><span class="nx">Range</span><span class="p">.</span>

  <span class="nx">current</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">win</span> <span class="o">=</span> <span class="nx">getWindow</span><span class="p">(</span><span class="nx">el</span><span class="p">),</span>
      <span class="nx">selection</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">win</span><span class="p">.</span><span class="nx">getSelection</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-130">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-130">&#182;</a>               </div>               <p>If we can get the selection</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">selection</span> <span class="o">=</span> <span class="nx">win</span><span class="p">.</span><span class="nx">getSelection</span><span class="p">()</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Range</span><span class="p">(</span><span class="nx">selection</span><span class="p">.</span><span class="nx">rangeCount</span> <span class="o">?</span> <span class="nx">selection</span><span class="p">.</span><span class="nx">getRangeAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="nx">win</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">createRange</span><span class="p">())</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-131">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-131">&#182;</a>               </div>               <p>Otherwise use document.selection</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">return</span> <span class="k">new</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Range</span><span class="p">(</span><span class="nx">win</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">selection</span><span class="p">.</span><span class="nx">createRange</span><span class="p">());</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">Range</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span>

  <span class="p">{</span>

    <span class="nx">moveToPoint</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">point</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">clientX</span> <span class="o">=</span> <span class="nx">point</span><span class="p">.</span><span class="nx">clientX</span><span class="p">,</span>
        <span class="nx">clientY</span> <span class="o">=</span> <span class="nx">point</span><span class="p">.</span><span class="nx">clientY</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">clientX</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">off</span> <span class="o">=</span> <span class="nx">scrollOffset</span><span class="p">();</span>
          <span class="nx">clientX</span> <span class="o">=</span> <span class="p">(</span><span class="nx">point</span><span class="p">.</span><span class="nx">pageX</span> <span class="o">||</span> <span class="nx">point</span><span class="p">.</span><span class="nx">left</span> <span class="o">||</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="nx">off</span><span class="p">.</span><span class="nx">left</span><span class="p">;</span>
          <span class="nx">clientY</span> <span class="o">=</span> <span class="p">(</span><span class="nx">point</span><span class="p">.</span><span class="nx">pageY</span> <span class="o">||</span> <span class="nx">point</span><span class="p">.</span><span class="nx">top</span> <span class="o">||</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="nx">off</span><span class="p">.</span><span class="nx">top</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">support</span><span class="p">.</span><span class="nx">moveToPoint</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">range</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Range</span><span class="p">().</span><span class="nx">range</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">moveToPoint</span><span class="p">(</span><span class="nx">clientX</span><span class="p">,</span> <span class="nx">clientY</span><span class="p">);</span>
          <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-132">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-132">&#182;</a>               </div>               <p>it's some text node in this range ...</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">parent</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">elementFromPoint</span><span class="p">(</span><span class="nx">clientX</span><span class="p">,</span> <span class="nx">clientY</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-133">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-133">&#182;</a>               </div>               <p>typically it will be 'on' text</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">n</span> <span class="o">&lt;</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">n</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">[</span><span class="nx">n</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">===</span> <span class="mi">3</span> <span class="o">||</span> <span class="nx">node</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">===</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">range</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Range</span><span class="p">(</span><span class="nx">node</span><span class="p">),</span>
            <span class="nx">length</span> <span class="o">=</span> <span class="nx">range</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">length</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-134">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-134">&#182;</a>               </div>               <p>now lets start moving the end until the boundingRect is within our range</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">rect</span> <span class="o">=</span> <span class="nx">range</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="nx">i</span><span class="p">).</span><span class="nx">rect</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">rect</span><span class="p">.</span><span class="nx">left</span> <span class="o">&lt;=</span> <span class="nx">clientX</span> <span class="o">&amp;&amp;</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">width</span> <span class="o">&gt;=</span> <span class="nx">clientX</span> <span class="o">&amp;&amp;</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">top</span> <span class="o">&lt;=</span> <span class="nx">clientY</span> <span class="o">&amp;&amp;</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">height</span> <span class="o">&gt;=</span> <span class="nx">clientY</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">range</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span><span class="nx">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
              <span class="k">this</span><span class="p">.</span><span class="nx">range</span> <span class="o">=</span> <span class="nx">range</span><span class="p">.</span><span class="nx">range</span><span class="p">;</span>
              <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-135">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-135">&#182;</a>               </div>               <p>if not 'on' text, recursively go through and find out when we shift to next
'line'</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">previous</span><span class="p">;</span>
      <span class="nx">iterate</span><span class="p">(</span><span class="nx">parent</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">textNode</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">range</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Range</span><span class="p">(</span><span class="nx">textNode</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">range</span><span class="p">.</span><span class="nx">rect</span><span class="p">().</span><span class="nx">top</span> <span class="o">&gt;</span> <span class="nx">point</span><span class="p">.</span><span class="nx">clientY</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">previous</span> <span class="o">=</span> <span class="nx">range</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">});</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">previous</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">previous</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span><span class="nx">previous</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">length</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">range</span> <span class="o">=</span> <span class="nx">previous</span><span class="p">.</span><span class="nx">range</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">range</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Range</span><span class="p">(</span><span class="nx">parent</span><span class="p">).</span><span class="nx">range</span>
      <span class="p">}</span>
    <span class="p">},</span>

    <span class="nb">window</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">win</span> <span class="o">||</span> <span class="nb">window</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">overlaps</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">elRange</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">elRange</span><span class="p">.</span><span class="nx">nodeType</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">elRange</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Range</span><span class="p">(</span><span class="nx">elRange</span><span class="p">).</span><span class="nx">select</span><span class="p">(</span><span class="nx">elRange</span><span class="p">);</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-136">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-136">&#182;</a>               </div>               <p>if the start is within the element ...</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">startToStart</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">compare</span><span class="p">(</span><span class="s2">&quot;START_TO_START&quot;</span><span class="p">,</span> <span class="nx">elRange</span><span class="p">),</span>
        <span class="nx">endToEnd</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">compare</span><span class="p">(</span><span class="s2">&quot;END_TO_END&quot;</span><span class="p">,</span> <span class="nx">elRange</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-137">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-137">&#182;</a>               </div>               <p>if we wrap elRange</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">startToStart</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">endToEnd</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-138">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-138">&#182;</a>               </div>               <p>if our start is inside of it</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">startToStart</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">compare</span><span class="p">(</span><span class="s2">&quot;START_TO_END&quot;</span><span class="p">,</span> <span class="nx">elRange</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-139">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-139">&#182;</a>               </div>               <p>if our end is inside of elRange</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">compare</span><span class="p">(</span><span class="s2">&quot;END_TO_START&quot;</span><span class="p">,</span> <span class="nx">elRange</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">endToEnd</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">collapse</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">toStart</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">collapse</span><span class="p">(</span><span class="nx">toStart</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">?</span> <span class="kc">true</span> <span class="o">:</span> <span class="nx">toStart</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">toString</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">typeof</span> <span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">text</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">text</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
    <span class="p">},</span>

    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">set</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-140">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-140">&#182;</a>               </div>               <p>return start</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">set</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">startContainer</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="p">{</span>
            <span class="nx">container</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">startContainer</span><span class="p">,</span>
            <span class="nx">offset</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">startOffset</span>
          <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-141">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-141">&#182;</a>               </div>               <p>Get the start parent element</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="kd">var</span> <span class="nx">start</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">clone</span><span class="p">().</span><span class="nx">collapse</span><span class="p">().</span><span class="nx">parent</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-142">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-142">&#182;</a>               </div>               <p>used to get the start element offset</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="kd">var</span> <span class="nx">startRange</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Range</span><span class="p">(</span><span class="nx">start</span><span class="p">).</span><span class="nx">select</span><span class="p">(</span><span class="nx">start</span><span class="p">).</span><span class="nx">collapse</span><span class="p">();</span>
          <span class="nx">startRange</span><span class="p">.</span><span class="nx">move</span><span class="p">(</span><span class="s2">&quot;END_TO_START&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
          <span class="k">return</span> <span class="p">{</span>
            <span class="nx">container</span><span class="o">:</span> <span class="nx">start</span><span class="p">,</span>
            <span class="nx">offset</span><span class="o">:</span> <span class="nx">startRange</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">length</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">setStart</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-143">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-143">&#182;</a>               </div>               <p>supports setStart</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">set</span> <span class="o">==</span> <span class="s1">&#39;number&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">setStart</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">startContainer</span><span class="p">,</span> <span class="nx">set</span><span class="p">)</span>
          <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">set</span> <span class="o">==</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">callMove</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">startContainer</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">startOffset</span><span class="p">,</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">set</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">setStart</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">node</span><span class="p">,</span> <span class="nx">res</span><span class="p">.</span><span class="nx">offset</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">setStart</span><span class="p">(</span><span class="nx">set</span><span class="p">.</span><span class="nx">container</span><span class="p">,</span> <span class="nx">set</span><span class="p">.</span><span class="nx">offset</span><span class="p">)</span>
          <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">set</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">moveStart</span><span class="p">(</span><span class="s1">&#39;character&#39;</span><span class="p">,</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">set</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-144">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-144">&#182;</a>               </div>               <p>get the current end container</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="kd">var</span> <span class="nx">container</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">start</span><span class="p">().</span><span class="nx">container</span><span class="p">,</span>
              <span class="nx">offset</span>
              <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">set</span> <span class="o">==</span> <span class="s2">&quot;number&quot;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">offset</span> <span class="o">=</span> <span class="nx">set</span>
              <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">container</span> <span class="o">=</span> <span class="nx">set</span><span class="p">.</span><span class="nx">container</span>
                <span class="nx">offset</span> <span class="o">=</span> <span class="nx">set</span><span class="p">.</span><span class="nx">offset</span>
              <span class="p">}</span>
              <span class="kd">var</span> <span class="nx">newPoint</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Range</span><span class="p">(</span><span class="nx">container</span><span class="p">).</span><span class="nx">collapse</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-145">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-145">&#182;</a>               </div>               <p>move it over offset characters</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">newPoint</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">move</span><span class="p">(</span><span class="nx">offset</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">move</span><span class="p">(</span><span class="s2">&quot;START_TO_START&quot;</span><span class="p">,</span> <span class="nx">newPoint</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
      <span class="p">}</span>

    <span class="p">},</span>

    <span class="nx">end</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">set</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-146">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-146">&#182;</a>               </div>               <p>read end</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">set</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">startContainer</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="p">{</span>
            <span class="nx">container</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">endContainer</span><span class="p">,</span>
            <span class="nx">offset</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">endOffset</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
          <span class="kd">var</span></pre></div>             </td>           </tr>                               <tr id="section-147">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-147">&#182;</a>               </div>               <p>Get the end parent element</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">end</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">clone</span><span class="p">().</span><span class="nx">collapse</span><span class="p">(</span><span class="kc">false</span><span class="p">).</span><span class="nx">parent</span><span class="p">(),</span></pre></div>             </td>           </tr>                               <tr id="section-148">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-148">&#182;</a>               </div>               <p>used to get the end elements offset</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">endRange</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Range</span><span class="p">(</span><span class="nx">end</span><span class="p">).</span><span class="nx">select</span><span class="p">(</span><span class="nx">end</span><span class="p">).</span><span class="nx">collapse</span><span class="p">();</span>
          <span class="nx">endRange</span><span class="p">.</span><span class="nx">move</span><span class="p">(</span><span class="s2">&quot;END_TO_END&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
          <span class="k">return</span> <span class="p">{</span>
            <span class="nx">container</span><span class="o">:</span> <span class="nx">end</span><span class="p">,</span>
            <span class="nx">offset</span><span class="o">:</span> <span class="nx">endRange</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">length</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">setEnd</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">set</span> <span class="o">==</span> <span class="s1">&#39;number&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">setEnd</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">endContainer</span><span class="p">,</span> <span class="nx">set</span><span class="p">)</span>
          <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">set</span> <span class="o">==</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">callMove</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">endContainer</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">endOffset</span><span class="p">,</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">set</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">setEnd</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">node</span><span class="p">,</span> <span class="nx">res</span><span class="p">.</span><span class="nx">offset</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">setEnd</span><span class="p">(</span><span class="nx">set</span><span class="p">.</span><span class="nx">container</span><span class="p">,</span> <span class="nx">set</span><span class="p">.</span><span class="nx">offset</span><span class="p">)</span>
          <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">set</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">moveEnd</span><span class="p">(</span><span class="s1">&#39;character&#39;</span><span class="p">,</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">set</span><span class="p">,</span> <span class="mi">10</span><span class="p">));</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-149">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-149">&#182;</a>               </div>               <p>get the current end container</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="kd">var</span> <span class="nx">container</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">end</span><span class="p">().</span><span class="nx">container</span><span class="p">,</span>
              <span class="nx">offset</span>
              <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">set</span> <span class="o">==</span> <span class="s2">&quot;number&quot;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">offset</span> <span class="o">=</span> <span class="nx">set</span>
              <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">container</span> <span class="o">=</span> <span class="nx">set</span><span class="p">.</span><span class="nx">container</span>
                <span class="nx">offset</span> <span class="o">=</span> <span class="nx">set</span><span class="p">.</span><span class="nx">offset</span>
              <span class="p">}</span>
              <span class="kd">var</span> <span class="nx">newPoint</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Range</span><span class="p">(</span><span class="nx">container</span><span class="p">).</span><span class="nx">collapse</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-150">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-150">&#182;</a>               </div>               <p>move it over offset characters</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">newPoint</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">move</span><span class="p">(</span><span class="nx">offset</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">move</span><span class="p">(</span><span class="s2">&quot;END_TO_START&quot;</span><span class="p">,</span> <span class="nx">newPoint</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">parent</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">commonAncestorContainer</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">commonAncestorContainer</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

        <span class="kd">var</span> <span class="nx">parentElement</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">parentElement</span><span class="p">(),</span>
          <span class="nx">range</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-151">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-151">&#182;</a>               </div>               <p>IE's parentElement will always give an element, we want text ranges</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">iterate</span><span class="p">(</span><span class="nx">parentElement</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">txtNode</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">Range</span><span class="p">(</span><span class="nx">txtNode</span><span class="p">).</span><span class="nx">range</span><span class="p">.</span><span class="nx">inRange</span><span class="p">(</span><span class="nx">range</span><span class="p">))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-152">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-152">&#182;</a>               </div>               <p>swap out the parentElement</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">parentElement</span> <span class="o">=</span> <span class="nx">txtNode</span><span class="p">;</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">});</span>

        <span class="k">return</span> <span class="nx">parentElement</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">rect</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">from</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">rect</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-153">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-153">&#182;</a>               </div>               <p>for some reason in webkit this gets a better value</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">rect</span><span class="p">.</span><span class="nx">height</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">rect</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">rect</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">getClientRects</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">from</span> <span class="o">===</span> <span class="s1">&#39;page&#39;</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-154">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-154">&#182;</a>               </div>               <p>Add the scroll offset</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">off</span> <span class="o">=</span> <span class="nx">scrollOffset</span><span class="p">();</span>
        <span class="nx">rect</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="nx">rect</span><span class="p">);</span>
        <span class="nx">rect</span><span class="p">.</span><span class="nx">top</span> <span class="o">+=</span> <span class="nx">off</span><span class="p">.</span><span class="nx">top</span><span class="p">;</span>
        <span class="nx">rect</span><span class="p">.</span><span class="nx">left</span> <span class="o">+=</span> <span class="nx">off</span><span class="p">.</span><span class="nx">left</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">rect</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">rects</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">from</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-155">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-155">&#182;</a>               </div>               <p>order rects by size</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">rects</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">makeArray</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">getClientRects</span><span class="p">()).</span><span class="nx">sort</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">rect1</span><span class="p">,</span> <span class="nx">rect2</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">rect2</span><span class="p">.</span><span class="nx">width</span> <span class="o">*</span> <span class="nx">rect2</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="nx">rect1</span><span class="p">.</span><span class="nx">width</span> <span class="o">*</span> <span class="nx">rect1</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>
      <span class="p">}),</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">rect</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="nx">rect</span><span class="p">)</span>
      <span class="p">}),</span>
        <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">j</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">rects</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-156">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-156">&#182;</a>               </div>               <p>safari returns overlapping client rects
    - big rects can contain 2 smaller rects
    - some rects can contain 0 - width rects
    - we don't want these 0 width rects</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">while</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">rects</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">cur</span> <span class="o">=</span> <span class="nx">rects</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span>
          <span class="nx">found</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

        <span class="nx">j</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">(</span><span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">rects</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">withinRect</span><span class="p">(</span><span class="nx">cur</span><span class="p">,</span> <span class="nx">rects</span><span class="p">[</span><span class="nx">j</span><span class="p">]))</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">rects</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">width</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">rects</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
              <span class="nx">found</span> <span class="o">=</span> <span class="nx">rects</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span>
              <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">j</span><span class="o">++</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">found</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">rects</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">i</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span>

      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-157">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-157">&#182;</a>               </div>               <p>safari will be return overlapping ranges ...</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">from</span> <span class="o">==</span> <span class="s1">&#39;page&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">off</span> <span class="o">=</span> <span class="nx">scrollOffset</span><span class="p">();</span>
        <span class="k">return</span> <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">rects</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">ith</span><span class="p">,</span> <span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">item</span><span class="p">.</span><span class="nx">top</span> <span class="o">+=</span> <span class="nx">off</span><span class="p">.</span><span class="nx">top</span><span class="p">;</span>
          <span class="nx">item</span><span class="p">.</span><span class="nx">left</span> <span class="o">+=</span> <span class="nx">off</span><span class="p">.</span><span class="nx">left</span><span class="p">;</span>
        <span class="p">})</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="nx">rects</span><span class="p">;</span>
    <span class="p">}</span>

  <span class="p">});</span>
  <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-158">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-158">&#182;</a>               </div>               <p>method branching ....</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">fn</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Range</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span>
      <span class="nx">range</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Range</span><span class="p">().</span><span class="nx">range</span><span class="p">;</span>


    <span class="nx">fn</span><span class="p">.</span><span class="nx">compare</span> <span class="o">=</span> <span class="nx">range</span><span class="p">.</span><span class="nx">compareBoundaryPoints</span> <span class="o">?</span>
    <span class="kd">function</span> <span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">range</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">compareBoundaryPoints</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nb">window</span><span class="p">().</span><span class="nx">Range</span><span class="p">[</span><span class="nx">reverse</span><span class="p">(</span><span class="nx">type</span><span class="p">)],</span> <span class="nx">range</span><span class="p">.</span><span class="nx">range</span><span class="p">)</span>
    <span class="p">}</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">range</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">compareEndPoints</span><span class="p">(</span><span class="nx">convertType</span><span class="p">(</span><span class="nx">type</span><span class="p">),</span> <span class="nx">range</span><span class="p">.</span><span class="nx">range</span><span class="p">)</span>
    <span class="p">}</span>


    <span class="nx">fn</span><span class="p">.</span><span class="nx">move</span> <span class="o">=</span> <span class="nx">range</span><span class="p">.</span><span class="nx">setStart</span> <span class="o">?</span>
    <span class="kd">function</span> <span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">range</span><span class="p">)</span> <span class="p">{</span>

      <span class="kd">var</span> <span class="nx">rangesRange</span> <span class="o">=</span> <span class="nx">range</span><span class="p">.</span><span class="nx">range</span><span class="p">;</span>
      <span class="k">switch</span> <span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="s2">&quot;START_TO_END&quot;</span><span class="o">:</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">setStart</span><span class="p">(</span><span class="nx">rangesRange</span><span class="p">.</span><span class="nx">endContainer</span><span class="p">,</span> <span class="nx">rangesRange</span><span class="p">.</span><span class="nx">endOffset</span><span class="p">)</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="s2">&quot;START_TO_START&quot;</span><span class="o">:</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">setStart</span><span class="p">(</span><span class="nx">rangesRange</span><span class="p">.</span><span class="nx">startContainer</span><span class="p">,</span> <span class="nx">rangesRange</span><span class="p">.</span><span class="nx">startOffset</span><span class="p">)</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="s2">&quot;END_TO_END&quot;</span><span class="o">:</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">setEnd</span><span class="p">(</span><span class="nx">rangesRange</span><span class="p">.</span><span class="nx">endContainer</span><span class="p">,</span> <span class="nx">rangesRange</span><span class="p">.</span><span class="nx">endOffset</span><span class="p">)</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="s2">&quot;END_TO_START&quot;</span><span class="o">:</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">setEnd</span><span class="p">(</span><span class="nx">rangesRange</span><span class="p">.</span><span class="nx">startContainer</span><span class="p">,</span> <span class="nx">rangesRange</span><span class="p">.</span><span class="nx">startOffset</span><span class="p">)</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">}</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">range</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">setEndPoint</span><span class="p">(</span><span class="nx">convertType</span><span class="p">(</span><span class="nx">type</span><span class="p">),</span> <span class="nx">range</span><span class="p">.</span><span class="nx">range</span><span class="p">)</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="kd">var</span> <span class="nx">cloneFunc</span> <span class="o">=</span> <span class="nx">range</span><span class="p">.</span><span class="nx">cloneRange</span> <span class="o">?</span> <span class="s2">&quot;cloneRange&quot;</span> <span class="o">:</span> <span class="s2">&quot;duplicate&quot;</span><span class="p">,</span>
      <span class="nx">selectFunc</span> <span class="o">=</span> <span class="nx">range</span><span class="p">.</span><span class="nx">selectNodeContents</span> <span class="o">?</span> <span class="s2">&quot;selectNodeContents&quot;</span> <span class="o">:</span> <span class="s2">&quot;moveToElementText&quot;</span><span class="p">;</span>

    <span class="nx">fn</span><span class="p">.</span>

    <span class="nx">clone</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Range</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">[</span><span class="nx">cloneFunc</span><span class="p">]());</span>
    <span class="p">};</span>

    <span class="nx">fn</span><span class="p">.</span>

    <span class="nx">select</span> <span class="o">=</span> <span class="nx">range</span><span class="p">.</span><span class="nx">selectNodeContents</span> <span class="o">?</span>
    <span class="kd">function</span> <span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">selection</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nb">window</span><span class="p">().</span><span class="nx">getSelection</span><span class="p">();</span>
        <span class="nx">selection</span><span class="p">.</span><span class="nx">removeAllRanges</span><span class="p">();</span>
        <span class="nx">selection</span><span class="p">.</span><span class="nx">addRange</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">selectNodeContents</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">}</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">select</span><span class="p">()</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">el</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">===</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-159">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-159">&#182;</a>               </div>               <p>select this node in the element ...</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">parent</span> <span class="o">=</span> <span class="nx">el</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">,</span>
          <span class="nx">start</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
          <span class="nx">end</span><span class="p">;</span>
        <span class="nx">iterate</span><span class="p">(</span><span class="nx">parent</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">txtNode</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">txtNode</span> <span class="o">===</span> <span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">end</span> <span class="o">=</span> <span class="nx">start</span> <span class="o">+</span> <span class="nx">txtNode</span><span class="p">.</span><span class="nx">nodeValue</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">start</span> <span class="o">=</span> <span class="nx">start</span> <span class="o">+</span> <span class="nx">txtNode</span><span class="p">.</span><span class="nx">nodeValue</span><span class="p">.</span><span class="nx">length</span>
          <span class="p">}</span>
        <span class="p">})</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">moveToElementText</span><span class="p">(</span><span class="nx">parent</span><span class="p">);</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">moveEnd</span><span class="p">(</span><span class="s1">&#39;character&#39;</span><span class="p">,</span> <span class="nx">end</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">moveStart</span><span class="p">(</span><span class="s1">&#39;character&#39;</span><span class="p">,</span> <span class="nx">start</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">moveToElementText</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">};</span>

  <span class="p">})();</span></pre></div>             </td>           </tr>                               <tr id="section-160">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-160">&#182;</a>               </div>               <p>helpers  -----------------
iterates through a list of elements, calls cb on every text node
if cb returns false, exits the iteration</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">iterate</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">elems</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">elem</span><span class="p">,</span> <span class="nx">start</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">elems</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">elem</span> <span class="o">=</span> <span class="nx">elems</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span></pre></div>             </td>           </tr>                               <tr id="section-161">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-161">&#182;</a>               </div>               <p>Get the text from text nodes and CDATA nodes</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">elem</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">===</span> <span class="mi">3</span> <span class="o">||</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">===</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">cb</span><span class="p">(</span><span class="nx">elem</span><span class="p">)</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-162">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-162">&#182;</a>               </div>               <p>Traverse everything else, except comment nodes</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="p">}</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">elem</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">!==</span> <span class="mi">8</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">iterate</span><span class="p">(</span><span class="nx">elem</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>

  <span class="p">},</span>
    <span class="nx">isText</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">node</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">===</span> <span class="mi">3</span> <span class="o">||</span> <span class="nx">node</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">===</span> <span class="mi">4</span>
    <span class="p">},</span>
    <span class="nx">iteratorMaker</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">toChildren</span><span class="p">,</span> <span class="nx">toNext</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">mustMoveRight</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-163">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-163">&#182;</a>               </div>               <p>first try down</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">[</span><span class="nx">toChildren</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">mustMoveRight</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">isText</span><span class="p">(</span><span class="nx">node</span><span class="p">[</span><span class="nx">toChildren</span><span class="p">])</span> <span class="o">?</span> <span class="nx">node</span><span class="p">[</span><span class="nx">toChildren</span><span class="p">]</span> <span class="o">:</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">callee</span><span class="p">(</span><span class="nx">node</span><span class="p">[</span><span class="nx">toChildren</span><span class="p">])</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">[</span><span class="nx">toNext</span><span class="p">])</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">isText</span><span class="p">(</span><span class="nx">node</span><span class="p">[</span><span class="nx">toNext</span><span class="p">])</span> <span class="o">?</span> <span class="nx">node</span><span class="p">[</span><span class="nx">toNext</span><span class="p">]</span> <span class="o">:</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">callee</span><span class="p">(</span><span class="nx">node</span><span class="p">[</span><span class="nx">toNext</span><span class="p">])</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">callee</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">getNextTextNode</span> <span class="o">=</span> <span class="nx">iteratorMaker</span><span class="p">(</span><span class="s2">&quot;firstChild&quot;</span><span class="p">,</span> <span class="s2">&quot;nextSibling&quot;</span><span class="p">),</span>
    <span class="nx">getPrevTextNode</span> <span class="o">=</span> <span class="nx">iteratorMaker</span><span class="p">(</span><span class="s2">&quot;lastChild&quot;</span><span class="p">,</span> <span class="s2">&quot;previousSibling&quot;</span><span class="p">),</span>
    <span class="nx">callMove</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">container</span><span class="p">,</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">howMany</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">mover</span> <span class="o">=</span> <span class="nx">howMany</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="nx">getPrevTextNode</span> <span class="o">:</span> <span class="nx">getNextTextNode</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-164">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-164">&#182;</a>               </div>               <p>find the text element</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isText</span><span class="p">(</span><span class="nx">container</span><span class="p">))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-165">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-165">&#182;</a>               </div>               <p>sometimes offset isn't actually an element</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">container</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">[</span><span class="nx">offset</span><span class="p">]</span> <span class="o">?</span> <span class="nx">container</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">[</span><span class="nx">offset</span><span class="p">]</span> <span class="o">:</span></pre></div>             </td>           </tr>                               <tr id="section-166">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-166">&#182;</a>               </div>               <p>if this happens, use the last child</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">container</span><span class="p">.</span><span class="nx">lastChild</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isText</span><span class="p">(</span><span class="nx">container</span><span class="p">))</span> <span class="p">{</span>
          <span class="nx">container</span> <span class="o">=</span> <span class="nx">mover</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">move</span><span class="p">(</span><span class="nx">container</span><span class="p">,</span> <span class="nx">howMany</span><span class="p">)</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">offset</span> <span class="o">+</span> <span class="nx">howMany</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">move</span><span class="p">(</span><span class="nx">mover</span><span class="p">(</span><span class="nx">container</span><span class="p">),</span> <span class="nx">offset</span> <span class="o">+</span> <span class="nx">howMany</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">move</span><span class="p">(</span><span class="nx">container</span><span class="p">,</span> <span class="nx">offset</span> <span class="o">+</span> <span class="nx">howMany</span><span class="p">)</span>
        <span class="p">}</span>

      <span class="p">}</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-167">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-167">&#182;</a>               </div>               <p>Moves howMany characters from the start of
from</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">move</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">from</span><span class="p">,</span> <span class="nx">howMany</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">mover</span> <span class="o">=</span> <span class="nx">howMany</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="nx">getPrevTextNode</span> <span class="o">:</span> <span class="nx">getNextTextNode</span><span class="p">;</span>

      <span class="nx">howMany</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">howMany</span><span class="p">);</span>

      <span class="k">while</span> <span class="p">(</span><span class="nx">from</span> <span class="o">&amp;&amp;</span> <span class="nx">howMany</span> <span class="o">&gt;=</span> <span class="nx">from</span><span class="p">.</span><span class="nx">nodeValue</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">howMany</span> <span class="o">=</span> <span class="nx">howMany</span> <span class="o">-</span> <span class="nx">from</span><span class="p">.</span><span class="nx">nodeValue</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
        <span class="nx">from</span> <span class="o">=</span> <span class="nx">mover</span><span class="p">(</span><span class="nx">from</span><span class="p">)</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="p">{</span>
        <span class="nx">node</span><span class="o">:</span> <span class="nx">from</span><span class="p">,</span>
        <span class="nx">offset</span><span class="o">:</span> <span class="nx">mover</span> <span class="o">===</span> <span class="nx">getNextTextNode</span> <span class="o">?</span> <span class="nx">howMany</span> <span class="o">:</span> <span class="nx">from</span><span class="p">.</span><span class="nx">nodeValue</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="nx">howMany</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">supportWhitespace</span><span class="p">,</span> <span class="nx">isWhitespace</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">supportWhitespace</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">supportWhitespace</span> <span class="o">=</span> <span class="s1">&#39;isElementContentWhitespace&#39;</span> <span class="k">in</span> <span class="nx">el</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">supportWhitespace</span> <span class="o">?</span> <span class="nx">el</span><span class="p">.</span><span class="nx">isElementContentWhitespace</span> <span class="o">:</span> <span class="p">(</span><span class="nx">el</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">===</span> <span class="mi">3</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;&#39;</span> <span class="o">==</span> <span class="nx">el</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">trim</span><span class="p">()));</span>

    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-168">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-168">&#182;</a>               </div>               <p>if a point is within a rectangle</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">within</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">rect</span><span class="p">,</span> <span class="nx">point</span><span class="p">)</span> <span class="p">{</span>

      <span class="k">return</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">left</span> <span class="o">&lt;=</span> <span class="nx">point</span><span class="p">.</span><span class="nx">clientX</span> <span class="o">&amp;&amp;</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">width</span> <span class="o">&gt;=</span> <span class="nx">point</span><span class="p">.</span><span class="nx">clientX</span> <span class="o">&amp;&amp;</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">top</span> <span class="o">&lt;=</span> <span class="nx">point</span><span class="p">.</span><span class="nx">clientY</span> <span class="o">&amp;&amp;</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">height</span> <span class="o">&gt;=</span> <span class="nx">point</span><span class="p">.</span><span class="nx">clientY</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-169">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-169">&#182;</a>               </div>               <p>if a rectangle is within another rectangle</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">withinRect</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">outer</span><span class="p">,</span> <span class="nx">inner</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">within</span><span class="p">(</span><span class="nx">outer</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">clientX</span><span class="o">:</span> <span class="nx">inner</span><span class="p">.</span><span class="nx">left</span><span class="p">,</span>
        <span class="nx">clientY</span><span class="o">:</span> <span class="nx">inner</span><span class="p">.</span><span class="nx">top</span>
      <span class="p">})</span> <span class="o">&amp;&amp;</span> <span class="c1">//top left</span>
      <span class="nx">within</span><span class="p">(</span><span class="nx">outer</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">clientX</span><span class="o">:</span> <span class="nx">inner</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">inner</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span>
        <span class="nx">clientY</span><span class="o">:</span> <span class="nx">inner</span><span class="p">.</span><span class="nx">top</span>
      <span class="p">})</span> <span class="o">&amp;&amp;</span> <span class="c1">//top right</span>
      <span class="nx">within</span><span class="p">(</span><span class="nx">outer</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">clientX</span><span class="o">:</span> <span class="nx">inner</span><span class="p">.</span><span class="nx">left</span><span class="p">,</span>
        <span class="nx">clientY</span><span class="o">:</span> <span class="nx">inner</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">inner</span><span class="p">.</span><span class="nx">height</span>
      <span class="p">})</span> <span class="o">&amp;&amp;</span> <span class="c1">//bottom left</span>
      <span class="nx">within</span><span class="p">(</span><span class="nx">outer</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">clientX</span><span class="o">:</span> <span class="nx">inner</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">inner</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span>
        <span class="nx">clientY</span><span class="o">:</span> <span class="nx">inner</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">inner</span><span class="p">.</span><span class="nx">height</span>
      <span class="p">})</span> <span class="c1">//bottom right</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-170">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-170">&#182;</a>               </div>               <p>gets the scroll offset from a window</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">scrollOffset</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">win</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">win</span> <span class="o">=</span> <span class="nx">win</span> <span class="o">||</span> <span class="nb">window</span><span class="p">;</span>
      <span class="nx">doc</span> <span class="o">=</span> <span class="nx">win</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">,</span> <span class="nx">body</span> <span class="o">=</span> <span class="nx">win</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>

      <span class="k">return</span> <span class="p">{</span>
        <span class="nx">left</span><span class="o">:</span> <span class="p">(</span><span class="nx">doc</span> <span class="o">&amp;&amp;</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">scrollLeft</span> <span class="o">||</span> <span class="nx">body</span> <span class="o">&amp;&amp;</span> <span class="nx">body</span><span class="p">.</span><span class="nx">scrollLeft</span> <span class="o">||</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">clientLeft</span> <span class="o">||</span> <span class="mi">0</span><span class="p">),</span>
        <span class="nx">top</span><span class="o">:</span> <span class="p">(</span><span class="nx">doc</span> <span class="o">&amp;&amp;</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">scrollTop</span> <span class="o">||</span> <span class="nx">body</span> <span class="o">&amp;&amp;</span> <span class="nx">body</span><span class="p">.</span><span class="nx">scrollTop</span> <span class="o">||</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">clientTop</span> <span class="o">||</span> <span class="mi">0</span><span class="p">)</span>
      <span class="p">};</span>
    <span class="p">};</span>

  <span class="nx">support</span><span class="p">.</span><span class="nx">moveToPoint</span> <span class="o">=</span> <span class="o">!!</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Range</span><span class="p">().</span><span class="nx">range</span><span class="p">.</span><span class="nx">moveToPoint</span></pre></div>             </td>           </tr>                               <tr id="section-171">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-171">&#182;</a>               </div>               <h2>jquery/dom/selection/selection.js</h2>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">getWindow</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">element</span> <span class="o">?</span> <span class="nx">element</span><span class="p">.</span><span class="nx">ownerDocument</span><span class="p">.</span><span class="nx">defaultView</span> <span class="o">||</span> <span class="nx">element</span><span class="p">.</span><span class="nx">ownerDocument</span><span class="p">.</span><span class="nx">parentWindow</span> <span class="o">:</span> <span class="nb">window</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-172">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-172">&#182;</a>               </div>               <p>A helper that uses range to abstract out getting the current start and endPos.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">getElementsSelection</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">win</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-173">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-173">&#182;</a>               </div>               <p>get a copy of the current range and a range that spans the element</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">current</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Range</span><span class="p">.</span><span class="nx">current</span><span class="p">(</span><span class="nx">el</span><span class="p">).</span><span class="nx">clone</span><span class="p">(),</span>
        <span class="nx">entireElement</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Range</span><span class="p">(</span><span class="nx">el</span><span class="p">).</span><span class="nx">select</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-174">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-174">&#182;</a>               </div>               <p>if there is no overlap, there is nothing selected</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">current</span><span class="p">.</span><span class="nx">overlaps</span><span class="p">(</span><span class="nx">entireElement</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-175">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-175">&#182;</a>               </div>               <p>if the current range starts before our element</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">current</span><span class="p">.</span><span class="nx">compare</span><span class="p">(</span><span class="s2">&quot;START_TO_START&quot;</span><span class="p">,</span> <span class="nx">entireElement</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-176">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-176">&#182;</a>               </div>               <p>the selection within the element begins at 0</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">startPos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-177">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-177">&#182;</a>               </div>               <p>move the current range to start at our element</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">current</span><span class="p">.</span><span class="nx">move</span><span class="p">(</span><span class="s2">&quot;START_TO_START&quot;</span><span class="p">,</span> <span class="nx">entireElement</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-178">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-178">&#182;</a>               </div>               <p>Make a copy of the element's range.
Move it's end to the start of the selected range
The length of the copy is the start of the selected
range.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">fromElementToCurrent</span> <span class="o">=</span> <span class="nx">entireElement</span><span class="p">.</span><span class="nx">clone</span><span class="p">();</span>
        <span class="nx">fromElementToCurrent</span><span class="p">.</span><span class="nx">move</span><span class="p">(</span><span class="s2">&quot;END_TO_START&quot;</span><span class="p">,</span> <span class="nx">current</span><span class="p">);</span>
        <span class="nx">startPos</span> <span class="o">=</span> <span class="nx">fromElementToCurrent</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">length</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-179">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-179">&#182;</a>               </div>               <p>If the current range ends after our element</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">current</span><span class="p">.</span><span class="nx">compare</span><span class="p">(</span><span class="s2">&quot;END_TO_END&quot;</span><span class="p">,</span> <span class="nx">entireElement</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-180">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-180">&#182;</a>               </div>               <p>the end position is the last character</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">endPos</span> <span class="o">=</span> <span class="nx">entireElement</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">length</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-181">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-181">&#182;</a>               </div>               <p>otherwise, it's the start position plus the current range
TODO: this doesn't seem like it works if current
extends to the left of the element.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">endPos</span> <span class="o">=</span> <span class="nx">startPos</span> <span class="o">+</span> <span class="nx">current</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">length</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="p">{</span>
        <span class="nx">start</span><span class="o">:</span> <span class="nx">startPos</span><span class="p">,</span>
        <span class="nx">end</span><span class="o">:</span> <span class="nx">endPos</span><span class="p">,</span>
        <span class="nx">width</span><span class="o">:</span> <span class="nx">endPos</span> <span class="o">-</span> <span class="nx">startPos</span>
      <span class="p">};</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-182">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-182">&#182;</a>               </div>               <p>Text selection works differently for selection in an input vs
normal html elements like divs, spans, and ps.
This function branches between the various methods of getting the selection.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">getSelection</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">win</span> <span class="o">=</span> <span class="nx">getWindow</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-183">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-183">&#182;</a>               </div>               <p><code>selectionStart</code> means this is an input element in a standards browser.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">el</span><span class="p">.</span><span class="nx">selectionStart</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">activeElement</span> <span class="o">&amp;&amp;</span> <span class="nb">document</span><span class="p">.</span><span class="nx">activeElement</span> <span class="o">!=</span> <span class="nx">el</span> <span class="o">&amp;&amp;</span> <span class="nx">el</span><span class="p">.</span><span class="nx">selectionStart</span> <span class="o">==</span> <span class="nx">el</span><span class="p">.</span><span class="nx">selectionEnd</span> <span class="o">&amp;&amp;</span> <span class="nx">el</span><span class="p">.</span><span class="nx">selectionStart</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="p">{</span>
            <span class="nx">start</span><span class="o">:</span> <span class="nx">el</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
            <span class="nx">end</span><span class="o">:</span> <span class="nx">el</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
            <span class="nx">width</span><span class="o">:</span> <span class="mi">0</span>
          <span class="p">};</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="p">{</span>
          <span class="nx">start</span><span class="o">:</span> <span class="nx">el</span><span class="p">.</span><span class="nx">selectionStart</span><span class="p">,</span>
          <span class="nx">end</span><span class="o">:</span> <span class="nx">el</span><span class="p">.</span><span class="nx">selectionEnd</span><span class="p">,</span>
          <span class="nx">width</span><span class="o">:</span> <span class="nx">el</span><span class="p">.</span><span class="nx">selectionEnd</span> <span class="o">-</span> <span class="nx">el</span><span class="p">.</span><span class="nx">selectionStart</span>
        <span class="p">};</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-184">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-184">&#182;</a>               </div>               <p>getSelection means a 'normal' element in a standards browser.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">win</span><span class="p">.</span><span class="nx">getSelection</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">getElementsSelection</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">win</span><span class="p">)</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-185">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-185">&#182;</a>               </div>               <p>IE will freak out, where there is no way to detect it, so we provide a callback if it does.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">try</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-186">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-186">&#182;</a>               </div>               <p>The following typically works for input elements in IE:</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">if</span> <span class="p">(</span><span class="nx">el</span><span class="p">.</span><span class="nx">nodeName</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;input&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">real</span> <span class="o">=</span> <span class="nx">getWindow</span><span class="p">(</span><span class="nx">el</span><span class="p">).</span><span class="nb">document</span><span class="p">.</span><span class="nx">selection</span><span class="p">.</span><span class="nx">createRange</span><span class="p">(),</span>
              <span class="nx">r</span> <span class="o">=</span> <span class="nx">el</span><span class="p">.</span><span class="nx">createTextRange</span><span class="p">();</span>
            <span class="nx">r</span><span class="p">.</span><span class="nx">setEndPoint</span><span class="p">(</span><span class="s2">&quot;EndToStart&quot;</span><span class="p">,</span> <span class="nx">real</span><span class="p">);</span>

            <span class="kd">var</span> <span class="nx">start</span> <span class="o">=</span> <span class="nx">r</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">length</span>
            <span class="k">return</span> <span class="p">{</span>
              <span class="nx">start</span><span class="o">:</span> <span class="nx">start</span><span class="p">,</span>
              <span class="nx">end</span><span class="o">:</span> <span class="nx">start</span> <span class="o">+</span> <span class="nx">real</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
              <span class="nx">width</span><span class="o">:</span> <span class="nx">real</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">length</span>
            <span class="p">}</span>
          <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-187">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-187">&#182;</a>               </div>               <p>This works on textareas and other elements</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">else</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">getElementsSelection</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">win</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">return</span> <span class="nx">res</span><span class="p">;</span>
            <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-188">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-188">&#182;</a>               </div>               <p>we have to clean up for ie's textareas which don't count for 
newlines correctly</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="kd">var</span> <span class="nx">current</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Range</span><span class="p">.</span><span class="nx">current</span><span class="p">().</span><span class="nx">clone</span><span class="p">(),</span>
              <span class="nx">r2</span> <span class="o">=</span> <span class="nx">current</span><span class="p">.</span><span class="nx">clone</span><span class="p">().</span><span class="nx">collapse</span><span class="p">().</span><span class="nx">range</span><span class="p">,</span>
              <span class="nx">r3</span> <span class="o">=</span> <span class="nx">current</span><span class="p">.</span><span class="nx">clone</span><span class="p">().</span><span class="nx">collapse</span><span class="p">(</span><span class="kc">false</span><span class="p">).</span><span class="nx">range</span><span class="p">;</span>

            <span class="nx">r2</span><span class="p">.</span><span class="nx">moveStart</span><span class="p">(</span><span class="s1">&#39;character&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="nx">r3</span><span class="p">.</span><span class="nx">moveStart</span><span class="p">(</span><span class="s1">&#39;character&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-189">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-189">&#182;</a>               </div>               <p>if we aren't at the start, but previous is empty, we are at start of newline</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">startPos</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">r2</span><span class="p">.</span><span class="nx">text</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">res</span><span class="p">.</span><span class="nx">startPos</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
            <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-190">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-190">&#182;</a>               </div>               <p>do a similar thing for the end of the textarea</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">endPos</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">r3</span><span class="p">.</span><span class="nx">text</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">res</span><span class="p">.</span><span class="nx">endPos</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="nx">res</span>
          <span class="p">}</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="p">{</span>
            <span class="nx">start</span><span class="o">:</span> <span class="nx">el</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
            <span class="nx">end</span><span class="o">:</span> <span class="nx">el</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
            <span class="nx">width</span><span class="o">:</span> <span class="mi">0</span>
          <span class="p">};</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-191">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-191">&#182;</a>               </div>               <p>Selects text within an element.  Depending if it's a form element or
not, or a standards based browser or not, we do different things.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">select</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">start</span><span class="p">,</span> <span class="nx">end</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">win</span> <span class="o">=</span> <span class="nx">getWindow</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-192">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-192">&#182;</a>               </div>               <p>IE behaves bad even if it sorta supports
getSelection so we have to try the IE methods first. barf.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">el</span><span class="p">.</span><span class="nx">setSelectionRange</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">end</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">el</span><span class="p">.</span><span class="nx">focus</span><span class="p">();</span>
          <span class="nx">el</span><span class="p">.</span><span class="nx">setSelectionRange</span><span class="p">(</span><span class="nx">start</span><span class="p">,</span> <span class="nx">start</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">el</span><span class="p">.</span><span class="nx">select</span><span class="p">();</span>
          <span class="nx">el</span><span class="p">.</span><span class="nx">selectionStart</span> <span class="o">=</span> <span class="nx">start</span><span class="p">;</span>
          <span class="nx">el</span><span class="p">.</span><span class="nx">selectionEnd</span> <span class="o">=</span> <span class="nx">end</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">el</span><span class="p">.</span><span class="nx">createTextRange</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">el</span><span class="p">.</span><span class="nx">createTextRange</span><span class="p">();</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">moveStart</span><span class="p">(</span><span class="s1">&#39;character&#39;</span><span class="p">,</span> <span class="nx">start</span><span class="p">);</span>
        <span class="nx">end</span> <span class="o">=</span> <span class="nx">end</span> <span class="o">||</span> <span class="nx">start</span><span class="p">;</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">moveEnd</span><span class="p">(</span><span class="s1">&#39;character&#39;</span><span class="p">,</span> <span class="nx">end</span> <span class="o">-</span> <span class="nx">el</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>

        <span class="nx">r</span><span class="p">.</span><span class="nx">select</span><span class="p">();</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">win</span><span class="p">.</span><span class="nx">getSelection</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">doc</span> <span class="o">=</span> <span class="nx">win</span><span class="p">.</span><span class="nb">document</span><span class="p">,</span>
          <span class="nx">sel</span> <span class="o">=</span> <span class="nx">win</span><span class="p">.</span><span class="nx">getSelection</span><span class="p">(),</span>
          <span class="nx">range</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">createRange</span><span class="p">(),</span>
          <span class="nx">ranges</span> <span class="o">=</span> <span class="p">[</span><span class="nx">start</span><span class="p">,</span> <span class="nx">end</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">?</span> <span class="nx">end</span> <span class="o">:</span> <span class="nx">start</span><span class="p">];</span>
        <span class="nx">getCharElement</span><span class="p">([</span><span class="nx">el</span><span class="p">],</span> <span class="nx">ranges</span><span class="p">);</span>
        <span class="nx">range</span><span class="p">.</span><span class="nx">setStart</span><span class="p">(</span><span class="nx">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">el</span><span class="p">,</span> <span class="nx">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">count</span><span class="p">);</span>
        <span class="nx">range</span><span class="p">.</span><span class="nx">setEnd</span><span class="p">(</span><span class="nx">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">el</span><span class="p">,</span> <span class="nx">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">count</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-193">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-193">&#182;</a>               </div>               <p>removeAllRanges is necessary for webkit</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">sel</span><span class="p">.</span><span class="nx">removeAllRanges</span><span class="p">();</span>
        <span class="nx">sel</span><span class="p">.</span><span class="nx">addRange</span><span class="p">(</span><span class="nx">range</span><span class="p">);</span>

      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">win</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">createTextRange</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//IE&#39;s weirdness</span>
        <span class="kd">var</span> <span class="nx">range</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">createTextRange</span><span class="p">();</span>
        <span class="nx">range</span><span class="p">.</span><span class="nx">moveToElementText</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span>
        <span class="nx">range</span><span class="p">.</span><span class="nx">collapse</span><span class="p">()</span>
        <span class="nx">range</span><span class="p">.</span><span class="nx">moveStart</span><span class="p">(</span><span class="s1">&#39;character&#39;</span><span class="p">,</span> <span class="nx">start</span><span class="p">)</span>
        <span class="nx">range</span><span class="p">.</span><span class="nx">moveEnd</span><span class="p">(</span><span class="s1">&#39;character&#39;</span><span class="p">,</span> <span class="nx">end</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">?</span> <span class="nx">end</span> <span class="o">:</span> <span class="nx">start</span><span class="p">)</span>
        <span class="nx">range</span><span class="p">.</span><span class="nx">select</span><span class="p">();</span>
      <span class="p">}</span>

    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-194">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-194">&#182;</a>               </div>               <p>If one of the range values is within start and len, replace the range
value with the element and its offset.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">replaceWithLess</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">start</span><span class="p">,</span> <span class="nx">len</span><span class="p">,</span> <span class="nx">range</span><span class="p">,</span> <span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;number&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
          <span class="nx">el</span><span class="o">:</span> <span class="nx">el</span><span class="p">,</span>
          <span class="nx">count</span><span class="o">:</span> <span class="nx">range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="nx">start</span>
        <span class="p">};</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;number&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="nx">len</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
          <span class="nx">el</span><span class="o">:</span> <span class="nx">el</span><span class="p">,</span>
          <span class="nx">count</span><span class="o">:</span> <span class="nx">range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="nx">start</span>
        <span class="p">};</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">getCharElement</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">elems</span><span class="p">,</span> <span class="nx">range</span><span class="p">,</span> <span class="nx">len</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">elem</span><span class="p">,</span> <span class="nx">start</span><span class="p">;</span>

      <span class="nx">len</span> <span class="o">=</span> <span class="nx">len</span> <span class="o">||</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">elems</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">elem</span> <span class="o">=</span> <span class="nx">elems</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span></pre></div>             </td>           </tr>                               <tr id="section-195">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-195">&#182;</a>               </div>               <p>Get the text from text nodes and CDATA nodes</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">elem</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">===</span> <span class="mi">3</span> <span class="o">||</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">===</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">start</span> <span class="o">=</span> <span class="nx">len</span>
          <span class="nx">len</span> <span class="o">+=</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">nodeValue</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-196">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-196">&#182;</a>               </div>               <p>check if len is now greater than what's in counts</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">replaceWithLess</span><span class="p">(</span><span class="nx">start</span><span class="p">,</span> <span class="nx">len</span><span class="p">,</span> <span class="nx">range</span><span class="p">,</span> <span class="nx">elem</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-197">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-197">&#182;</a>               </div>               <p>Traverse everything else, except comment nodes</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">elem</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">!==</span> <span class="mi">8</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">len</span> <span class="o">=</span> <span class="nx">getCharElement</span><span class="p">(</span><span class="nx">elem</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">,</span> <span class="nx">range</span><span class="p">,</span> <span class="nx">len</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">len</span><span class="p">;</span>
    <span class="p">};</span>

  <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">selection</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">start</span><span class="p">,</span> <span class="nx">end</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">start</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">select</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">start</span><span class="p">,</span> <span class="nx">end</span><span class="p">)</span>
      <span class="p">})</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">getSelection</span><span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-198">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-198">&#182;</a>               </div>               <p>for testing</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">selection</span><span class="p">.</span><span class="nx">getCharElement</span> <span class="o">=</span> <span class="nx">getCharElement</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-199">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-199">&#182;</a>               </div>               <h2>jquery/dom/within/within.js</h2>

<p>Checks if x and y coordinates are within a box with left, top, width and height</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">withinBox</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">left</span><span class="p">,</span> <span class="nx">top</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">y</span> <span class="o">&gt;=</span> <span class="nx">top</span> <span class="o">&amp;&amp;</span> <span class="nx">y</span> <span class="o">&lt;</span> <span class="nx">top</span> <span class="o">+</span> <span class="nx">height</span> <span class="o">&amp;&amp;</span> <span class="nx">x</span> <span class="o">&gt;=</span> <span class="nx">left</span> <span class="o">&amp;&amp;</span> <span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">left</span> <span class="o">+</span> <span class="nx">width</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">within</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">left</span><span class="p">,</span> <span class="nx">top</span><span class="p">,</span> <span class="nx">useOffsetCache</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">q</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

      <span class="k">if</span> <span class="p">(</span><span class="k">this</span> <span class="o">==</span> <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">ret</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-200">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-200">&#182;</a>               </div>               <p>uses either the cached offset or .offset()</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">offset</span> <span class="o">=</span> <span class="nx">useOffsetCache</span> <span class="o">?</span> <span class="nx">$</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s2">&quot;offsetCache&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="nx">$</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s2">&quot;offsetCache&quot;</span><span class="p">,</span> <span class="nx">q</span><span class="p">.</span><span class="nx">offset</span><span class="p">())</span> <span class="o">:</span> <span class="nx">q</span><span class="p">.</span><span class="nx">offset</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-201">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-201">&#182;</a>               </div>               <p>Check if the given coordinates are within the area of the current element</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">withinBox</span><span class="p">(</span><span class="nx">left</span><span class="p">,</span> <span class="nx">top</span><span class="p">,</span> <span class="nx">offset</span><span class="p">.</span><span class="nx">left</span><span class="p">,</span> <span class="nx">offset</span><span class="p">.</span><span class="nx">top</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">offsetWidth</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">offsetHeight</span><span class="p">);</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-202">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-202">&#182;</a>               </div>               <p>Add it to the results</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">ret</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>

    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">pushStack</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">unique</span><span class="p">(</span><span class="nx">ret</span><span class="p">),</span> <span class="s2">&quot;within&quot;</span><span class="p">,</span> <span class="nx">left</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nx">top</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">withinBox</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">left</span><span class="p">,</span> <span class="nx">top</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">,</span> <span class="nx">useOffsetCache</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">q</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

      <span class="k">if</span> <span class="p">(</span><span class="k">this</span> <span class="o">==</span> <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">)</span> <span class="k">return</span> <span class="nx">ret</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-203">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-203">&#182;</a>               </div>               <p>use cached offset or .offset()</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">offset</span> <span class="o">=</span> <span class="nx">useOffsetCache</span> <span class="o">?</span> <span class="nx">$</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="nx">$</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">,</span> <span class="nx">q</span><span class="p">.</span><span class="nx">offset</span><span class="p">())</span> <span class="o">:</span> <span class="nx">q</span><span class="p">.</span><span class="nx">offset</span><span class="p">();</span>

      <span class="kd">var</span> <span class="nx">ew</span> <span class="o">=</span> <span class="nx">q</span><span class="p">.</span><span class="nx">width</span><span class="p">(),</span>
        <span class="nx">eh</span> <span class="o">=</span> <span class="nx">q</span><span class="p">.</span><span class="nx">height</span><span class="p">(),</span></pre></div>             </td>           </tr>                               <tr id="section-204">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-204">&#182;</a>               </div>               <p>Checks if the element offset is within the given box</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">res</span> <span class="o">=</span> <span class="o">!</span><span class="p">((</span><span class="nx">offset</span><span class="p">.</span><span class="nx">top</span> <span class="o">&gt;</span> <span class="nx">top</span> <span class="o">+</span> <span class="nx">height</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">offset</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">eh</span> <span class="o">&lt;</span> <span class="nx">top</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">offset</span><span class="p">.</span><span class="nx">left</span> <span class="o">&gt;</span> <span class="nx">left</span> <span class="o">+</span> <span class="nx">width</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">offset</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">ew</span> <span class="o">&lt;</span> <span class="nx">left</span><span class="p">));</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="nx">ret</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">pushStack</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">unique</span><span class="p">(</span><span class="nx">ret</span><span class="p">),</span> <span class="s2">&quot;withinBox&quot;</span><span class="p">,</span> <span class="nx">$</span><span class="p">.</span><span class="nx">makeArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">));</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-205">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-205">&#182;</a>               </div>               <h2>jquery/event/default/default.js</h2>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">triggerAsync</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">success</span><span class="p">,</span> <span class="nx">prevented</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">data</span> <span class="o">==</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">prevented</span> <span class="o">=</span> <span class="nx">success</span><span class="p">;</span>
      <span class="nx">success</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
      <span class="nx">data</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">el</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-206">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-206">&#182;</a>               </div>               <p>Trigger the event with the success callback as the success handler
when triggerAsync called within another triggerAsync,it's the same tick time so we should use timeout
http://javascriptweblog.wordpress.com/2010/06/28/understanding-javascript-timers/</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">el</span><span class="p">.</span><span class="nx">trigger</span><span class="p">({</span>
          <span class="nx">type</span><span class="o">:</span> <span class="nx">type</span><span class="p">,</span>
          <span class="nx">_success</span><span class="o">:</span> <span class="nx">success</span><span class="p">,</span>
          <span class="nx">_prevented</span><span class="o">:</span> <span class="nx">prevented</span>
        <span class="p">},</span> <span class="nx">data</span><span class="p">);</span>
      <span class="p">},</span> <span class="mi">0</span><span class="p">);</span>

    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-207">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-207">&#182;</a>               </div>               <p>If we have no elements call the success callback right away</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">success</span><span class="p">)</span> <span class="nx">success</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-208">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-208">&#182;</a>               </div>               <p>cache default types for performance</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">types</span> <span class="o">=</span> <span class="p">{},</span>
    <span class="nx">rnamespaces</span> <span class="o">=</span> <span class="sr">/\.(.*)$/</span><span class="p">,</span>
    <span class="nx">$event</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">event</span><span class="p">;</span>

  <span class="nx">$event</span><span class="p">.</span><span class="nx">special</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">add</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">handleObj</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-209">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-209">&#182;</a>               </div>               <p>save the type</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">types</span><span class="p">[</span><span class="nx">handleObj</span><span class="p">.</span><span class="nx">namespace</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">rnamespaces</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">setup</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">true</span>
    <span class="p">}</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-210">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-210">&#182;</a>               </div>               <p>overwrite trigger to allow default types</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">oldTrigger</span> <span class="o">=</span> <span class="nx">$event</span><span class="p">.</span><span class="nx">trigger</span><span class="p">;</span>

  <span class="nx">$event</span><span class="p">.</span><span class="nx">trigger</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">defaultTriggerer</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">elem</span><span class="p">,</span> <span class="nx">onlyHandlers</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-211">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-211">&#182;</a>               </div>               <p>Event object or event type</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">type</span> <span class="o">||</span> <span class="nx">event</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-212">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-212">&#182;</a>               </div>               <p>Caller can pass in an Event, Object, or just an event type string</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">event</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">event</span> <span class="o">===</span> <span class="s2">&quot;object&quot;</span> <span class="o">?</span></pre></div>             </td>           </tr>                               <tr id="section-213">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-213">&#182;</a>               </div>               <p>jQuery.Event object</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">event</span><span class="p">[</span><span class="nx">$</span><span class="p">.</span><span class="nx">expando</span><span class="p">]</span> <span class="o">?</span> <span class="nx">event</span> <span class="o">:</span></pre></div>             </td>           </tr>                               <tr id="section-214">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-214">&#182;</a>               </div>               <p>Object literal</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">new</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Event</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">event</span><span class="p">)</span> <span class="o">:</span></pre></div>             </td>           </tr>                               <tr id="section-215">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-215">&#182;</a>               </div>               <p>Just the event type (string)</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">new</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Event</span><span class="p">(</span><span class="nx">type</span><span class="p">),</span>
      <span class="nx">res</span> <span class="o">=</span> <span class="nx">oldTrigger</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">event</span><span class="p">,</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">elem</span><span class="p">,</span> <span class="nx">onlyHandlers</span><span class="p">),</span>
      <span class="nx">paused</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">isPaused</span> <span class="o">&amp;&amp;</span> <span class="nx">event</span><span class="p">.</span><span class="nx">isPaused</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">onlyHandlers</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">event</span><span class="p">.</span><span class="nx">isDefaultPrevented</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="nx">event</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;default&quot;</span><span class="p">)</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-216">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-216">&#182;</a>               </div>               <p>Trigger the default. event</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">oldTrigger</span><span class="p">(</span><span class="s2">&quot;default.&quot;</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">type</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">elem</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">_success</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">_success</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">onlyHandlers</span> <span class="o">&amp;&amp;</span> <span class="nx">event</span><span class="p">.</span><span class="nx">isDefaultPrevented</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="nx">event</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;default&quot;</span><span class="p">)</span> <span class="o">!==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">paused</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">_prevented</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">_prevented</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-217">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-217">&#182;</a>               </div>               <p>code for paused</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">paused</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-218">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-218">&#182;</a>               </div>               <p>set back original stuff</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">event</span><span class="p">.</span><span class="nx">isDefaultPrevented</span> <span class="o">=</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">pausedState</span><span class="p">.</span><span class="nx">isDefaultPrevented</span><span class="p">;</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">isPropagationStopped</span> <span class="o">=</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">pausedState</span><span class="p">.</span><span class="nx">isPropagationStopped</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">res</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-219">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-219">&#182;</a>               </div>               <h2>jquery/event/destroyed/destroyed.js</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-220">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-220">&#182;</a>               </div>               <p>Store the old jQuery.cleanData</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">oldClean</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">cleanData</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-221">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-221">&#182;</a>               </div>               <p>Overwrites cleanData which is called by jQuery on manipulation methods</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">$</span><span class="p">.</span><span class="nx">cleanData</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">elems</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">elem</span><span class="p">;</span>
    <span class="p">(</span><span class="nx">elem</span> <span class="o">=</span> <span class="nx">elems</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-222">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-222">&#182;</a>               </div>               <p>Trigger the destroyed event</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">$</span><span class="p">(</span><span class="nx">elem</span><span class="p">).</span><span class="nx">triggerHandler</span><span class="p">(</span><span class="s2">&quot;destroyed&quot;</span><span class="p">);</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-223">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-223">&#182;</a>               </div>               <p>Call the old jQuery.cleanData</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">oldClean</span><span class="p">(</span><span class="nx">elems</span><span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-224">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-224">&#182;</a>               </div>               <h2>jquery/lang/vector/vector.js</h2>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">getSetZero</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">v</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">?</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">array</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span><span class="p">)</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">array</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="p">},</span>
    <span class="nx">getSetOne</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">v</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">?</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">array</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span><span class="p">)</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">array</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="p">};</span>

  <span class="nx">$</span><span class="p">.</span><span class="nx">Vector</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">arr</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">array</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">arr</span><span class="p">)</span> <span class="o">?</span> <span class="nx">arr</span> <span class="o">:</span> <span class="nx">$</span><span class="p">.</span><span class="nx">makeArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">array</span><span class="p">);</span>
  <span class="p">};</span>
  <span class="nx">$</span><span class="p">.</span><span class="nx">Vector</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span>

  <span class="p">{</span>

    <span class="nx">app</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">newArr</span> <span class="o">=</span> <span class="p">[];</span>

      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">array</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">newArr</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">f</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">array</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">i</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Vector</span><span class="p">(</span><span class="nx">newArr</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">plus</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">instanceof</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Vector</span> <span class="o">?</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">array</span> <span class="o">:</span> <span class="nx">$</span><span class="p">.</span><span class="nx">makeArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">),</span>
        <span class="nx">arr</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">array</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
        <span class="nx">vec</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Vector</span><span class="p">();</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">args</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">?</span> <span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="nx">args</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">vec</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">arr</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">minus</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">instanceof</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Vector</span> <span class="o">?</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">array</span> <span class="o">:</span> <span class="nx">$</span><span class="p">.</span><span class="nx">makeArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">),</span>
        <span class="nx">arr</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">array</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
        <span class="nx">vec</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Vector</span><span class="p">();</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">args</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">?</span> <span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="nx">args</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">vec</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">arr</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">equals</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">instanceof</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Vector</span> <span class="o">?</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">array</span> <span class="o">:</span> <span class="nx">$</span><span class="p">.</span><span class="nx">makeArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">),</span>
        <span class="nx">arr</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">array</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
        <span class="nx">vec</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Vector</span><span class="p">();</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">args</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">!=</span> <span class="nx">args</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="p">{</span>
          <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">vec</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">arr</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">x</span><span class="o">:</span> <span class="nx">getSetZero</span><span class="p">,</span>

    <span class="nx">left</span><span class="o">:</span> <span class="nx">getSetZero</span><span class="p">,</span>

    <span class="nx">width</span><span class="o">:</span> <span class="nx">getSetZero</span><span class="p">,</span>

    <span class="nx">y</span><span class="o">:</span> <span class="nx">getSetOne</span><span class="p">,</span>

    <span class="nx">top</span><span class="o">:</span> <span class="nx">getSetOne</span><span class="p">,</span>

    <span class="nx">height</span><span class="o">:</span> <span class="nx">getSetOne</span><span class="p">,</span>

    <span class="nx">toString</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">array</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">update</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">array</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">i</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">array</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">array</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">array</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">array</span> <span class="o">=</span> <span class="nx">array</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">array</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">array</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="nx">$</span><span class="p">.</span><span class="nx">Event</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">vector</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-225">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-225">&#182;</a>               </div>               <p>Get the first touch element for touch events</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">touches</span> <span class="o">=</span> <span class="s2">&quot;ontouchend&quot;</span> <span class="k">in</span> <span class="nb">document</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">originalEvent</span><span class="p">.</span><span class="nx">touches</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">originalEvent</span><span class="p">.</span><span class="nx">touches</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">originalEvent</span><span class="p">.</span><span class="nx">changedTouches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">:</span> <span class="k">this</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">originalEvent</span><span class="p">.</span><span class="nx">synthetic</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">doc</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">,</span>
        <span class="nx">body</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Vector</span><span class="p">(</span><span class="nx">touches</span><span class="p">.</span><span class="nx">clientX</span> <span class="o">+</span> <span class="p">(</span><span class="nx">doc</span> <span class="o">&amp;&amp;</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">scrollLeft</span> <span class="o">||</span> <span class="nx">body</span> <span class="o">&amp;&amp;</span> <span class="nx">body</span><span class="p">.</span><span class="nx">scrollLeft</span> <span class="o">||</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">clientLeft</span> <span class="o">||</span> <span class="mi">0</span><span class="p">),</span> <span class="nx">touches</span><span class="p">.</span><span class="nx">clientY</span> <span class="o">+</span> <span class="p">(</span><span class="nx">doc</span> <span class="o">&amp;&amp;</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">scrollTop</span> <span class="o">||</span> <span class="nx">body</span> <span class="o">&amp;&amp;</span> <span class="nx">body</span><span class="p">.</span><span class="nx">scrollTop</span> <span class="o">||</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">clientTop</span> <span class="o">||</span> <span class="mi">0</span><span class="p">));</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Vector</span><span class="p">(</span><span class="nx">touches</span><span class="p">.</span><span class="nx">pageX</span><span class="p">,</span> <span class="nx">touches</span><span class="p">.</span><span class="nx">pageY</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">offsetv</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="nb">window</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Vector</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">pageXOffset</span> <span class="o">?</span> <span class="nb">window</span><span class="p">.</span><span class="nx">pageXOffset</span> <span class="o">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">scrollLeft</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">pageYOffset</span> <span class="o">?</span> <span class="nb">window</span><span class="p">.</span><span class="nx">pageYOffset</span> <span class="o">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">scrollTop</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">offset</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">offset</span><span class="p">();</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Vector</span><span class="p">(</span><span class="nx">offset</span><span class="p">.</span><span class="nx">left</span><span class="p">,</span> <span class="nx">offset</span><span class="p">.</span><span class="nx">top</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">dimensionsv</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">which</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="nb">window</span> <span class="o">||</span> <span class="o">!</span><span class="nx">which</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Vector</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">width</span><span class="p">(),</span> <span class="k">this</span><span class="p">.</span><span class="nx">height</span><span class="p">());</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Vector</span><span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="nx">which</span> <span class="o">+</span> <span class="s2">&quot;Width&quot;</span><span class="p">](),</span> <span class="k">this</span><span class="p">[</span><span class="nx">which</span> <span class="o">+</span> <span class="s2">&quot;Height&quot;</span><span class="p">]());</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-226">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-226">&#182;</a>               </div>               <h2>jquery/event/livehack/livehack.js</h2>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">event</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">event</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-227">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-227">&#182;</a>               </div>               <p>helper that finds handlers by type and calls back a function, this is basically handle
events - the events object
types - an array of event types to look for
callback(type, handlerFunc, selector) - a callback
selector - an optional selector to filter with, if there, matches by selector
    if null, matches anything, otherwise, matches with no selector</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">findHelper</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">events</span><span class="p">,</span> <span class="nx">types</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">selector</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">t</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">typeHandlers</span><span class="p">,</span> <span class="nx">all</span><span class="p">,</span> <span class="nx">h</span><span class="p">,</span> <span class="nx">handle</span><span class="p">,</span> <span class="nx">namespaces</span><span class="p">,</span> <span class="nx">namespace</span><span class="p">,</span> <span class="nx">match</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">t</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">t</span> <span class="o">&lt;</span> <span class="nx">types</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">t</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">type</span> <span class="o">=</span> <span class="nx">types</span><span class="p">[</span><span class="nx">t</span><span class="p">];</span>
        <span class="nx">all</span> <span class="o">=</span> <span class="nx">type</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">all</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">namespaces</span> <span class="o">=</span> <span class="nx">type</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">);</span>
          <span class="nx">type</span> <span class="o">=</span> <span class="nx">namespaces</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
          <span class="nx">namespace</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;(^|\\.)&quot;</span> <span class="o">+</span> <span class="nx">namespaces</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">sort</span><span class="p">().</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\\.(?:.*\\.)?&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;(\\.|$)&quot;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">typeHandlers</span> <span class="o">=</span> <span class="p">(</span><span class="nx">events</span><span class="p">[</span><span class="nx">type</span><span class="p">]</span> <span class="o">||</span> <span class="p">[]).</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

        <span class="k">for</span> <span class="p">(</span><span class="nx">h</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">h</span> <span class="o">&lt;</span> <span class="nx">typeHandlers</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">h</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">handle</span> <span class="o">=</span> <span class="nx">typeHandlers</span><span class="p">[</span><span class="nx">h</span><span class="p">];</span>

          <span class="nx">match</span> <span class="o">=</span> <span class="p">(</span><span class="nx">all</span> <span class="o">||</span> <span class="nx">namespace</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">handle</span><span class="p">.</span><span class="nx">namespace</span><span class="p">));</span>

          <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">selector</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">if</span> <span class="p">(</span><span class="nx">handle</span><span class="p">.</span><span class="nx">selector</span> <span class="o">===</span> <span class="nx">selector</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">callback</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">handle</span><span class="p">.</span><span class="nx">origHandler</span> <span class="o">||</span> <span class="nx">handle</span><span class="p">.</span><span class="nx">handler</span><span class="p">);</span>
              <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">selector</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">callback</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">handle</span><span class="p">.</span><span class="nx">origHandler</span> <span class="o">||</span> <span class="nx">handle</span><span class="p">.</span><span class="nx">handler</span><span class="p">,</span> <span class="nx">handle</span><span class="p">.</span><span class="nx">selector</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">handle</span><span class="p">.</span><span class="nx">selector</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">callback</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">handle</span><span class="p">.</span><span class="nx">origHandler</span> <span class="o">||</span> <span class="nx">handle</span><span class="p">.</span><span class="nx">handler</span><span class="p">);</span>

            <span class="p">}</span>
          <span class="p">}</span>


        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">};</span>


  <span class="nx">event</span><span class="p">.</span><span class="nx">find</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">types</span><span class="p">,</span> <span class="nx">selector</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">events</span> <span class="o">=</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">_data</span><span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="o">||</span> <span class="p">{}).</span><span class="nx">events</span><span class="p">,</span>
      <span class="nx">handlers</span> <span class="o">=</span> <span class="p">[],</span>
      <span class="nx">t</span><span class="p">,</span> <span class="nx">liver</span><span class="p">,</span> <span class="nx">live</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">events</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">handlers</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">findHelper</span><span class="p">(</span><span class="nx">events</span><span class="p">,</span> <span class="nx">types</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">handler</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">handlers</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">handler</span><span class="p">);</span>
    <span class="p">},</span> <span class="nx">selector</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">handlers</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="nx">event</span><span class="p">.</span><span class="nx">findBySelector</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">types</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">events</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">_data</span><span class="p">(</span><span class="nx">el</span><span class="p">).</span><span class="nx">events</span><span class="p">,</span>
      <span class="nx">selectors</span> <span class="o">=</span> <span class="p">{},</span></pre></div>             </td>           </tr>                               <tr id="section-228">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-228">&#182;</a>               </div>               <p>adds a handler for a given selector and event</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">add</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">selector</span><span class="p">,</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">handler</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">select</span> <span class="o">=</span> <span class="nx">selectors</span><span class="p">[</span><span class="nx">selector</span><span class="p">]</span> <span class="o">||</span> <span class="p">(</span><span class="nx">selectors</span><span class="p">[</span><span class="nx">selector</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}),</span>
          <span class="nx">events</span> <span class="o">=</span> <span class="nx">select</span><span class="p">[</span><span class="nx">event</span><span class="p">]</span> <span class="o">||</span> <span class="p">(</span><span class="nx">select</span><span class="p">[</span><span class="nx">event</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]);</span>
        <span class="nx">events</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">handler</span><span class="p">);</span>
      <span class="p">};</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">events</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">selectors</span><span class="p">;</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-229">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-229">&#182;</a>               </div>               <p>first check live:
then check straight binds</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">findHelper</span><span class="p">(</span><span class="nx">events</span><span class="p">,</span> <span class="nx">types</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">handler</span><span class="p">,</span> <span class="nx">selector</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">add</span><span class="p">(</span><span class="nx">selector</span> <span class="o">||</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">handler</span><span class="p">);</span>
    <span class="p">},</span> <span class="kc">null</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">selectors</span><span class="p">;</span>
  <span class="p">};</span>
  <span class="nx">event</span><span class="p">.</span><span class="nx">supportTouch</span> <span class="o">=</span> <span class="s2">&quot;ontouchend&quot;</span> <span class="k">in</span> <span class="nb">document</span><span class="p">;</span>

  <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">respondsTo</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">events</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-230">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-230">&#182;</a>               </div>               <p>add default ?</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">return</span> <span class="nx">event</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">$</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">events</span><span class="p">)</span> <span class="o">?</span> <span class="nx">events</span> <span class="o">:</span> <span class="p">[</span><span class="nx">events</span><span class="p">]).</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">triggerHandled</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">event</span> <span class="o">=</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">event</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span> <span class="o">?</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Event</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">:</span> <span class="nx">event</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">event</span><span class="p">.</span><span class="nx">handled</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="nx">event</span><span class="p">.</span><span class="nx">setupHelper</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">types</span><span class="p">,</span> <span class="nx">startingEvent</span><span class="p">,</span> <span class="nx">onFirst</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">onFirst</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">onFirst</span> <span class="o">=</span> <span class="nx">startingEvent</span><span class="p">;</span>
      <span class="nx">startingEvent</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">add</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">handleObj</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">bySelector</span><span class="p">,</span> <span class="nx">selector</span> <span class="o">=</span> <span class="nx">handleObj</span><span class="p">.</span><span class="nx">selector</span> <span class="o">||</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="nx">namespace</span> <span class="o">=</span> <span class="nx">handleObj</span><span class="p">.</span><span class="nx">namespace</span> <span class="o">?</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="nx">handleObj</span><span class="p">.</span><span class="nx">namespace</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">selector</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">bySelector</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">types</span><span class="p">,</span> <span class="nx">selector</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">bySelector</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">delegate</span><span class="p">(</span><span class="nx">selector</span><span class="p">,</span> <span class="nx">startingEvent</span> <span class="o">+</span> <span class="nx">namespace</span><span class="p">,</span> <span class="nx">onFirst</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-231">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-231">&#182;</a>               </div>               <p>var bySelector = event.find(this, types, selector);</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">event</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">types</span><span class="p">,</span> <span class="nx">selector</span><span class="p">).</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">event</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">startingEvent</span> <span class="o">+</span> <span class="nx">namespace</span><span class="p">,</span> <span class="nx">onFirst</span><span class="p">,</span> <span class="p">{</span>
            <span class="nx">selector</span><span class="o">:</span> <span class="nx">selector</span><span class="p">,</span>
            <span class="nx">delegate</span><span class="o">:</span> <span class="k">this</span>
          <span class="p">});</span>
        <span class="p">}</span>

      <span class="p">}</span>

    <span class="p">},</span>
      <span class="nx">remove</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">handleObj</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">bySelector</span><span class="p">,</span> <span class="nx">selector</span> <span class="o">=</span> <span class="nx">handleObj</span><span class="p">.</span><span class="nx">selector</span> <span class="o">||</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">selector</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">bySelector</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">types</span><span class="p">,</span> <span class="nx">selector</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">bySelector</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">undelegate</span><span class="p">(</span><span class="nx">selector</span><span class="p">,</span> <span class="nx">startingEvent</span><span class="p">,</span> <span class="nx">onFirst</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">event</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">types</span><span class="p">,</span> <span class="nx">selector</span><span class="p">).</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">event</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">startingEvent</span><span class="p">,</span> <span class="nx">onFirst</span><span class="p">,</span> <span class="p">{</span>
              <span class="nx">selector</span><span class="o">:</span> <span class="nx">selector</span><span class="p">,</span>
              <span class="nx">delegate</span><span class="o">:</span> <span class="k">this</span>
            <span class="p">});</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">};</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">types</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">special</span><span class="p">[</span><span class="k">this</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">add</span><span class="o">:</span> <span class="nx">add</span><span class="p">,</span>
        <span class="nx">remove</span><span class="o">:</span> <span class="nx">remove</span><span class="p">,</span>
        <span class="nx">setup</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{},</span>
        <span class="nx">teardown</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{}</span>
      <span class="p">};</span>
    <span class="p">});</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-232">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-232">&#182;</a>               </div>               <h2>jquery/event/reverse/reverse.js</h2>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">$</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">reverse</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">attributes</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">bound</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(),</span>
      <span class="nx">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nx">dispatch</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">handle</span> <span class="o">||</span> <span class="nx">$</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">;</span>

    <span class="nx">$</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">special</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">setup</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-233">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-233">&#182;</a>               </div>               <p>add and sort the resizers array
don't add window because it can't be compared easily</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="k">this</span> <span class="o">!==</span> <span class="nb">window</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">bound</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
          <span class="nx">$</span><span class="p">.</span><span class="nx">unique</span><span class="p">(</span><span class="nx">bound</span><span class="p">);</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-234">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-234">&#182;</a>               </div>               <p>returns false if the window</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">return</span> <span class="k">this</span> <span class="o">!==</span> <span class="nb">window</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">teardown</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-235">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-235">&#182;</a>               </div>               <p>we shouldn't have to sort</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">bound</span> <span class="o">=</span> <span class="nx">bound</span><span class="p">.</span><span class="nx">not</span><span class="p">(</span><span class="k">this</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-236">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-236">&#182;</a>               </div>               <p>returns false if the window</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">return</span> <span class="k">this</span> <span class="o">!==</span> <span class="nb">window</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">add</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">handleObj</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">origHandler</span> <span class="o">=</span> <span class="nx">handleObj</span><span class="p">.</span><span class="nx">handler</span><span class="p">;</span>
        <span class="nx">handleObj</span><span class="p">.</span><span class="nx">origHandler</span> <span class="o">=</span> <span class="nx">origHandler</span><span class="p">;</span>

        <span class="nx">handleObj</span><span class="p">.</span><span class="nx">handler</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">ev</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">isWindow</span> <span class="o">=</span> <span class="k">this</span> <span class="o">===</span> <span class="nb">window</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">attributes</span> <span class="o">&amp;&amp;</span> <span class="nx">attributes</span><span class="p">.</span><span class="nx">handler</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">attributes</span><span class="p">.</span><span class="nx">handler</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">result</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>
          <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-237">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-237">&#182;</a>               </div>               <p>if this is the first handler for this event ...</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">if</span> <span class="p">(</span><span class="nx">count</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-238">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-238">&#182;</a>               </div>               <p>prevent others from doing what we are about to do</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">count</span><span class="o">++</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">where</span> <span class="o">=</span> <span class="nx">data</span> <span class="o">===</span> <span class="kc">false</span> <span class="o">?</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">target</span> <span class="o">:</span> <span class="k">this</span></pre></div>             </td>           </tr>                               <tr id="section-239">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-239">&#182;</a>               </div>               <p>trigger all this element's handlers</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">dispatch</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">where</span><span class="p">,</span> <span class="nx">ev</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">ev</span><span class="p">.</span><span class="nx">isPropagationStopped</span><span class="p">())</span> <span class="p">{</span>
              <span class="nx">count</span><span class="o">--</span><span class="p">;</span>
              <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-240">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-240">&#182;</a>               </div>               <p>get all other elements within this element that listen to move
and trigger their resize events</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="kd">var</span> <span class="nx">index</span> <span class="o">=</span> <span class="nx">bound</span><span class="p">.</span><span class="nx">index</span><span class="p">(</span><span class="k">this</span><span class="p">),</span>
              <span class="nx">length</span> <span class="o">=</span> <span class="nx">bound</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
              <span class="nx">child</span><span class="p">,</span> <span class="nx">sub</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-241">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-241">&#182;</a>               </div>               <p>if index == -1 it's the window</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">while</span> <span class="p">(</span><span class="o">++</span><span class="nx">index</span> <span class="o">&lt;</span> <span class="nx">length</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">child</span> <span class="o">=</span> <span class="nx">bound</span><span class="p">[</span><span class="nx">index</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">isWindow</span> <span class="o">||</span> <span class="nx">$</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">where</span><span class="p">,</span> <span class="nx">child</span><span class="p">)))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-242">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-242">&#182;</a>               </div>               <p>call the event</p>             </td>             <td class="code">               <div class="highlight"><pre>              <span class="nx">dispatch</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">child</span><span class="p">,</span> <span class="nx">ev</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>

              <span class="k">if</span> <span class="p">(</span><span class="nx">ev</span><span class="p">.</span><span class="nx">isPropagationStopped</span><span class="p">())</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-243">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-243">&#182;</a>               </div>               <p>move index until the item is not in the current child</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">while</span> <span class="p">(</span><span class="o">++</span><span class="nx">index</span> <span class="o">&lt;</span> <span class="nx">length</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">sub</span> <span class="o">=</span> <span class="nx">bound</span><span class="p">[</span><span class="nx">index</span><span class="p">]))</span> <span class="p">{</span>
                  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">$</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">child</span><span class="p">,</span> <span class="nx">sub</span><span class="p">))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-244">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-244">&#182;</a>               </div>               <p>set index back one</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="nx">index</span><span class="o">--</span><span class="p">;</span>
                    <span class="k">break</span>
                  <span class="p">}</span>
                <span class="p">}</span>
              <span class="p">}</span>
            <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-245">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-245">&#182;</a>               </div>               <p>prevent others from responding</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">ev</span><span class="p">.</span><span class="nx">stopImmediatePropagation</span><span class="p">();</span>
            <span class="nx">count</span><span class="o">--</span><span class="p">;</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">handleObj</span><span class="p">.</span><span class="nx">origHandler</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">ev</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-246">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-246">&#182;</a>               </div>               <p>automatically bind on these</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">$</span><span class="p">([</span><span class="nb">document</span><span class="p">,</span> <span class="nb">window</span><span class="p">]).</span><span class="nx">bind</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{});</span>

    <span class="k">return</span> <span class="nx">$</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">special</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-247">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-247">&#182;</a>               </div>               <h2>jquery/event/drag/core/core.js</h2>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">$</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">special</span><span class="p">.</span><span class="nx">move</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">reverse</span><span class="p">(</span><span class="s1">&#39;move&#39;</span><span class="p">);</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-248">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-248">&#182;</a>               </div>               <p>modify live
steal the live handler ....</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">bind</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">object</span><span class="p">,</span> <span class="nx">method</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">args2</span> <span class="o">=</span> <span class="p">[</span><span class="k">this</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span> <span class="nx">$</span><span class="p">.</span><span class="nx">makeArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">));</span>
      <span class="k">return</span> <span class="nx">method</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">object</span><span class="p">,</span> <span class="nx">args2</span><span class="p">);</span>
    <span class="p">};</span>
  <span class="p">},</span>
    <span class="nx">event</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">event</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-249">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-249">&#182;</a>               </div>               <p>function to clear the window selection if there is one</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">clearSelection</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">getSelection</span> <span class="o">?</span>
    <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">getSelection</span><span class="p">().</span><span class="nx">removeAllRanges</span><span class="p">()</span>
    <span class="p">}</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{},</span>

    <span class="nx">supportTouch</span> <span class="o">=</span> <span class="s2">&quot;ontouchend&quot;</span> <span class="k">in</span> <span class="nb">document</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-250">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-250">&#182;</a>               </div>               <p>Use touch events or map it to mouse events</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">startEvent</span> <span class="o">=</span> <span class="nx">supportTouch</span> <span class="o">?</span> <span class="s2">&quot;touchstart&quot;</span> <span class="o">:</span> <span class="s2">&quot;mousedown&quot;</span><span class="p">,</span>
    <span class="nx">stopEvent</span> <span class="o">=</span> <span class="nx">supportTouch</span> <span class="o">?</span> <span class="s2">&quot;touchend&quot;</span> <span class="o">:</span> <span class="s2">&quot;mouseup&quot;</span><span class="p">,</span>
    <span class="nx">moveEvent</span> <span class="o">=</span> <span class="nx">supportTouch</span> <span class="o">?</span> <span class="s2">&quot;touchmove&quot;</span> <span class="o">:</span> <span class="s2">&quot;mousemove&quot;</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-251">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-251">&#182;</a>               </div>               <p>On touchmove events the default (scrolling) event has to be prevented</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">preventTouchScroll</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">ev</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">ev</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
    <span class="p">};</span>


  <span class="nx">$</span><span class="p">.</span><span class="nx">Drag</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{};</span>


  <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">Drag</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">lowerName</span><span class="o">:</span> <span class="s2">&quot;drag&quot;</span><span class="p">,</span>
    <span class="nx">current</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="nx">distance</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>

    <span class="nx">mousedown</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">ev</span><span class="p">,</span> <span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">isLeftButton</span> <span class="o">=</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">button</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">button</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span>
        <span class="nx">doEvent</span> <span class="o">=</span> <span class="nx">isLeftButton</span> <span class="o">||</span> <span class="nx">supportTouch</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">doEvent</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-252">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-252">&#182;</a>               </div>               <p>create Drag</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">drag</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Drag</span><span class="p">(),</span>
        <span class="nx">delegate</span> <span class="o">=</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">delegateTarget</span> <span class="o">||</span> <span class="nx">element</span><span class="p">,</span>
        <span class="nx">selector</span> <span class="o">=</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">handleObj</span><span class="p">.</span><span class="nx">selector</span><span class="p">,</span>
        <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="nx">drag</span><span class="p">;</span>

      <span class="nx">drag</span><span class="p">.</span><span class="nx">setup</span><span class="p">({</span>
        <span class="nx">element</span><span class="o">:</span> <span class="nx">element</span><span class="p">,</span>
        <span class="nx">delegate</span><span class="o">:</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">delegateTarget</span> <span class="o">||</span> <span class="nx">element</span><span class="p">,</span>
        <span class="nx">selector</span><span class="o">:</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">handleObj</span><span class="p">.</span><span class="nx">selector</span><span class="p">,</span>
        <span class="nx">moved</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">_distance</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">distance</span><span class="p">,</span>
        <span class="nx">callbacks</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">dragdown</span><span class="o">:</span> <span class="nx">event</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">delegate</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;dragdown&quot;</span><span class="p">],</span> <span class="nx">selector</span><span class="p">),</span>
          <span class="nx">draginit</span><span class="o">:</span> <span class="nx">event</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">delegate</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;draginit&quot;</span><span class="p">],</span> <span class="nx">selector</span><span class="p">),</span>
          <span class="nx">dragover</span><span class="o">:</span> <span class="nx">event</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">delegate</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;dragover&quot;</span><span class="p">],</span> <span class="nx">selector</span><span class="p">),</span>
          <span class="nx">dragmove</span><span class="o">:</span> <span class="nx">event</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">delegate</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;dragmove&quot;</span><span class="p">],</span> <span class="nx">selector</span><span class="p">),</span>
          <span class="nx">dragout</span><span class="o">:</span> <span class="nx">event</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">delegate</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;dragout&quot;</span><span class="p">],</span> <span class="nx">selector</span><span class="p">),</span>
          <span class="nx">dragend</span><span class="o">:</span> <span class="nx">event</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">delegate</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;dragend&quot;</span><span class="p">],</span> <span class="nx">selector</span><span class="p">),</span>
          <span class="nx">dragcleanup</span><span class="o">:</span> <span class="nx">event</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">delegate</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;dragcleanup&quot;</span><span class="p">],</span> <span class="nx">selector</span><span class="p">)</span>
        <span class="p">},</span>
        <span class="nx">destroyed</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
          <span class="nx">self</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">},</span> <span class="nx">ev</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>


  <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">Drag</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">setup</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="nx">ev</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">element</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">event</span> <span class="o">=</span> <span class="nx">ev</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">moved</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">allowOtherDrags</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">mousemove</span> <span class="o">=</span> <span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">mousemove</span><span class="p">),</span>
        <span class="nx">mouseup</span> <span class="o">=</span> <span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">mouseup</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_mousemove</span> <span class="o">=</span> <span class="nx">mousemove</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_mouseup</span> <span class="o">=</span> <span class="nx">mouseup</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_distance</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">distance</span> <span class="o">?</span> <span class="nx">options</span><span class="p">.</span><span class="nx">distance</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-253">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-253">&#182;</a>               </div>               <p>where the mouse is located</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">this</span><span class="p">.</span><span class="nx">mouseStartPosition</span> <span class="o">=</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">vector</span><span class="p">();</span>

      <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="nx">moveEvent</span><span class="p">,</span> <span class="nx">mousemove</span><span class="p">);</span>
      <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="nx">stopEvent</span><span class="p">,</span> <span class="nx">mouseup</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">supportTouch</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-254">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-254">&#182;</a>               </div>               <p>On touch devices we want to disable scrolling</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="nx">moveEvent</span><span class="p">,</span> <span class="nx">preventTouchScroll</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">callEvents</span><span class="p">(</span><span class="s1">&#39;down&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">,</span> <span class="nx">ev</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">noSelection</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">delegate</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-255">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-255">&#182;</a>               </div>               <p>this is for firefox</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">clearSelection</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">},</span>



    <span class="nx">destroy</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-256">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-256">&#182;</a>               </div>               <p>Unbind the mouse handlers attached for dragging</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">unbind</span><span class="p">(</span><span class="nx">moveEvent</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_mousemove</span><span class="p">);</span>
      <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">unbind</span><span class="p">(</span><span class="nx">stopEvent</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_mouseup</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">supportTouch</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-257">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-257">&#182;</a>               </div>               <p>Enable scrolling again for touch devices when the drag is done</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">unbind</span><span class="p">(</span><span class="nx">moveEvent</span><span class="p">,</span> <span class="nx">preventTouchScroll</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">moved</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">event</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">element</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">supportTouch</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">selection</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">delegate</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">destroyed</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="nx">mousemove</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">docEl</span><span class="p">,</span> <span class="nx">ev</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">moved</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">dist</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">ev</span><span class="p">.</span><span class="nx">pageX</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">pageX</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">ev</span><span class="p">.</span><span class="nx">pageY</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">pageY</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-258">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-258">&#182;</a>               </div>               <p>Don't initialize the drag if it hasn't been moved the minimum distance</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">dist</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">_distance</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-259">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-259">&#182;</a>               </div>               <p>Otherwise call init and indicate that the drag has moved</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">,</span> <span class="nx">ev</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">moved</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;move&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">pointer</span> <span class="o">=</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">vector</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_start_position</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">_start_position</span><span class="p">.</span><span class="nx">equals</span><span class="p">(</span><span class="nx">pointer</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">draw</span><span class="p">(</span><span class="nx">pointer</span><span class="p">,</span> <span class="nx">ev</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">mouseup</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">docEl</span><span class="p">,</span> <span class="nx">event</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-260">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-260">&#182;</a>               </div>               <p>if there is a current, we should call its dragstop</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">moved</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span>
    <span class="p">},</span>


    <span class="nx">noSelection</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">elm</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">elm</span> <span class="o">=</span> <span class="nx">elm</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">delegate</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">onselectstart</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-261">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-261">&#182;</a>               </div>               <p>Disables selection</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">};</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">unselectable</span> <span class="o">=</span> <span class="s2">&quot;on&quot;</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">selectionDisabled</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">selectionDisabled</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">selectionDisabled</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">elm</span><span class="p">)</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="nx">elm</span><span class="p">));</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">selectionDisabled</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;-moz-user-select&#39;</span><span class="p">,</span> <span class="s1">&#39;-moz-none&#39;</span><span class="p">);</span>
    <span class="p">},</span>


    <span class="nx">selection</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">selectionDisabled</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">onselectstart</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{};</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">unselectable</span> <span class="o">=</span> <span class="s2">&quot;off&quot;</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">selectionDisabled</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;-moz-user-select&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">element</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-262">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-262">&#182;</a>               </div>               <p>the element that has been clicked on</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">startElement</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">movingElement</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">element</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">element</span><span class="p">)));</span></pre></div>             </td>           </tr>                               <tr id="section-263">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-263">&#182;</a>               </div>               <p>if a mousemove has come after the click
if the drag has been cancelled</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">this</span><span class="p">.</span><span class="nx">_cancelled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">event</span> <span class="o">=</span> <span class="nx">event</span><span class="p">;</span>


      <span class="k">this</span><span class="p">.</span><span class="nx">mouseElementPosition</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">mouseStartPosition</span><span class="p">.</span><span class="nx">minus</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">offsetv</span><span class="p">());</span> <span class="c1">//where the mouse is on the Element</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">callEvents</span><span class="p">(</span><span class="s1">&#39;init&#39;</span><span class="p">,</span> <span class="nx">element</span><span class="p">,</span> <span class="nx">event</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-264">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-264">&#182;</a>               </div>               <p>Check what they have set and respond accordingly if they canceled</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_cancelled</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-265">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-265">&#182;</a>               </div>               <p>if they set something else as the element</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">this</span><span class="p">.</span><span class="nx">startPosition</span> <span class="o">=</span> <span class="nx">startElement</span> <span class="o">!=</span> <span class="k">this</span><span class="p">.</span><span class="nx">movingElement</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">movingElement</span><span class="p">.</span><span class="nx">offsetv</span><span class="p">()</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentDelta</span><span class="p">();</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">makePositioned</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">movingElement</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-266">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-266">&#182;</a>               </div>               <p>Adjust the drag elements z-index to a high value</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">this</span><span class="p">.</span><span class="nx">oldZIndex</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">movingElement</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;zIndex&#39;</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">movingElement</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;zIndex&#39;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_only</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">responder</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-267">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-267">&#182;</a>               </div>               <p>calls $.Drop.prototype.compile if there is a drop element</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">responder</span><span class="p">.</span><span class="nx">compile</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">makePositioned</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">that</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">style</span><span class="p">,</span> <span class="nx">pos</span> <span class="o">=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;position&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-268">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-268">&#182;</a>               </div>               <p>Position properly, set top and left to 0px for Opera</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">pos</span> <span class="o">||</span> <span class="nx">pos</span> <span class="o">==</span> <span class="s1">&#39;static&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">style</span> <span class="o">=</span> <span class="p">{</span>
          <span class="nx">position</span><span class="o">:</span> <span class="s1">&#39;relative&#39;</span>
        <span class="p">};</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">opera</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="s1">&#39;0px&#39;</span><span class="p">;</span>
          <span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="s1">&#39;0px&#39;</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">that</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="nx">style</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">callEvents</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">element</span><span class="p">,</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">drop</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">cbs</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">callbacks</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">lowerName</span> <span class="o">+</span> <span class="nx">type</span><span class="p">];</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">cbs</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">cbs</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">call</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">event</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="nx">drop</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">cbs</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">currentDelta</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Vector</span><span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">movingElement</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">),</span> <span class="mi">10</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">parseInt</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">movingElement</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;top&#39;</span><span class="p">),</span> <span class="mi">10</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-269">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-269">&#182;</a>               </div>               <p>draws the position of the dragmove object</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">draw</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">pointer</span><span class="p">,</span> <span class="nx">event</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-270">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-270">&#182;</a>               </div>               <p>only drag if we haven't been cancelled;</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_cancelled</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">clearSelection</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-271">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-271">&#182;</a>               </div>               <p>the offset between the mouse pointer and the representative that the user asked for</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">this</span><span class="p">.</span><span class="nx">location</span> <span class="o">=</span> <span class="nx">pointer</span><span class="p">.</span><span class="nx">minus</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">mouseElementPosition</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-272">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-272">&#182;</a>               </div>               <p>call move events</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">this</span><span class="p">.</span><span class="nx">move</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_cancelled</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">event</span><span class="p">.</span><span class="nx">isDefaultPrevented</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">position</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">location</span><span class="p">);</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-273">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-273">&#182;</a>               </div>               <p>fill in</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_only</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">responder</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">responder</span><span class="p">.</span><span class="nx">show</span><span class="p">(</span><span class="nx">pointer</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="nx">event</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">position</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">newOffsetv</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//should draw it on the page</span>
      <span class="kd">var</span> <span class="nx">style</span><span class="p">,</span> <span class="nx">dragged_element_css_offset</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentDelta</span><span class="p">(),</span></pre></div>             </td>           </tr>                               <tr id="section-274">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-274">&#182;</a>               </div>               <p>the drag element's current left + top css attributes
the vector between the movingElement's page and css positions
this can be thought of as the original offset</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">dragged_element_position_vector</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">movingElement</span><span class="p">.</span><span class="nx">offsetv</span><span class="p">().</span><span class="nx">minus</span><span class="p">(</span><span class="nx">dragged_element_css_offset</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">required_css_position</span> <span class="o">=</span> <span class="nx">newOffsetv</span><span class="p">.</span><span class="nx">minus</span><span class="p">(</span><span class="nx">dragged_element_position_vector</span><span class="p">);</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">offsetv</span> <span class="o">=</span> <span class="nx">newOffsetv</span><span class="p">;</span>
      <span class="nx">style</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">movingElement</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">style</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_cancelled</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_horizontal</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">required_css_position</span><span class="p">.</span><span class="nx">top</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_cancelled</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_vertical</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">required_css_position</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">move</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">callEvents</span><span class="p">(</span><span class="s1">&#39;move&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">,</span> <span class="nx">event</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">over</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">drop</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">callEvents</span><span class="p">(</span><span class="s1">&#39;over&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">,</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">drop</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">out</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">drop</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">callEvents</span><span class="p">(</span><span class="s1">&#39;out&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">,</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">drop</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">end</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-275">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-275">&#182;</a>               </div>               <p>If canceled do nothing</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_cancelled</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-276">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-276">&#182;</a>               </div>               <p>notify the responder - usually a $.Drop instance</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_only</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">responder</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">responder</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">callEvents</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">,</span> <span class="nx">event</span><span class="p">);</span>

      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_revert</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-277">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-277">&#182;</a>               </div>               <p>animate moving back to original position</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">movingElement</span><span class="p">.</span><span class="nx">animate</span><span class="p">({</span>
          <span class="nx">top</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">startPosition</span><span class="p">.</span><span class="nx">top</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">,</span>
          <span class="nx">left</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">startPosition</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span>
        <span class="p">},</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
          <span class="nx">self</span><span class="p">.</span><span class="nx">cleanup</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
        <span class="p">});</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">cleanup</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">event</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">cleanup</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">movingElement</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span>
        <span class="nx">zIndex</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">oldZIndex</span>
      <span class="p">});</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">movingElement</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!==</span> <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">movingElement</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">[</span><span class="mi">0</span><span class="p">]).</span><span class="nx">length</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">movingElement</span><span class="p">[</span><span class="mi">0</span><span class="p">]).</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">movingElement</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span>
          <span class="nx">display</span><span class="o">:</span> <span class="s1">&#39;none&#39;</span>
        <span class="p">});</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_removeMovingElement</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-278">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-278">&#182;</a>               </div>               <p>Remove the element when using drag.ghost()</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">movingElement</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">callEvents</span><span class="p">(</span><span class="s1">&#39;cleanup&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">,</span> <span class="nx">event</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">movingElement</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">element</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">event</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">cancel</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_cancelled</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_only</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">responder</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-279">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-279">&#182;</a>               </div>               <p>clear the drops</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">responder</span><span class="p">.</span><span class="nx">clear</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">vector</span><span class="p">(),</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">event</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span>

    <span class="p">},</span>

    <span class="nx">ghost</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">parent</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-280">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-280">&#182;</a>               </div>               <p>create a ghost by cloning the source element and attach the clone to the dom after the source element</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">ghost</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">movingElement</span><span class="p">.</span><span class="nx">clone</span><span class="p">().</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;position&#39;</span><span class="p">,</span> <span class="s1">&#39;absolute&#39;</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">parent</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="nx">parent</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">ghost</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">movingElement</span><span class="p">).</span><span class="nx">after</span><span class="p">(</span><span class="nx">ghost</span><span class="p">)</span>
      <span class="p">}</span>
      <span class="nx">ghost</span><span class="p">.</span><span class="nx">width</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">movingElement</span><span class="p">.</span><span class="nx">width</span><span class="p">()).</span><span class="nx">height</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">movingElement</span><span class="p">.</span><span class="nx">height</span><span class="p">());</span></pre></div>             </td>           </tr>                               <tr id="section-281">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-281">&#182;</a>               </div>               <p>put the ghost in the right location ...</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">ghost</span><span class="p">.</span><span class="nx">offset</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">movingElement</span><span class="p">.</span><span class="nx">offset</span><span class="p">())</span></pre></div>             </td>           </tr>                               <tr id="section-282">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-282">&#182;</a>               </div>               <p>store the original element and make the ghost the dragged element</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">this</span><span class="p">.</span><span class="nx">movingElement</span> <span class="o">=</span> <span class="nx">ghost</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">noSelection</span><span class="p">(</span><span class="nx">ghost</span><span class="p">)</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_removeMovingElement</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="k">return</span> <span class="nx">ghost</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">representative</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">offsetX</span><span class="p">,</span> <span class="nx">offsetY</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_offsetX</span> <span class="o">=</span> <span class="nx">offsetX</span> <span class="o">||</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_offsetY</span> <span class="o">=</span> <span class="nx">offsetY</span> <span class="o">||</span> <span class="mi">0</span><span class="p">;</span>

      <span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">mouseStartPosition</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-283">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-283">&#182;</a>               </div>               <p>Just set the representative as the drag element</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">this</span><span class="p">.</span><span class="nx">movingElement</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">movingElement</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span>
        <span class="nx">top</span><span class="o">:</span> <span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span class="p">()</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">_offsetY</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">,</span>
        <span class="nx">left</span><span class="o">:</span> <span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span class="p">()</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">_offsetX</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">,</span>
        <span class="nx">display</span><span class="o">:</span> <span class="s1">&#39;block&#39;</span><span class="p">,</span>
        <span class="nx">position</span><span class="o">:</span> <span class="s1">&#39;absolute&#39;</span>
      <span class="p">}).</span><span class="nx">show</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">noSelection</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">movingElement</span><span class="p">)</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">mouseElementPosition</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Vector</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_offsetX</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_offsetY</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">revert</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_revert</span> <span class="o">=</span> <span class="nx">val</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">?</span> <span class="kc">true</span> <span class="o">:</span> <span class="nx">val</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">vertical</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_vertical</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">horizontal</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_horizontal</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">only</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">only</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_only</span> <span class="o">=</span> <span class="p">(</span><span class="nx">only</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">?</span> <span class="kc">true</span> <span class="o">:</span> <span class="nx">only</span><span class="p">));</span>
    <span class="p">},</span>


    <span class="nx">distance</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">val</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_distance</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_distance</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="nx">event</span><span class="p">.</span><span class="nx">setupHelper</span><span class="p">([</span>

  <span class="s1">&#39;dragdown&#39;</span><span class="p">,</span>

  <span class="s1">&#39;draginit&#39;</span><span class="p">,</span>

  <span class="s1">&#39;dragover&#39;</span><span class="p">,</span>

  <span class="s1">&#39;dragmove&#39;</span><span class="p">,</span>

  <span class="s1">&#39;dragout&#39;</span><span class="p">,</span>

  <span class="s1">&#39;dragend&#39;</span><span class="p">,</span>

  <span class="s1">&#39;dragcleanup&#39;</span><span class="p">],</span> <span class="nx">startEvent</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">Drag</span><span class="p">.</span><span class="nx">mousedown</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">Drag</span><span class="p">,</span> <span class="nx">e</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-284">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-284">&#182;</a>               </div>               <h2>jquery/event/drag/step/step.js</h2>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">round</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">m</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">x</span> <span class="o">/</span> <span class="nx">m</span><span class="p">)</span> <span class="o">*</span> <span class="nx">m</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">$</span><span class="p">.</span><span class="nx">Drag</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span>

  <span class="nx">step</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">amount</span><span class="p">,</span> <span class="nx">container</span><span class="p">,</span> <span class="nx">center</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-285">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-285">&#182;</a>               </div>               <p>on draws ... make sure this happens</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">amount</span> <span class="o">==</span> <span class="s1">&#39;number&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">amount</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">x</span><span class="o">:</span> <span class="nx">amount</span><span class="p">,</span>
        <span class="nx">y</span><span class="o">:</span> <span class="nx">amount</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">container</span> <span class="o">=</span> <span class="nx">container</span> <span class="o">||</span> <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_step</span> <span class="o">=</span> <span class="nx">amount</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">styles</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">styles</span><span class="p">(</span><span class="s2">&quot;borderTopWidth&quot;</span><span class="p">,</span> <span class="s2">&quot;paddingTop&quot;</span><span class="p">,</span> <span class="s2">&quot;borderLeftWidth&quot;</span><span class="p">,</span> <span class="s2">&quot;paddingLeft&quot;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">top</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">styles</span><span class="p">.</span><span class="nx">borderTopWidth</span><span class="p">)</span> <span class="o">+</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">styles</span><span class="p">.</span><span class="nx">paddingTop</span><span class="p">),</span>
      <span class="nx">left</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">styles</span><span class="p">.</span><span class="nx">borderLeftWidth</span><span class="p">)</span> <span class="o">+</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">styles</span><span class="p">.</span><span class="nx">paddingLeft</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">_step</span><span class="p">.</span><span class="nx">offset</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">offsetv</span><span class="p">().</span><span class="nx">plus</span><span class="p">(</span><span class="nx">left</span><span class="p">,</span> <span class="nx">top</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_step</span><span class="p">.</span><span class="nx">center</span> <span class="o">=</span> <span class="nx">center</span><span class="p">;</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">oldPosition</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Drag</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">position</span><span class="p">;</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">Drag</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">offsetPositionv</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-286">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-286">&#182;</a>               </div>               <p>adjust required<em>css</em>position accordingly</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_step</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">step</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_step</span><span class="p">,</span>
          <span class="nx">center</span> <span class="o">=</span> <span class="nx">step</span><span class="p">.</span><span class="nx">center</span> <span class="o">&amp;&amp;</span> <span class="nx">step</span><span class="p">.</span><span class="nx">center</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">(),</span>
          <span class="nx">movingSize</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">movingElement</span><span class="p">.</span><span class="nx">dimensionsv</span><span class="p">(</span><span class="s1">&#39;outer&#39;</span><span class="p">),</span>
          <span class="nx">lot</span> <span class="o">=</span> <span class="nx">step</span><span class="p">.</span><span class="nx">offset</span><span class="p">.</span><span class="nx">top</span><span class="p">()</span> <span class="o">-</span> <span class="p">(</span><span class="nx">center</span> <span class="o">&amp;&amp;</span> <span class="nx">center</span> <span class="o">!=</span> <span class="s1">&#39;x&#39;</span> <span class="o">?</span> <span class="nx">movingSize</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">:</span> <span class="mi">0</span><span class="p">),</span>
          <span class="nx">lof</span> <span class="o">=</span> <span class="nx">step</span><span class="p">.</span><span class="nx">offset</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span> <span class="o">-</span> <span class="p">(</span><span class="nx">center</span> <span class="o">&amp;&amp;</span> <span class="nx">center</span> <span class="o">!=</span> <span class="s1">&#39;y&#39;</span> <span class="o">?</span> <span class="nx">movingSize</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_step</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">offsetPositionv</span><span class="p">.</span><span class="nx">left</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">lof</span> <span class="o">+</span> <span class="nx">round</span><span class="p">(</span><span class="nx">offsetPositionv</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span> <span class="o">-</span> <span class="nx">lof</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_step</span><span class="p">.</span><span class="nx">x</span><span class="p">)))</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_step</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">offsetPositionv</span><span class="p">.</span><span class="nx">top</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">lot</span> <span class="o">+</span> <span class="nx">round</span><span class="p">(</span><span class="nx">offsetPositionv</span><span class="p">.</span><span class="nx">top</span><span class="p">()</span> <span class="o">-</span> <span class="nx">lot</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_step</span><span class="p">.</span><span class="nx">y</span><span class="p">)))</span>
        <span class="p">}</span>
      <span class="p">}</span>

      <span class="nx">oldPosition</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">offsetPositionv</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">})();</span></pre></div>             </td>           </tr>                               <tr id="section-287">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-287">&#182;</a>               </div>               <h2>jquery/event/drag/limit/limit.js</h2>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">$</span><span class="p">.</span><span class="nx">Drag</span><span class="p">.</span><span class="nx">prototype</span>

  <span class="p">.</span><span class="nx">limit</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">container</span><span class="p">,</span> <span class="nx">center</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-288">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-288">&#182;</a>               </div>               <p>on draws ... make sure this happens</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">styles</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">styles</span><span class="p">(</span><span class="s1">&#39;borderTopWidth&#39;</span><span class="p">,</span> <span class="s1">&#39;paddingTop&#39;</span><span class="p">,</span> <span class="s1">&#39;borderLeftWidth&#39;</span><span class="p">,</span> <span class="s1">&#39;paddingLeft&#39;</span><span class="p">),</span>
      <span class="nx">paddingBorder</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Vector</span><span class="p">(</span>
      <span class="nb">parseInt</span><span class="p">(</span><span class="nx">styles</span><span class="p">.</span><span class="nx">borderLeftWidth</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">styles</span><span class="p">.</span><span class="nx">paddingLeft</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">styles</span><span class="p">.</span><span class="nx">borderTopWidth</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">styles</span><span class="p">.</span><span class="nx">paddingTop</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">_limit</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">offset</span><span class="o">:</span> <span class="nx">container</span><span class="p">.</span><span class="nx">offsetv</span><span class="p">().</span><span class="nx">plus</span><span class="p">(</span><span class="nx">paddingBorder</span><span class="p">),</span>
      <span class="nx">size</span><span class="o">:</span> <span class="nx">container</span><span class="p">.</span><span class="nx">dimensionsv</span><span class="p">(),</span>
      <span class="nx">center</span><span class="o">:</span> <span class="nx">center</span> <span class="o">===</span> <span class="kc">true</span> <span class="o">?</span> <span class="s1">&#39;both&#39;</span> <span class="o">:</span> <span class="nx">center</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="kd">var</span> <span class="nx">oldPosition</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Drag</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">position</span><span class="p">;</span>
  <span class="nx">$</span><span class="p">.</span><span class="nx">Drag</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">offsetPositionv</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-289">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-289">&#182;</a>               </div>               <p>adjust required<em>css</em>position accordingly</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_limit</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">limit</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_limit</span><span class="p">,</span>
        <span class="nx">center</span> <span class="o">=</span> <span class="nx">limit</span><span class="p">.</span><span class="nx">center</span> <span class="o">&amp;&amp;</span> <span class="nx">limit</span><span class="p">.</span><span class="nx">center</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">(),</span>
        <span class="nx">movingSize</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">movingElement</span><span class="p">.</span><span class="nx">dimensionsv</span><span class="p">(</span><span class="s1">&#39;outer&#39;</span><span class="p">),</span>
        <span class="nx">halfHeight</span> <span class="o">=</span> <span class="nx">center</span> <span class="o">&amp;&amp;</span> <span class="nx">center</span> <span class="o">!=</span> <span class="s1">&#39;x&#39;</span> <span class="o">?</span> <span class="nx">movingSize</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">halfWidth</span> <span class="o">=</span> <span class="nx">center</span> <span class="o">&amp;&amp;</span> <span class="nx">center</span> <span class="o">!=</span> <span class="s1">&#39;y&#39;</span> <span class="o">?</span> <span class="nx">movingSize</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">lot</span> <span class="o">=</span> <span class="nx">limit</span><span class="p">.</span><span class="nx">offset</span><span class="p">.</span><span class="nx">top</span><span class="p">(),</span>
        <span class="nx">lof</span> <span class="o">=</span> <span class="nx">limit</span><span class="p">.</span><span class="nx">offset</span><span class="p">.</span><span class="nx">left</span><span class="p">(),</span>
        <span class="nx">height</span> <span class="o">=</span> <span class="nx">limit</span><span class="p">.</span><span class="nx">size</span><span class="p">.</span><span class="nx">height</span><span class="p">(),</span>
        <span class="nx">width</span> <span class="o">=</span> <span class="nx">limit</span><span class="p">.</span><span class="nx">size</span><span class="p">.</span><span class="nx">width</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-290">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-290">&#182;</a>               </div>               <p>check if we are out of bounds ...
above</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">offsetPositionv</span><span class="p">.</span><span class="nx">top</span><span class="p">()</span> <span class="o">+</span> <span class="nx">halfHeight</span> <span class="o">&lt;</span> <span class="nx">lot</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">offsetPositionv</span><span class="p">.</span><span class="nx">top</span><span class="p">(</span><span class="nx">lot</span> <span class="o">-</span> <span class="nx">halfHeight</span><span class="p">);</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-291">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-291">&#182;</a>               </div>               <p>below</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">offsetPositionv</span><span class="p">.</span><span class="nx">top</span><span class="p">()</span> <span class="o">+</span> <span class="nx">movingSize</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span> <span class="o">-</span> <span class="nx">halfHeight</span> <span class="o">&gt;</span> <span class="nx">lot</span> <span class="o">+</span> <span class="nx">height</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">offsetPositionv</span><span class="p">.</span><span class="nx">top</span><span class="p">(</span><span class="nx">lot</span> <span class="o">+</span> <span class="nx">height</span> <span class="o">-</span> <span class="nx">movingSize</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span> <span class="o">+</span> <span class="nx">halfHeight</span><span class="p">);</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-292">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-292">&#182;</a>               </div>               <p>left</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">offsetPositionv</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span> <span class="o">+</span> <span class="nx">halfWidth</span> <span class="o">&lt;</span> <span class="nx">lof</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">offsetPositionv</span><span class="p">.</span><span class="nx">left</span><span class="p">(</span><span class="nx">lof</span> <span class="o">-</span> <span class="nx">halfWidth</span><span class="p">);</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-293">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-293">&#182;</a>               </div>               <p>right</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">offsetPositionv</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span> <span class="o">+</span> <span class="nx">movingSize</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span> <span class="o">-</span> <span class="nx">halfWidth</span> <span class="o">&gt;</span> <span class="nx">lof</span> <span class="o">+</span> <span class="nx">width</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">offsetPositionv</span><span class="p">.</span><span class="nx">left</span><span class="p">(</span><span class="nx">lof</span> <span class="o">+</span> <span class="nx">width</span> <span class="o">-</span> <span class="nx">movingSize</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span> <span class="o">+</span> <span class="nx">halfWidth</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="nx">oldPosition</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">offsetPositionv</span><span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-294">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-294">&#182;</a>               </div>               <h2>jquery/event/drop/drop.js</h2>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">event</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">event</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">eventNames</span> <span class="o">=</span> <span class="p">[</span>

  <span class="s2">&quot;dropover&quot;</span><span class="p">,</span>

  <span class="s2">&quot;dropon&quot;</span><span class="p">,</span>

  <span class="s2">&quot;dropout&quot;</span><span class="p">,</span>

  <span class="s2">&quot;dropinit&quot;</span><span class="p">,</span>

  <span class="s2">&quot;dropmove&quot;</span><span class="p">,</span>

  <span class="s2">&quot;dropend&quot;</span><span class="p">];</span>


  <span class="nx">$</span><span class="p">.</span><span class="nx">Drop</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">callbacks</span><span class="p">,</span> <span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">callbacks</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">element</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-295">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-295">&#182;</a>               </div>               <p>add the elements ...</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">eventNames</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">special</span><span class="p">[</span><span class="k">this</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">add</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">handleObj</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-296">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-296">&#182;</a>               </div>               <p>add this element to the compiles list</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">el</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">),</span>
          <span class="nx">current</span> <span class="o">=</span> <span class="p">(</span><span class="nx">el</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;dropEventCount&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">);</span>
        <span class="nx">el</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;dropEventCount&quot;</span><span class="p">,</span> <span class="nx">current</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">current</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">$</span><span class="p">.</span><span class="nx">Drop</span><span class="p">.</span><span class="nx">addElement</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="nx">remove</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">el</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">),</span>
          <span class="nx">current</span> <span class="o">=</span> <span class="p">(</span><span class="nx">el</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;dropEventCount&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">);</span>
        <span class="nx">el</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;dropEventCount&quot;</span><span class="p">,</span> <span class="nx">current</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">current</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">$</span><span class="p">.</span><span class="nx">Drop</span><span class="p">.</span><span class="nx">removeElement</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">Drop</span><span class="p">,</span> <span class="p">{</span>

    <span class="nx">lowerName</span><span class="o">:</span> <span class="s2">&quot;drop&quot;</span><span class="p">,</span>
    <span class="nx">_rootElements</span><span class="o">:</span> <span class="p">[],</span></pre></div>             </td>           </tr>                               <tr id="section-297">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-297">&#182;</a>               </div>               <p>elements that are listening for drops</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_elements</span><span class="o">:</span> <span class="nx">$</span><span class="p">(),</span></pre></div>             </td>           </tr>                               <tr id="section-298">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-298">&#182;</a>               </div>               <p>elements that can be dropped on</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">last_active</span><span class="o">:</span> <span class="p">[],</span>
    <span class="nx">endName</span><span class="o">:</span> <span class="s2">&quot;dropon&quot;</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-299">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-299">&#182;</a>               </div>               <p>adds an element as a 'root' element
this element might have events that we need to respond to</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">addElement</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-300">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-300">&#182;</a>               </div>               <p>check other elements</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">_rootElements</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">el</span> <span class="o">==</span> <span class="k">this</span><span class="p">.</span><span class="nx">_rootElements</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_rootElements</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">removeElement</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">_rootElements</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">el</span> <span class="o">==</span> <span class="k">this</span><span class="p">.</span><span class="nx">_rootElements</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">_rootElements</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">sortByDeepestChild</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-301">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-301">&#182;</a>               </div>               <p>Use jQuery.compare to compare two elements</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">compare</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">compare</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">element</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">compare</span> <span class="o">&amp;</span> <span class="mi">16</span> <span class="o">||</span> <span class="nx">compare</span> <span class="o">&amp;</span> <span class="mi">4</span><span class="p">)</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">compare</span> <span class="o">&amp;</span> <span class="mi">8</span> <span class="o">||</span> <span class="nx">compare</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">)</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
      <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">isAffected</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">point</span><span class="p">,</span> <span class="nx">moveable</span><span class="p">,</span> <span class="nx">responder</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">((</span><span class="nx">responder</span><span class="p">.</span><span class="nx">element</span> <span class="o">!=</span> <span class="nx">moveable</span><span class="p">.</span><span class="nx">element</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">responder</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">within</span><span class="p">(</span><span class="nx">point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">responder</span><span class="p">.</span><span class="nx">_cache</span><span class="p">).</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">1</span><span class="p">));</span>
    <span class="p">},</span>

    <span class="nx">deactivate</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">responder</span><span class="p">,</span> <span class="nx">mover</span><span class="p">,</span> <span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">mover</span><span class="p">.</span><span class="nx">out</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">responder</span><span class="p">)</span>
      <span class="nx">responder</span><span class="p">.</span><span class="nx">callHandlers</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">lowerName</span> <span class="o">+</span> <span class="s1">&#39;out&#39;</span><span class="p">,</span> <span class="nx">responder</span><span class="p">.</span><span class="nx">element</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">mover</span><span class="p">)</span>
    <span class="p">},</span>

    <span class="nx">activate</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">responder</span><span class="p">,</span> <span class="nx">mover</span><span class="p">,</span> <span class="nx">event</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//this is where we should call over</span>
      <span class="nx">mover</span><span class="p">.</span><span class="nx">over</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">responder</span><span class="p">)</span>
      <span class="nx">responder</span><span class="p">.</span><span class="nx">callHandlers</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">lowerName</span> <span class="o">+</span> <span class="s1">&#39;over&#39;</span><span class="p">,</span> <span class="nx">responder</span><span class="p">.</span><span class="nx">element</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">mover</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">move</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">responder</span><span class="p">,</span> <span class="nx">mover</span><span class="p">,</span> <span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">responder</span><span class="p">.</span><span class="nx">callHandlers</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">lowerName</span> <span class="o">+</span> <span class="s1">&#39;move&#39;</span><span class="p">,</span> <span class="nx">responder</span><span class="p">.</span><span class="nx">element</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">mover</span><span class="p">)</span>
    <span class="p">},</span>

    <span class="nx">compile</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">drag</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-302">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-302">&#182;</a>               </div>               <p>if we called compile w/o a current drag</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">dragging</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">drag</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">dragging</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">dragging</span> <span class="o">=</span> <span class="nx">drag</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">last_active</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="p">}</span>
      <span class="kd">var</span> <span class="nx">el</span><span class="p">,</span> <span class="nx">drops</span><span class="p">,</span> <span class="nx">selector</span><span class="p">,</span> <span class="nx">dropResponders</span><span class="p">,</span> <span class="nx">newEls</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="nx">dragging</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">dragging</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-303">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-303">&#182;</a>               </div>               <p>go to each root element and look for drop elements</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">_rootElements</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//for each element</span>
        <span class="nx">el</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_rootElements</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-304">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-304">&#182;</a>               </div>               <p>gets something like {"": ["dropinit"], ".foo" : ["dropover","dropmove"] }</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">drops</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">findBySelector</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">eventNames</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-305">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-305">&#182;</a>               </div>               <p>get drop elements by selector</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">for</span> <span class="p">(</span><span class="nx">selector</span> <span class="k">in</span> <span class="nx">drops</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">dropResponders</span> <span class="o">=</span> <span class="nx">selector</span> <span class="o">?</span> <span class="nx">jQuery</span><span class="p">(</span><span class="nx">selector</span><span class="p">,</span> <span class="nx">el</span><span class="p">)</span> <span class="o">:</span> <span class="p">[</span><span class="nx">el</span><span class="p">];</span></pre></div>             </td>           </tr>                               <tr id="section-306">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-306">&#182;</a>               </div>               <p>for each drop element</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">e</span> <span class="o">&lt;</span> <span class="nx">dropResponders</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">e</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-307">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-307">&#182;</a>               </div>               <p>add the callbacks to the element's Data
there already might be data, so we merge it</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">addCallbacks</span><span class="p">(</span><span class="nx">dropResponders</span><span class="p">[</span><span class="nx">e</span><span class="p">],</span> <span class="nx">drops</span><span class="p">[</span><span class="nx">selector</span><span class="p">],</span> <span class="nx">dragging</span><span class="p">))</span> <span class="p">{</span>
              <span class="nx">newEls</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">dropResponders</span><span class="p">[</span><span class="nx">e</span><span class="p">])</span>
            <span class="p">};</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-308">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-308">&#182;</a>               </div>               <p>once all callbacks are added, call init on everything ...</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">this</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">newEls</span><span class="p">,</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">dragging</span><span class="p">)</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-309">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-309">&#182;</a>               </div>               <p>adds the drag callbacks object to the element or merges other callbacks ...
returns true or false if the element is new ...
onlyNew lets only new elements add themselves</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">addCallbacks</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">callbacks</span><span class="p">,</span> <span class="nx">onlyNew</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">origData</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="s2">&quot;_dropData&quot;</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">origData</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="s2">&quot;_dropData&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Drop</span><span class="p">(</span><span class="nx">callbacks</span><span class="p">,</span> <span class="nx">el</span><span class="p">));</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">onlyNew</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">origCbs</span> <span class="o">=</span> <span class="nx">origData</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-310">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-310">&#182;</a>               </div>               <p>merge data</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">eventName</span> <span class="k">in</span> <span class="nx">callbacks</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">origCbs</span><span class="p">[</span><span class="nx">eventName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">origCbs</span><span class="p">[</span><span class="nx">eventName</span><span class="p">]</span> <span class="o">?</span> <span class="nx">origCbs</span><span class="p">[</span><span class="nx">eventName</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">callbacks</span><span class="p">[</span><span class="nx">eventName</span><span class="p">])</span> <span class="o">:</span> <span class="nx">callbacks</span><span class="p">[</span><span class="nx">eventName</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-311">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-311">&#182;</a>               </div>               <p>calls init on each element's drags. 
if its cancelled it's removed
adds to the current elements ...</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">add</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">newEls</span><span class="p">,</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">drag</span><span class="p">,</span> <span class="nx">dragging</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">drop</span><span class="p">;</span>

      <span class="k">while</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">newEls</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">drop</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">newEls</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="s2">&quot;_dropData&quot;</span><span class="p">);</span>
        <span class="nx">drop</span><span class="p">.</span><span class="nx">callHandlers</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">lowerName</span> <span class="o">+</span> <span class="s1">&#39;init&#39;</span><span class="p">,</span> <span class="nx">newEls</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">drag</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">drop</span><span class="p">.</span><span class="nx">_canceled</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">newEls</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">i</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_elements</span><span class="p">.</span><span class="nx">push</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_elements</span><span class="p">,</span> <span class="nx">newEls</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="nx">show</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">point</span><span class="p">,</span> <span class="nx">moveable</span><span class="p">,</span> <span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">element</span> <span class="o">=</span> <span class="nx">moveable</span><span class="p">.</span><span class="nx">element</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_elements</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

      <span class="kd">var</span> <span class="nx">respondable</span><span class="p">,</span> <span class="nx">affected</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="nx">propagate</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">j</span><span class="p">,</span> <span class="nx">la</span><span class="p">,</span> <span class="nx">toBeActivated</span><span class="p">,</span> <span class="nx">aff</span><span class="p">,</span> <span class="nx">oldLastActive</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">last_active</span><span class="p">,</span>
        <span class="nx">responders</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
        <span class="nx">drag</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-312">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-312">&#182;</a>               </div>               <p>what's still affected ... we can also move element out here</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">while</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">_elements</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">drag</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_elements</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="s2">&quot;_dropData&quot;</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">drag</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">_elements</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
          <span class="nx">i</span><span class="o">++</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">isAffected</span><span class="p">(</span><span class="nx">point</span><span class="p">,</span> <span class="nx">moveable</span><span class="p">,</span> <span class="nx">drag</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">affected</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">drag</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-313">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-313">&#182;</a>               </div>               <p>we should only trigger on lowest children</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">affected</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sortByDeepestChild</span><span class="p">);</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">stopRespondPropagate</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">propagate</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="nx">toBeActivated</span> <span class="o">=</span> <span class="nx">affected</span><span class="p">.</span><span class="nx">slice</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-314">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-314">&#182;</a>               </div>               <p>all these will be active</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">this</span><span class="p">.</span><span class="nx">last_active</span> <span class="o">=</span> <span class="nx">affected</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-315">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-315">&#182;</a>               </div>               <p>deactivate everything in last_active that isn't active</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">oldLastActive</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">la</span> <span class="o">=</span> <span class="nx">oldLastActive</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span>
        <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">((</span><span class="nx">aff</span> <span class="o">=</span> <span class="nx">toBeActivated</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">la</span> <span class="o">==</span> <span class="nx">aff</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">toBeActivated</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">i</span><span class="o">++</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">aff</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">deactivate</span><span class="p">(</span><span class="nx">la</span><span class="p">,</span> <span class="nx">moveable</span><span class="p">,</span> <span class="nx">event</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">propagate</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">toBeActivated</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">activate</span><span class="p">(</span><span class="nx">toBeActivated</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">moveable</span><span class="p">,</span> <span class="nx">event</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">propagate</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-316">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-316">&#182;</a>               </div>               <p>activate everything in affected that isn't in last_active</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">affected</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">move</span><span class="p">(</span><span class="nx">affected</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">moveable</span><span class="p">,</span> <span class="nx">event</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">propagate</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">end</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">moveable</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">la</span><span class="p">,</span> <span class="nx">endName</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">lowerName</span> <span class="o">+</span> <span class="s1">&#39;end&#39;</span><span class="p">,</span>
        <span class="nx">onEvent</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Event</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">endName</span><span class="p">,</span> <span class="nx">event</span><span class="p">),</span>
        <span class="nx">dropData</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-317">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-317">&#182;</a>               </div>               <p>call dropon
go through the actives ... if you are over one, call dropped on it</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">last_active</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">la</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">last_active</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isAffected</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">vector</span><span class="p">(),</span> <span class="nx">moveable</span><span class="p">,</span> <span class="nx">la</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">la</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">endName</span><span class="p">])</span> <span class="p">{</span>
          <span class="nx">la</span><span class="p">.</span><span class="nx">callHandlers</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">endName</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">onEvent</span><span class="p">,</span> <span class="nx">moveable</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">onEvent</span><span class="p">.</span><span class="nx">isPropagationStopped</span><span class="p">())</span> <span class="p">{</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-318">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-318">&#182;</a>               </div>               <p>call dropend</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">r</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">_elements</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">r</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">dropData</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_elements</span><span class="p">[</span><span class="nx">r</span><span class="p">],</span> <span class="s2">&quot;_dropData&quot;</span><span class="p">);</span>
        <span class="nx">dropData</span> <span class="o">&amp;&amp;</span> <span class="nx">dropData</span><span class="p">.</span><span class="nx">callHandlers</span><span class="p">(</span><span class="nx">endName</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">moveable</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>
    <span class="p">},</span>

    <span class="nx">clear</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_elements</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-319">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-319">&#182;</a>               </div>               <p>remove temporary drop data</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">$</span><span class="p">.</span><span class="nx">removeData</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s2">&quot;_dropData&quot;</span><span class="p">)</span>
      <span class="p">})</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_elements</span> <span class="o">=</span> <span class="nx">$</span><span class="p">();</span>
      <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">dragging</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">})</span>
  <span class="nx">$</span><span class="p">.</span><span class="nx">Drag</span><span class="p">.</span><span class="nx">responder</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Drop</span><span class="p">;</span>

  <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">Drop</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="p">{</span>

    <span class="nx">callHandlers</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">method</span><span class="p">,</span> <span class="nx">el</span><span class="p">,</span> <span class="nx">ev</span><span class="p">,</span> <span class="nx">drag</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">length</span> <span class="o">=</span> <span class="k">this</span><span class="p">[</span><span class="nx">method</span><span class="p">]</span> <span class="o">?</span> <span class="k">this</span><span class="p">[</span><span class="nx">method</span><span class="p">].</span><span class="nx">length</span> <span class="o">:</span> <span class="mi">0</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">[</span><span class="nx">method</span><span class="p">][</span><span class="nx">i</span><span class="p">].</span><span class="nx">call</span><span class="p">(</span><span class="nx">el</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">ev</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="nx">drag</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">cache</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_cache</span> <span class="o">=</span> <span class="nx">value</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">value</span> <span class="o">:</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">cancel</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_canceled</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-320">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-320">&#182;</a>               </div>               <h2>jquery/event/drag/scroll/scroll.js</h2>

<p>needs drop to determine if respondable</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">$</span><span class="p">.</span><span class="nx">Drag</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span>

  <span class="nx">scrolls</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">elements</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">elements</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">elements</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">elements</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">responder</span><span class="p">.</span><span class="nx">_elements</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">elements</span><span class="p">.</span><span class="nx">eq</span><span class="p">(</span><span class="nx">i</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;_dropData&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Scrollable</span><span class="p">(</span><span class="nx">elements</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">options</span><span class="p">))[</span><span class="mi">0</span><span class="p">])</span>
    <span class="p">}</span>
  <span class="p">},</span>

  <span class="nx">$</span><span class="p">.</span><span class="nx">Scrollable</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">element</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">options</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span></pre></div>             </td>           </tr>                               <tr id="section-321">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-321">&#182;</a>               </div>               <p>when  we should start scrolling</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">distance</span><span class="o">:</span> <span class="mi">30</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-322">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-322">&#182;</a>               </div>               <p>how far we should move</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">delta</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">diff</span><span class="p">,</span> <span class="nx">distance</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="nx">distance</span> <span class="o">-</span> <span class="nx">diff</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">direction</span><span class="o">:</span> <span class="s2">&quot;xy&quot;</span>
    <span class="p">},</span> <span class="nx">options</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">direction</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">direction</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">Scrollable</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">element</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">callHandlers</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">method</span><span class="p">,</span> <span class="nx">el</span><span class="p">,</span> <span class="nx">ev</span><span class="p">,</span> <span class="nx">drag</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">[</span><span class="nx">method</span><span class="p">](</span><span class="nx">el</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">ev</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="nx">drag</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="nx">dropover</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="p">},</span>
    <span class="nx">dropon</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">clear_timeout</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="nx">dropout</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">clear_timeout</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="nx">dropinit</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="p">},</span>
    <span class="nx">dropend</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{},</span>
    <span class="nx">clear_timeout</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">interval</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">clearTimeout</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">interval</span><span class="p">)</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">interval</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">distance</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">diff</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span><span class="mi">30</span> <span class="o">-</span> <span class="nx">diff</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">dropmove</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">ev</span><span class="p">,</span> <span class="nx">drop</span><span class="p">,</span> <span class="nx">drag</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-323">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-323">&#182;</a>               </div>               <p>if we were about to call a move, clear it.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">this</span><span class="p">.</span><span class="nx">clear_timeout</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-324">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-324">&#182;</a>               </div>               <p>position of the mouse</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">mouse</span> <span class="o">=</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">vector</span><span class="p">(),</span></pre></div>             </td>           </tr>                               <tr id="section-325">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-325">&#182;</a>               </div>               <p>get the object we are going to get the boundries of</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">location_object</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">el</span> <span class="o">==</span> <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span> <span class="o">?</span> <span class="nb">window</span> <span class="o">:</span> <span class="nx">el</span><span class="p">),</span></pre></div>             </td>           </tr>                               <tr id="section-326">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-326">&#182;</a>               </div>               <p>get the dimension and location of that object</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">dimensions</span> <span class="o">=</span> <span class="nx">location_object</span><span class="p">.</span><span class="nx">dimensionsv</span><span class="p">(</span><span class="s1">&#39;outer&#39;</span><span class="p">),</span>
        <span class="nx">position</span> <span class="o">=</span> <span class="nx">location_object</span><span class="p">.</span><span class="nx">offsetv</span><span class="p">(),</span></pre></div>             </td>           </tr>                               <tr id="section-327">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-327">&#182;</a>               </div>               <p>how close our mouse is to the boundries</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">bottom</span> <span class="o">=</span> <span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="p">()</span> <span class="o">+</span> <span class="nx">dimensions</span><span class="p">.</span><span class="nx">y</span><span class="p">()</span> <span class="o">-</span> <span class="nx">mouse</span><span class="p">.</span><span class="nx">y</span><span class="p">(),</span>
        <span class="nx">top</span> <span class="o">=</span> <span class="nx">mouse</span><span class="p">.</span><span class="nx">y</span><span class="p">()</span> <span class="o">-</span> <span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="p">(),</span>
        <span class="nx">right</span> <span class="o">=</span> <span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="p">()</span> <span class="o">+</span> <span class="nx">dimensions</span><span class="p">.</span><span class="nx">x</span><span class="p">()</span> <span class="o">-</span> <span class="nx">mouse</span><span class="p">.</span><span class="nx">x</span><span class="p">(),</span>
        <span class="nx">left</span> <span class="o">=</span> <span class="nx">mouse</span><span class="p">.</span><span class="nx">x</span><span class="p">()</span> <span class="o">-</span> <span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="p">(),</span></pre></div>             </td>           </tr>                               <tr id="section-328">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-328">&#182;</a>               </div>               <p>how far we should scroll</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">dx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">dy</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">distance</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">distance</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-329">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-329">&#182;</a>               </div>               <p>check if we should scroll</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">bottom</span> <span class="o">&lt;</span> <span class="nx">distance</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">dy</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">delta</span><span class="p">(</span><span class="nx">bottom</span><span class="p">,</span> <span class="nx">distance</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">top</span> <span class="o">&lt;</span> <span class="nx">distance</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">dy</span> <span class="o">=</span> <span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">delta</span><span class="p">(</span><span class="nx">top</span><span class="p">,</span> <span class="nx">distance</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">right</span> <span class="o">&lt;</span> <span class="nx">distance</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">dx</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">delta</span><span class="p">(</span><span class="nx">right</span><span class="p">,</span> <span class="nx">distance</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">left</span> <span class="o">&lt;</span> <span class="nx">distance</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">dx</span> <span class="o">=</span> <span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">delta</span><span class="p">(</span><span class="nx">left</span><span class="p">,</span> <span class="nx">distance</span><span class="p">);</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-330">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-330">&#182;</a>               </div>               <p>if we should scroll</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">dx</span> <span class="o">||</span> <span class="nx">dy</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-331">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-331">&#182;</a>               </div>               <p>set a timeout that will create a mousemove on that object</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">interval</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
          <span class="nx">self</span><span class="p">.</span><span class="nx">move</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">el</span><span class="p">),</span> <span class="nx">drag</span><span class="p">.</span><span class="nx">movingElement</span><span class="p">,</span> <span class="nx">dx</span><span class="p">,</span> <span class="nx">dy</span><span class="p">,</span> <span class="nx">ev</span><span class="p">,</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">clientX</span><span class="p">,</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">clientY</span><span class="p">,</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">screenX</span><span class="p">,</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">screenY</span><span class="p">)</span>
        <span class="p">},</span> <span class="mi">15</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">move</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">scroll_element</span><span class="p">,</span> <span class="nx">drag_element</span><span class="p">,</span> <span class="nx">dx</span><span class="p">,</span> <span class="nx">dy</span><span class="p">,</span> <span class="nx">ev</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">scroll_element</span><span class="p">.</span><span class="nx">scrollTop</span><span class="p">(</span><span class="nx">scroll_element</span><span class="p">.</span><span class="nx">scrollTop</span><span class="p">()</span> <span class="o">+</span> <span class="nx">dy</span><span class="p">);</span>
      <span class="nx">scroll_element</span><span class="p">.</span><span class="nx">scrollLeft</span><span class="p">(</span><span class="nx">scroll_element</span><span class="p">.</span><span class="nx">scrollLeft</span><span class="p">()</span> <span class="o">+</span> <span class="nx">dx</span><span class="p">);</span>

      <span class="nx">drag_element</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span>
      <span class="nx">$</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">fix</span><span class="p">({</span>
        <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;mousemove&quot;</span><span class="p">,</span>
        <span class="nx">clientX</span><span class="o">:</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">clientX</span><span class="p">,</span>
        <span class="nx">clientY</span><span class="o">:</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">clientY</span><span class="p">,</span>
        <span class="nx">screenX</span><span class="o">:</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">screenX</span><span class="p">,</span>
        <span class="nx">screenY</span><span class="o">:</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">screenY</span><span class="p">,</span>
        <span class="nx">pageX</span><span class="o">:</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">pageX</span><span class="p">,</span>
        <span class="nx">pageY</span><span class="o">:</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">pageY</span>
      <span class="p">}))</span></pre></div>             </td>           </tr>                               <tr id="section-332">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-332">&#182;</a>               </div>               <p>drag_element.synthetic('mousemove',{clientX: x, clientY: y, screenX: sx, screenY: sy})</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">}</span>
  <span class="p">})</span></pre></div>             </td>           </tr>                               <tr id="section-333">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-333">&#182;</a>               </div>               <h2>jquery/event/drag/drag.js</h2>

<h2>jquery/event/fastfix/fastfix.js</h2>

<p>http://bitovi.com/blog/2012/04/faster-jquery-event-fix.html
https://gist.github.com/2377196
IE 8 has Object.defineProperty but it only defines DOM Nodes. According to
http://kangax.github.com/es5-compat-table/#define-property-ie-note
All browser that have Object.defineProperties also support Object.defineProperty properly</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperties</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span></pre></div>             </td>           </tr>                               <tr id="section-334">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-334">&#182;</a>               </div>               <p>Use defineProperty on an object to set the value and return it</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">set</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">prop</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">val</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">prop</span><span class="p">,</span> <span class="p">{</span>
          <span class="nx">value</span><span class="o">:</span> <span class="nx">val</span>
        <span class="p">});</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">val</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-335">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-335">&#182;</a>               </div>               <p>special converters</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">special</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">pageX</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">original</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">original</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
          <span class="p">}</span>

          <span class="kd">var</span> <span class="nx">eventDoc</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">ownerDocument</span> <span class="o">||</span> <span class="nb">document</span><span class="p">;</span>
          <span class="nx">doc</span> <span class="o">=</span> <span class="nx">eventDoc</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">;</span>
          <span class="nx">body</span> <span class="o">=</span> <span class="nx">eventDoc</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
          <span class="k">return</span> <span class="nx">original</span><span class="p">.</span><span class="nx">clientX</span> <span class="o">+</span> <span class="p">(</span><span class="nx">doc</span> <span class="o">&amp;&amp;</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">scrollLeft</span> <span class="o">||</span> <span class="nx">body</span> <span class="o">&amp;&amp;</span> <span class="nx">body</span><span class="p">.</span><span class="nx">scrollLeft</span> <span class="o">||</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nx">doc</span> <span class="o">&amp;&amp;</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">clientLeft</span> <span class="o">||</span> <span class="nx">body</span> <span class="o">&amp;&amp;</span> <span class="nx">body</span><span class="p">.</span><span class="nx">clientLeft</span> <span class="o">||</span> <span class="mi">0</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">pageY</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">original</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">original</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
          <span class="p">}</span>

          <span class="kd">var</span> <span class="nx">eventDoc</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">ownerDocument</span> <span class="o">||</span> <span class="nb">document</span><span class="p">;</span>
          <span class="nx">doc</span> <span class="o">=</span> <span class="nx">eventDoc</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">;</span>
          <span class="nx">body</span> <span class="o">=</span> <span class="nx">eventDoc</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
          <span class="k">return</span> <span class="nx">original</span><span class="p">.</span><span class="nx">clientY</span> <span class="o">+</span> <span class="p">(</span><span class="nx">doc</span> <span class="o">&amp;&amp;</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">scrollTop</span> <span class="o">||</span> <span class="nx">body</span> <span class="o">&amp;&amp;</span> <span class="nx">body</span><span class="p">.</span><span class="nx">scrollTop</span> <span class="o">||</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nx">doc</span> <span class="o">&amp;&amp;</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">clientTop</span> <span class="o">||</span> <span class="nx">body</span> <span class="o">&amp;&amp;</span> <span class="nx">body</span><span class="p">.</span><span class="nx">clientTop</span> <span class="o">||</span> <span class="mi">0</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">relatedTarget</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">original</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">original</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
          <span class="p">}</span>

          <span class="k">return</span> <span class="nx">original</span><span class="p">.</span><span class="nx">fromElement</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">target</span> <span class="o">?</span> <span class="nx">original</span><span class="p">.</span><span class="nx">toElement</span> <span class="o">:</span> <span class="nx">original</span><span class="p">.</span><span class="nx">fromElement</span><span class="p">;</span>
        <span class="p">},</span>
        <span class="nx">metaKey</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">originalEvent</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">originalEvent</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="k">return</span> <span class="nx">originalEvent</span><span class="p">.</span><span class="nx">ctrlKey</span><span class="p">;</span>
        <span class="p">},</span>
        <span class="nx">which</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">original</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">original</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
          <span class="p">}</span>

          <span class="k">return</span> <span class="nx">original</span><span class="p">.</span><span class="nx">charCode</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">original</span><span class="p">.</span><span class="nx">charCode</span> <span class="o">:</span> <span class="nx">original</span><span class="p">.</span><span class="nx">keyCode</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-336">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-336">&#182;</a>               </div>               <p>Get all properties that should be mapped</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyHooks</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">mouseHooks</span><span class="p">.</span><span class="nx">props</span><span class="p">).</span><span class="nx">concat</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">props</span><span class="p">),</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">prop</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">prop</span> <span class="o">!==</span> <span class="s2">&quot;target&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
          <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">Event</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="nx">prop</span><span class="p">,</span> <span class="p">{</span>
            <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-337">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-337">&#182;</a>               </div>               <p>get the original value, undefined when there is no original event</p>             </td>             <td class="code">               <div class="highlight"><pre>              <span class="kd">var</span> <span class="nx">originalValue</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">originalEvent</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">originalEvent</span><span class="p">[</span><span class="nx">prop</span><span class="p">];</span></pre></div>             </td>           </tr>                               <tr id="section-338">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-338">&#182;</a>               </div>               <p>overwrite getter lookup</p>             </td>             <td class="code">               <div class="highlight"><pre>              <span class="k">return</span> <span class="k">this</span><span class="p">[</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nx">prop</span><span class="p">]</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">?</span> <span class="k">this</span><span class="p">[</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nx">prop</span><span class="p">]</span> <span class="o">:</span> <span class="nx">set</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">prop</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-339">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-339">&#182;</a>               </div>               <p>if we have a special function and no value</p>             </td>             <td class="code">               <div class="highlight"><pre>              <span class="nx">special</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">originalValue</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">?</span></pre></div>             </td>           </tr>                               <tr id="section-340">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-340">&#182;</a>               </div>               <p>call the special function</p>             </td>             <td class="code">               <div class="highlight"><pre>              <span class="nx">special</span><span class="p">[</span><span class="nx">prop</span><span class="p">].</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">originalEvent</span><span class="p">)</span> <span class="o">:</span></pre></div>             </td>           </tr>                               <tr id="section-341">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-341">&#182;</a>               </div>               <p>use the original value</p>             </td>             <td class="code">               <div class="highlight"><pre>              <span class="nx">originalValue</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="nx">set</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">newValue</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-342">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-342">&#182;</a>               </div>               <p>Set the property with underscore prefix</p>             </td>             <td class="code">               <div class="highlight"><pre>              <span class="k">this</span><span class="p">[</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nx">prop</span><span class="p">]</span> <span class="o">=</span> <span class="nx">newValue</span><span class="p">;</span>
            <span class="p">}</span>
          <span class="p">});</span>
        <span class="p">})();</span>
      <span class="p">}</span>
    <span class="p">});</span>

    <span class="nx">$</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">fix</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">[</span><span class="nx">$</span><span class="p">.</span><span class="nx">expando</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">event</span><span class="p">;</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-343">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-343">&#182;</a>               </div>               <p>Create a jQuery event with at minimum a target and type set</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">originalEvent</span> <span class="o">=</span> <span class="nx">event</span><span class="p">,</span>
        <span class="nx">event</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Event</span><span class="p">(</span><span class="nx">originalEvent</span><span class="p">);</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">target</span> <span class="o">=</span> <span class="nx">originalEvent</span><span class="p">.</span><span class="nx">target</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-344">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-344">&#182;</a>               </div>               <p>Fix target property, if necessary (#1925, IE 6/7/8 &amp; Safari2)</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">target</span> <span class="o">=</span> <span class="nx">originalEvent</span><span class="p">.</span><span class="nx">srcElement</span> <span class="o">||</span> <span class="nb">document</span><span class="p">;</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-345">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-345">&#182;</a>               </div>               <p>Target should not be a text node (#504, Safari)</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">===</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">target</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="nx">event</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-346">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-346">&#182;</a>               </div>               <h2>jquery/event/hover/hover.js</h2>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">$</span><span class="p">.</span><span class="nx">Hover</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_delay</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Hover</span><span class="p">.</span><span class="nx">delay</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_distance</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Hover</span><span class="p">.</span><span class="nx">distance</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_leave</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Hover</span><span class="p">.</span><span class="nx">leave</span>
  <span class="p">};</span>

  <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">Hover</span><span class="p">,</span> <span class="p">{</span>

    <span class="nx">delay</span><span class="o">:</span> <span class="mi">100</span><span class="p">,</span>

    <span class="nx">distance</span><span class="o">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="nx">leave</span><span class="o">:</span> <span class="mi">0</span>
  <span class="p">})</span>


  <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">Hover</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="p">{</span>

    <span class="nx">delay</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">delay</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_delay</span> <span class="o">=</span> <span class="nx">delay</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">distance</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">distance</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_distance</span> <span class="o">=</span> <span class="nx">distance</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">leave</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">leave</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_leave</span> <span class="o">=</span> <span class="nx">leave</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">})</span>
  <span class="kd">var</span> <span class="nx">event</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">event</span><span class="p">,</span>
    <span class="nx">handle</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">handle</span><span class="p">,</span>
    <span class="nx">onmouseenter</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">ev</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-347">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-347">&#182;</a>               </div>               <p>now start checking mousemoves to update location</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">delegate</span> <span class="o">=</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">delegateTarget</span> <span class="o">||</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">selector</span> <span class="o">=</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">handleObj</span><span class="p">.</span><span class="nx">selector</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">pending</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">delegate</span><span class="p">,</span> <span class="s2">&quot;_hover&quot;</span> <span class="o">+</span> <span class="nx">selector</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-348">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-348">&#182;</a>               </div>               <p>prevents another mouseenter until current has run its course</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">pending</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-349">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-349">&#182;</a>               </div>               <p>Under some  circumstances, mouseleave may never fire
(e.g., the element is removed while hovered)
so if we've entered another element, wait the leave time,
then force it to release.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">pending</span><span class="p">.</span><span class="nx">forcing</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">pending</span><span class="p">.</span><span class="nx">forcing</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
          <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">pending</span><span class="p">.</span><span class="nx">leaveTimer</span><span class="p">);</span>
          <span class="kd">var</span> <span class="nx">leaveTime</span> <span class="o">=</span> <span class="nx">pending</span><span class="p">.</span><span class="nx">leaving</span> <span class="o">?</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">pending</span><span class="p">.</span><span class="nx">hover</span><span class="p">.</span><span class="nx">leave</span> <span class="o">-</span> <span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()</span> <span class="o">-</span> <span class="nx">pending</span><span class="p">.</span><span class="nx">leaving</span><span class="p">))</span> <span class="o">:</span> <span class="nx">pending</span><span class="p">.</span><span class="nx">hover</span><span class="p">.</span><span class="nx">leave</span><span class="p">;</span>
          <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

          <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">pending</span><span class="p">.</span><span class="nx">callHoverLeave</span><span class="p">();</span>
            <span class="nx">onmouseenter</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="nx">ev</span><span class="p">);</span>
          <span class="p">},</span> <span class="nx">leaveTime</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="kd">var</span> <span class="nx">loc</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">pageX</span><span class="o">:</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">pageX</span><span class="p">,</span>
        <span class="nx">pageY</span><span class="o">:</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">pageY</span>
      <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-350">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-350">&#182;</a>               </div>               <p>The current distance</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">dist</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-351">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-351">&#182;</a>               </div>               <p>Timer that checks for the distance travelled</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">timer</span><span class="p">,</span> <span class="nx">enteredEl</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-352">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-352">&#182;</a>               </div>               <p>If we are hovered</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">hovered</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-353">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-353">&#182;</a>               </div>               <p>The previous event</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">lastEv</span> <span class="o">=</span> <span class="nx">ev</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-354">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-354">&#182;</a>               </div>               <p>The $.Hover instance passed to events</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">hover</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Hover</span><span class="p">(),</span></pre></div>             </td>           </tr>                               <tr id="section-355">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-355">&#182;</a>               </div>               <p>timer if hover.leave has been called</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">leaveTimer</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-356">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-356">&#182;</a>               </div>               <p>Callback for triggering hoverleave</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">callHoverLeave</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
          <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">delegate</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;hoverleave&quot;</span><span class="p">],</span> <span class="nx">selector</span><span class="p">),</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">enteredEl</span><span class="p">,</span> <span class="nx">ev</span><span class="p">,</span> <span class="nx">hover</span><span class="p">)</span>
          <span class="p">})</span>
          <span class="nx">cleanUp</span><span class="p">();</span>
        <span class="p">},</span>
        <span class="nx">mousemove</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">ev</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">leaveTimer</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-357">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-357">&#182;</a>               </div>               <p>Update the distance and location</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">dist</span> <span class="o">+=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">ev</span><span class="p">.</span><span class="nx">pageX</span> <span class="o">-</span> <span class="nx">loc</span><span class="p">.</span><span class="nx">pageX</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">ev</span><span class="p">.</span><span class="nx">pageY</span> <span class="o">-</span> <span class="nx">loc</span><span class="p">.</span><span class="nx">pageY</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
          <span class="nx">loc</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">pageX</span><span class="o">:</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">pageX</span><span class="p">,</span>
            <span class="nx">pageY</span><span class="o">:</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">pageY</span>
          <span class="p">}</span>
          <span class="nx">lastEv</span> <span class="o">=</span> <span class="nx">ev</span>
        <span class="p">},</span>
        <span class="nx">mouseleave</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">ev</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">timer</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">hovered</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-358">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-358">&#182;</a>               </div>               <p>go right away</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="nx">hover</span><span class="p">.</span><span class="nx">_leave</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">callHoverLeave</span><span class="p">();</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
              <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">leaveTimer</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-359">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-359">&#182;</a>               </div>               <p>leave the hover after the time set in hover.leave(time)</p>             </td>             <td class="code">               <div class="highlight"><pre>              <span class="nx">pending</span><span class="p">.</span><span class="nx">leaving</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
              <span class="nx">leaveTimer</span> <span class="o">=</span> <span class="nx">pending</span><span class="p">.</span><span class="nx">leaveTimer</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="nx">callHoverLeave</span><span class="p">();</span>
              <span class="p">},</span> <span class="nx">hover</span><span class="p">.</span><span class="nx">_leave</span><span class="p">)</span>
            <span class="p">}</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">cleanUp</span><span class="p">();</span>
          <span class="p">}</span>
        <span class="p">},</span>
        <span class="nx">cleanUp</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-360">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-360">&#182;</a>               </div>               <p>Unbind all events and data</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">$</span><span class="p">(</span><span class="nx">enteredEl</span><span class="p">).</span><span class="nx">unbind</span><span class="p">(</span><span class="s2">&quot;mouseleave&quot;</span><span class="p">,</span> <span class="nx">mouseleave</span><span class="p">)</span>
          <span class="nx">$</span><span class="p">(</span><span class="nx">enteredEl</span><span class="p">).</span><span class="nx">unbind</span><span class="p">(</span><span class="s2">&quot;mousemove&quot;</span><span class="p">,</span> <span class="nx">mousemove</span><span class="p">);</span>
          <span class="nx">$</span><span class="p">.</span><span class="nx">removeData</span><span class="p">(</span><span class="nx">delegate</span><span class="p">,</span> <span class="s2">&quot;_hover&quot;</span> <span class="o">+</span> <span class="nx">selector</span><span class="p">)</span>
        <span class="p">},</span>
        <span class="nx">hoverenter</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
          <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">delegate</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;hoverenter&quot;</span><span class="p">],</span> <span class="nx">selector</span><span class="p">),</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">enteredEl</span><span class="p">,</span> <span class="nx">lastEv</span><span class="p">,</span> <span class="nx">hover</span><span class="p">)</span>
          <span class="p">})</span>
          <span class="nx">hovered</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">};</span>
      <span class="nx">pending</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">callHoverLeave</span><span class="o">:</span> <span class="nx">callHoverLeave</span><span class="p">,</span>
        <span class="nx">hover</span><span class="o">:</span> <span class="nx">hover</span>
      <span class="p">};</span>
      <span class="nx">$</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">delegate</span><span class="p">,</span> <span class="s2">&quot;_hover&quot;</span> <span class="o">+</span> <span class="nx">selector</span><span class="p">,</span> <span class="nx">pending</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-361">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-361">&#182;</a>               </div>               <p>Bind the mousemove event</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">$</span><span class="p">(</span><span class="nx">enteredEl</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;mousemove&quot;</span><span class="p">,</span> <span class="nx">mousemove</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;mouseleave&quot;</span><span class="p">,</span> <span class="nx">mouseleave</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-362">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-362">&#182;</a>               </div>               <p>call hoverinit for each element with the hover instance</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">delegate</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;hoverinit&quot;</span><span class="p">],</span> <span class="nx">selector</span><span class="p">),</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">enteredEl</span><span class="p">,</span> <span class="nx">ev</span><span class="p">,</span> <span class="nx">hover</span><span class="p">)</span>
      <span class="p">})</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">hover</span><span class="p">.</span><span class="nx">_delay</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">hoverenter</span><span class="p">();</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">timer</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-363">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-363">&#182;</a>               </div>               <p>check that we aren't moving around</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">if</span> <span class="p">(</span><span class="nx">dist</span> <span class="o">&lt;</span> <span class="nx">hover</span><span class="p">.</span><span class="nx">_distance</span> <span class="o">&amp;&amp;</span> <span class="nx">$</span><span class="p">(</span><span class="nx">enteredEl</span><span class="p">).</span><span class="nx">queue</span><span class="p">().</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">hoverenter</span><span class="p">();</span>
            <span class="k">return</span><span class="p">;</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-364">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-364">&#182;</a>               </div>               <p>Reset distance and timer</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">dist</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="nx">timer</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">callee</span><span class="p">,</span> <span class="nx">hover</span><span class="p">.</span><span class="nx">_delay</span><span class="p">)</span>
          <span class="p">}</span>
        <span class="p">},</span> <span class="nx">hover</span><span class="p">.</span><span class="nx">_delay</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-365">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-365">&#182;</a>               </div>               <p>Attach events</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">event</span><span class="p">.</span><span class="nx">setupHelper</span><span class="p">([</span>

  <span class="s2">&quot;hoverinit&quot;</span><span class="p">,</span>

  <span class="s2">&quot;hoverenter&quot;</span><span class="p">,</span>

  <span class="s2">&quot;hoverleave&quot;</span><span class="p">,</span>

  <span class="s2">&quot;hovermove&quot;</span><span class="p">],</span> <span class="s2">&quot;mouseenter&quot;</span><span class="p">,</span> <span class="nx">onmouseenter</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-366">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-366">&#182;</a>               </div>               <h2>jquery/event/key/key.js</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-367">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-367">&#182;</a>               </div>               <p>copied from jQuery 1.8.3</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">uaMatch</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">ua</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">ua</span> <span class="o">=</span> <span class="nx">ua</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">();</span>

    <span class="kd">var</span> <span class="nx">match</span> <span class="o">=</span> <span class="sr">/(chrome)[ \/]([\w.]+)/</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">ua</span><span class="p">)</span> <span class="o">||</span> <span class="sr">/(webkit)[ \/]([\w.]+)/</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">ua</span><span class="p">)</span> <span class="o">||</span> <span class="sr">/(opera)(?:.*version|)[ \/]([\w.]+)/</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">ua</span><span class="p">)</span> <span class="o">||</span> <span class="sr">/(msie) ([\w.]+)/</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">ua</span><span class="p">)</span> <span class="o">||</span> <span class="nx">ua</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;compatible&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="sr">/(mozilla)(?:.*? rv:([\w.]+)|)/</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">ua</span><span class="p">)</span> <span class="o">||</span> <span class="p">[];</span>

    <span class="k">return</span> <span class="p">{</span>
      <span class="nx">browser</span><span class="o">:</span> <span class="nx">match</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">||</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
      <span class="nx">version</span><span class="o">:</span> <span class="nx">match</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">||</span> <span class="s2">&quot;0&quot;</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">keymap</span> <span class="o">=</span> <span class="p">{},</span>
    <span class="nx">reverseKeyMap</span> <span class="o">=</span> <span class="p">{},</span>
    <span class="nx">currentBrowser</span> <span class="o">=</span> <span class="nx">uaMatch</span><span class="p">(</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">userAgent</span><span class="p">).</span><span class="nx">browser</span><span class="p">;</span>


  <span class="nx">$</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">key</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">browser</span><span class="p">,</span> <span class="nx">map</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">browser</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">keymap</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">map</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">map</span> <span class="o">=</span> <span class="nx">browser</span><span class="p">;</span>
      <span class="nx">browser</span> <span class="o">=</span> <span class="nx">currentBrowser</span><span class="p">;</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-368">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-368">&#182;</a>               </div>               <p>extend the keymap</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">keymap</span><span class="p">[</span><span class="nx">browser</span><span class="p">])</span> <span class="p">{</span>
      <span class="nx">keymap</span><span class="p">[</span><span class="nx">browser</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="p">}</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">keymap</span><span class="p">[</span><span class="nx">browser</span><span class="p">],</span> <span class="nx">map</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-369">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-369">&#182;</a>               </div>               <p>and also update the reverse keymap</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">reverseKeyMap</span><span class="p">[</span><span class="nx">browser</span><span class="p">])</span> <span class="p">{</span>
      <span class="nx">reverseKeyMap</span><span class="p">[</span><span class="nx">browser</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">name</span> <span class="k">in</span> <span class="nx">map</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">reverseKeyMap</span><span class="p">[</span><span class="nx">browser</span><span class="p">][</span><span class="nx">map</span><span class="p">[</span><span class="nx">name</span><span class="p">]]</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="nx">$</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">key</span><span class="p">({</span></pre></div>             </td>           </tr>                               <tr id="section-370">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-370">&#182;</a>               </div>               <p>backspace</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s1">&#39;\b&#39;</span><span class="o">:</span> <span class="s1">&#39;8&#39;</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-371">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-371">&#182;</a>               </div>               <p>tab</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s1">&#39;\t&#39;</span><span class="o">:</span> <span class="s1">&#39;9&#39;</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-372">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-372">&#182;</a>               </div>               <p>enter</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s1">&#39;\r&#39;</span><span class="o">:</span> <span class="s1">&#39;13&#39;</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-373">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-373">&#182;</a>               </div>               <p>special</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s1">&#39;shift&#39;</span><span class="o">:</span> <span class="s1">&#39;16&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ctrl&#39;</span><span class="o">:</span> <span class="s1">&#39;17&#39;</span><span class="p">,</span>
    <span class="s1">&#39;alt&#39;</span><span class="o">:</span> <span class="s1">&#39;18&#39;</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-374">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-374">&#182;</a>               </div>               <p>others</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s1">&#39;pause-break&#39;</span><span class="o">:</span> <span class="s1">&#39;19&#39;</span><span class="p">,</span>
    <span class="s1">&#39;caps&#39;</span><span class="o">:</span> <span class="s1">&#39;20&#39;</span><span class="p">,</span>
    <span class="s1">&#39;escape&#39;</span><span class="o">:</span> <span class="s1">&#39;27&#39;</span><span class="p">,</span>
    <span class="s1">&#39;num-lock&#39;</span><span class="o">:</span> <span class="s1">&#39;144&#39;</span><span class="p">,</span>
    <span class="s1">&#39;scroll-lock&#39;</span><span class="o">:</span> <span class="s1">&#39;145&#39;</span><span class="p">,</span>
    <span class="s1">&#39;print&#39;</span><span class="o">:</span> <span class="s1">&#39;44&#39;</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-375">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-375">&#182;</a>               </div>               <p>navigation</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s1">&#39;page-up&#39;</span><span class="o">:</span> <span class="s1">&#39;33&#39;</span><span class="p">,</span>
    <span class="s1">&#39;page-down&#39;</span><span class="o">:</span> <span class="s1">&#39;34&#39;</span><span class="p">,</span>
    <span class="s1">&#39;end&#39;</span><span class="o">:</span> <span class="s1">&#39;35&#39;</span><span class="p">,</span>
    <span class="s1">&#39;home&#39;</span><span class="o">:</span> <span class="s1">&#39;36&#39;</span><span class="p">,</span>
    <span class="s1">&#39;left&#39;</span><span class="o">:</span> <span class="s1">&#39;37&#39;</span><span class="p">,</span>
    <span class="s1">&#39;up&#39;</span><span class="o">:</span> <span class="s1">&#39;38&#39;</span><span class="p">,</span>
    <span class="s1">&#39;right&#39;</span><span class="o">:</span> <span class="s1">&#39;39&#39;</span><span class="p">,</span>
    <span class="s1">&#39;down&#39;</span><span class="o">:</span> <span class="s1">&#39;40&#39;</span><span class="p">,</span>
    <span class="s1">&#39;insert&#39;</span><span class="o">:</span> <span class="s1">&#39;45&#39;</span><span class="p">,</span>
    <span class="s1">&#39;delete&#39;</span><span class="o">:</span> <span class="s1">&#39;46&#39;</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-376">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-376">&#182;</a>               </div>               <p>normal characters</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s1">&#39; &#39;</span><span class="o">:</span> <span class="s1">&#39;32&#39;</span><span class="p">,</span>
    <span class="s1">&#39;0&#39;</span><span class="o">:</span> <span class="s1">&#39;48&#39;</span><span class="p">,</span>
    <span class="s1">&#39;1&#39;</span><span class="o">:</span> <span class="s1">&#39;49&#39;</span><span class="p">,</span>
    <span class="s1">&#39;2&#39;</span><span class="o">:</span> <span class="s1">&#39;50&#39;</span><span class="p">,</span>
    <span class="s1">&#39;3&#39;</span><span class="o">:</span> <span class="s1">&#39;51&#39;</span><span class="p">,</span>
    <span class="s1">&#39;4&#39;</span><span class="o">:</span> <span class="s1">&#39;52&#39;</span><span class="p">,</span>
    <span class="s1">&#39;5&#39;</span><span class="o">:</span> <span class="s1">&#39;53&#39;</span><span class="p">,</span>
    <span class="s1">&#39;6&#39;</span><span class="o">:</span> <span class="s1">&#39;54&#39;</span><span class="p">,</span>
    <span class="s1">&#39;7&#39;</span><span class="o">:</span> <span class="s1">&#39;55&#39;</span><span class="p">,</span>
    <span class="s1">&#39;8&#39;</span><span class="o">:</span> <span class="s1">&#39;56&#39;</span><span class="p">,</span>
    <span class="s1">&#39;9&#39;</span><span class="o">:</span> <span class="s1">&#39;57&#39;</span><span class="p">,</span>
    <span class="s1">&#39;a&#39;</span><span class="o">:</span> <span class="s1">&#39;65&#39;</span><span class="p">,</span>
    <span class="s1">&#39;b&#39;</span><span class="o">:</span> <span class="s1">&#39;66&#39;</span><span class="p">,</span>
    <span class="s1">&#39;c&#39;</span><span class="o">:</span> <span class="s1">&#39;67&#39;</span><span class="p">,</span>
    <span class="s1">&#39;d&#39;</span><span class="o">:</span> <span class="s1">&#39;68&#39;</span><span class="p">,</span>
    <span class="s1">&#39;e&#39;</span><span class="o">:</span> <span class="s1">&#39;69&#39;</span><span class="p">,</span>
    <span class="s1">&#39;f&#39;</span><span class="o">:</span> <span class="s1">&#39;70&#39;</span><span class="p">,</span>
    <span class="s1">&#39;g&#39;</span><span class="o">:</span> <span class="s1">&#39;71&#39;</span><span class="p">,</span>
    <span class="s1">&#39;h&#39;</span><span class="o">:</span> <span class="s1">&#39;72&#39;</span><span class="p">,</span>
    <span class="s1">&#39;i&#39;</span><span class="o">:</span> <span class="s1">&#39;73&#39;</span><span class="p">,</span>
    <span class="s1">&#39;j&#39;</span><span class="o">:</span> <span class="s1">&#39;74&#39;</span><span class="p">,</span>
    <span class="s1">&#39;k&#39;</span><span class="o">:</span> <span class="s1">&#39;75&#39;</span><span class="p">,</span>
    <span class="s1">&#39;l&#39;</span><span class="o">:</span> <span class="s1">&#39;76&#39;</span><span class="p">,</span>
    <span class="s1">&#39;m&#39;</span><span class="o">:</span> <span class="s1">&#39;77&#39;</span><span class="p">,</span>
    <span class="s1">&#39;n&#39;</span><span class="o">:</span> <span class="s1">&#39;78&#39;</span><span class="p">,</span>
    <span class="s1">&#39;o&#39;</span><span class="o">:</span> <span class="s1">&#39;79&#39;</span><span class="p">,</span>
    <span class="s1">&#39;p&#39;</span><span class="o">:</span> <span class="s1">&#39;80&#39;</span><span class="p">,</span>
    <span class="s1">&#39;q&#39;</span><span class="o">:</span> <span class="s1">&#39;81&#39;</span><span class="p">,</span>
    <span class="s1">&#39;r&#39;</span><span class="o">:</span> <span class="s1">&#39;82&#39;</span><span class="p">,</span>
    <span class="s1">&#39;s&#39;</span><span class="o">:</span> <span class="s1">&#39;83&#39;</span><span class="p">,</span>
    <span class="s1">&#39;t&#39;</span><span class="o">:</span> <span class="s1">&#39;84&#39;</span><span class="p">,</span>
    <span class="s1">&#39;u&#39;</span><span class="o">:</span> <span class="s1">&#39;85&#39;</span><span class="p">,</span>
    <span class="s1">&#39;v&#39;</span><span class="o">:</span> <span class="s1">&#39;86&#39;</span><span class="p">,</span>
    <span class="s1">&#39;w&#39;</span><span class="o">:</span> <span class="s1">&#39;87&#39;</span><span class="p">,</span>
    <span class="s1">&#39;x&#39;</span><span class="o">:</span> <span class="s1">&#39;88&#39;</span><span class="p">,</span>
    <span class="s1">&#39;y&#39;</span><span class="o">:</span> <span class="s1">&#39;89&#39;</span><span class="p">,</span>
    <span class="s1">&#39;z&#39;</span><span class="o">:</span> <span class="s1">&#39;90&#39;</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-377">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-377">&#182;</a>               </div>               <p>normal-characters, numpad</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s1">&#39;num0&#39;</span><span class="o">:</span> <span class="s1">&#39;96&#39;</span><span class="p">,</span>
    <span class="s1">&#39;num1&#39;</span><span class="o">:</span> <span class="s1">&#39;97&#39;</span><span class="p">,</span>
    <span class="s1">&#39;num2&#39;</span><span class="o">:</span> <span class="s1">&#39;98&#39;</span><span class="p">,</span>
    <span class="s1">&#39;num3&#39;</span><span class="o">:</span> <span class="s1">&#39;99&#39;</span><span class="p">,</span>
    <span class="s1">&#39;num4&#39;</span><span class="o">:</span> <span class="s1">&#39;100&#39;</span><span class="p">,</span>
    <span class="s1">&#39;num5&#39;</span><span class="o">:</span> <span class="s1">&#39;101&#39;</span><span class="p">,</span>
    <span class="s1">&#39;num6&#39;</span><span class="o">:</span> <span class="s1">&#39;102&#39;</span><span class="p">,</span>
    <span class="s1">&#39;num7&#39;</span><span class="o">:</span> <span class="s1">&#39;103&#39;</span><span class="p">,</span>
    <span class="s1">&#39;num8&#39;</span><span class="o">:</span> <span class="s1">&#39;104&#39;</span><span class="p">,</span>
    <span class="s1">&#39;num9&#39;</span><span class="o">:</span> <span class="s1">&#39;105&#39;</span><span class="p">,</span>
    <span class="s1">&#39;*&#39;</span><span class="o">:</span> <span class="s1">&#39;106&#39;</span><span class="p">,</span>
    <span class="s1">&#39;+&#39;</span><span class="o">:</span> <span class="s1">&#39;107&#39;</span><span class="p">,</span>
    <span class="s1">&#39;-&#39;</span><span class="o">:</span> <span class="s1">&#39;109&#39;</span><span class="p">,</span>
    <span class="s1">&#39;.&#39;</span><span class="o">:</span> <span class="s1">&#39;110&#39;</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-378">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-378">&#182;</a>               </div>               <p>normal-characters, others</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s1">&#39;/&#39;</span><span class="o">:</span> <span class="s1">&#39;111&#39;</span><span class="p">,</span>
    <span class="s1">&#39;;&#39;</span><span class="o">:</span> <span class="s1">&#39;186&#39;</span><span class="p">,</span>
    <span class="s1">&#39;=&#39;</span><span class="o">:</span> <span class="s1">&#39;187&#39;</span><span class="p">,</span>
    <span class="s1">&#39;,&#39;</span><span class="o">:</span> <span class="s1">&#39;188&#39;</span><span class="p">,</span>
    <span class="s1">&#39;-&#39;</span><span class="o">:</span> <span class="s1">&#39;189&#39;</span><span class="p">,</span>
    <span class="s1">&#39;.&#39;</span><span class="o">:</span> <span class="s1">&#39;190&#39;</span><span class="p">,</span>
    <span class="s1">&#39;/&#39;</span><span class="o">:</span> <span class="s1">&#39;191&#39;</span><span class="p">,</span>
    <span class="s1">&#39;`&#39;</span><span class="o">:</span> <span class="s1">&#39;192&#39;</span><span class="p">,</span>
    <span class="s1">&#39;[&#39;</span><span class="o">:</span> <span class="s1">&#39;219&#39;</span><span class="p">,</span>
    <span class="s1">&#39;\\&#39;</span><span class="o">:</span> <span class="s1">&#39;220&#39;</span><span class="p">,</span>
    <span class="s1">&#39;]&#39;</span><span class="o">:</span> <span class="s1">&#39;221&#39;</span><span class="p">,</span>
    <span class="s2">&quot;&#39;&quot;</span><span class="o">:</span> <span class="s1">&#39;222&#39;</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-379">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-379">&#182;</a>               </div>               <p>ignore these, you shouldn't use them</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s1">&#39;left window key&#39;</span><span class="o">:</span> <span class="s1">&#39;91&#39;</span><span class="p">,</span>
    <span class="s1">&#39;right window key&#39;</span><span class="o">:</span> <span class="s1">&#39;92&#39;</span><span class="p">,</span>
    <span class="s1">&#39;select key&#39;</span><span class="o">:</span> <span class="s1">&#39;93&#39;</span><span class="p">,</span>


    <span class="s1">&#39;f1&#39;</span><span class="o">:</span> <span class="s1">&#39;112&#39;</span><span class="p">,</span>
    <span class="s1">&#39;f2&#39;</span><span class="o">:</span> <span class="s1">&#39;113&#39;</span><span class="p">,</span>
    <span class="s1">&#39;f3&#39;</span><span class="o">:</span> <span class="s1">&#39;114&#39;</span><span class="p">,</span>
    <span class="s1">&#39;f4&#39;</span><span class="o">:</span> <span class="s1">&#39;115&#39;</span><span class="p">,</span>
    <span class="s1">&#39;f5&#39;</span><span class="o">:</span> <span class="s1">&#39;116&#39;</span><span class="p">,</span>
    <span class="s1">&#39;f6&#39;</span><span class="o">:</span> <span class="s1">&#39;117&#39;</span><span class="p">,</span>
    <span class="s1">&#39;f7&#39;</span><span class="o">:</span> <span class="s1">&#39;118&#39;</span><span class="p">,</span>
    <span class="s1">&#39;f8&#39;</span><span class="o">:</span> <span class="s1">&#39;119&#39;</span><span class="p">,</span>
    <span class="s1">&#39;f9&#39;</span><span class="o">:</span> <span class="s1">&#39;120&#39;</span><span class="p">,</span>
    <span class="s1">&#39;f10&#39;</span><span class="o">:</span> <span class="s1">&#39;121&#39;</span><span class="p">,</span>
    <span class="s1">&#39;f11&#39;</span><span class="o">:</span> <span class="s1">&#39;122&#39;</span><span class="p">,</span>
    <span class="s1">&#39;f12&#39;</span><span class="o">:</span> <span class="s1">&#39;123&#39;</span>
  <span class="p">});</span>


  <span class="nx">$</span><span class="p">.</span><span class="nx">Event</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">keyName</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">event</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
      <span class="nx">test</span> <span class="o">=</span> <span class="sr">/\w/</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-380">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-380">&#182;</a>               </div>               <p>It can be either keyCode or charCode.
Look both cases up in the reverse key map and converted to a string</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">key_Key</span> <span class="o">=</span> <span class="nx">reverseKeyMap</span><span class="p">[</span><span class="nx">currentBrowser</span><span class="p">][(</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">||</span> <span class="nx">event</span><span class="p">.</span><span class="nx">which</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
      <span class="nx">char_Key</span> <span class="o">=</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">||</span> <span class="nx">event</span><span class="p">.</span><span class="nx">which</span><span class="p">),</span>
      <span class="nx">key_Char</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">charCode</span> <span class="o">&amp;&amp;</span> <span class="nx">reverseKeyMap</span><span class="p">[</span><span class="nx">currentBrowser</span><span class="p">][</span><span class="nx">event</span><span class="p">.</span><span class="nx">charCode</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
      <span class="nx">char_Char</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">charCode</span> <span class="o">&amp;&amp;</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">charCode</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">char_Char</span> <span class="o">&amp;&amp;</span> <span class="nx">test</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">char_Char</span><span class="p">))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-381">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-381">&#182;</a>               </div>               <p>string representation of event.charCode</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">return</span> <span class="nx">char_Char</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">key_Char</span> <span class="o">&amp;&amp;</span> <span class="nx">test</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">key_Char</span><span class="p">))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-382">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-382">&#182;</a>               </div>               <p>reverseKeyMap representation of event.charCode</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">return</span> <span class="nx">char_Char</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">char_Key</span> <span class="o">&amp;&amp;</span> <span class="nx">test</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">char_Key</span><span class="p">))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-383">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-383">&#182;</a>               </div>               <p>string representation of event.keyCode</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">return</span> <span class="nx">char_Key</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">key_Key</span> <span class="o">&amp;&amp;</span> <span class="nx">test</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">key_Key</span><span class="p">))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-384">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-384">&#182;</a>               </div>               <p>reverseKeyMap representation of event.keyCode</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">return</span> <span class="nx">key_Key</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s1">&#39;keypress&#39;</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-385">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-385">&#182;</a>               </div>               <p>keypress doesn't capture everything</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">return</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">?</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span><span class="p">)</span> <span class="o">:</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">which</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">&amp;&amp;</span> <span class="nx">event</span><span class="p">.</span><span class="nx">which</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-386">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-386">&#182;</a>               </div>               <p>event.which</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">return</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">which</span><span class="p">)</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-387">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-387">&#182;</a>               </div>               <p>default</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="nx">reverseKeyMap</span><span class="p">[</span><span class="nx">currentBrowser</span><span class="p">][</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-388">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-388">&#182;</a>               </div>               <h2>jquery/event/pause/pause.js</h2>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">current</span><span class="p">,</span> <span class="nx">rnamespaces</span> <span class="o">=</span> <span class="sr">/\.(.*)$/</span><span class="p">,</span>
    <span class="nx">returnFalse</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">false</span>
    <span class="p">},</span>
    <span class="nx">returnTrue</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">true</span>
    <span class="p">};</span>

  <span class="nx">$</span><span class="p">.</span><span class="nx">Event</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">isPaused</span> <span class="o">=</span> <span class="nx">returnFalse</span>

  <span class="nx">$</span><span class="p">.</span><span class="nx">Event</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">pause</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-389">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-389">&#182;</a>               </div>               <p>stop the event from continuing temporarily
keep the current state of the event ...</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">pausedState</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">isDefaultPrevented</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">isDefaultPrevented</span><span class="p">()</span> <span class="o">?</span> <span class="nx">returnTrue</span> <span class="o">:</span> <span class="nx">returnFalse</span><span class="p">,</span>
      <span class="nx">isPropagationStopped</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">isPropagationStopped</span><span class="p">()</span> <span class="o">?</span> <span class="nx">returnTrue</span> <span class="o">:</span> <span class="nx">returnFalse</span>
    <span class="p">};</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">stopImmediatePropagation</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">isPaused</span> <span class="o">=</span> <span class="nx">returnTrue</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="nx">$</span><span class="p">.</span><span class="nx">Event</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">resume</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-390">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-390">&#182;</a>               </div>               <p>temporarily remove all event handlers of this type </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">handleObj</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">handleObj</span><span class="p">,</span>
      <span class="nx">currentTarget</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-391">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-391">&#182;</a>               </div>               <p>temporarily overwrite special handle</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">origType</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">special</span><span class="p">[</span><span class="nx">handleObj</span><span class="p">.</span><span class="nx">origType</span><span class="p">],</span>
      <span class="nx">origHandle</span> <span class="o">=</span> <span class="nx">origType</span> <span class="o">&amp;&amp;</span> <span class="nx">origType</span><span class="p">.</span><span class="nx">handle</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">origType</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">$</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">special</span><span class="p">[</span><span class="nx">handleObj</span><span class="p">.</span><span class="nx">origType</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="p">}</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">special</span><span class="p">[</span><span class="nx">handleObj</span><span class="p">.</span><span class="nx">origType</span><span class="p">].</span><span class="nx">handle</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">ev</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-392">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-392">&#182;</a>               </div>               <p>remove this once we have passed the handleObj</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">ev</span><span class="p">.</span><span class="nx">handleObj</span> <span class="o">===</span> <span class="nx">handleObj</span> <span class="o">&amp;&amp;</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">currentTarget</span> <span class="o">===</span> <span class="nx">currentTarget</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">origType</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">delete</span> <span class="nx">$</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">special</span><span class="p">[</span><span class="nx">handleObj</span><span class="p">.</span><span class="nx">origType</span><span class="p">];</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">$</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">special</span><span class="p">[</span><span class="nx">handleObj</span><span class="p">.</span><span class="nx">origType</span><span class="p">].</span><span class="nx">handle</span> <span class="o">=</span> <span class="nx">origHandle</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">pausedState</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-393">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-393">&#182;</a>               </div>               <p>reset stuff</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">isPaused</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">isImmediatePropagationStopped</span> <span class="o">=</span> <span class="nx">returnFalse</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">isPropagationStopped</span><span class="p">())</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-394">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-394">&#182;</a>               </div>               <p>fire the event again, no events will get fired until
same currentTarget / handler</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">$</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="p">[],</span> <span class="k">this</span><span class="p">.</span><span class="nx">target</span><span class="p">);</span>
    <span class="p">}</span>

  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-395">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-395">&#182;</a>               </div>               <h2>jquery/event/resize/resize.js</h2>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span></pre></div>             </td>           </tr>                               <tr id="section-396">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-396">&#182;</a>               </div>               <p>bind on the window window resizes to happen</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">win</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">),</span>
    <span class="nx">windowWidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nx">windowHeight</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nx">timer</span><span class="p">;</span>

  <span class="nx">$</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">windowWidth</span> <span class="o">=</span> <span class="nx">win</span><span class="p">.</span><span class="nx">width</span><span class="p">();</span>
    <span class="nx">windowHeight</span> <span class="o">=</span> <span class="nx">win</span><span class="p">.</span><span class="nx">height</span><span class="p">();</span>
  <span class="p">});</span>

  <span class="nx">$</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">reverse</span><span class="p">(</span><span class="s1">&#39;resize&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">handler</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">ev</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">isWindow</span> <span class="o">=</span> <span class="k">this</span> <span class="o">===</span> <span class="nb">window</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-397">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-397">&#182;</a>               </div>               <p>if we are the window and a real resize has happened
then we check if the dimensions actually changed
if they did, we will wait a brief timeout and
trigger resize on the window
this is for IE, to prevent window resize 'infinate' loop issues</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">isWindow</span> <span class="o">&amp;&amp;</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">originalEvent</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">width</span> <span class="o">=</span> <span class="nx">win</span><span class="p">.</span><span class="nx">width</span><span class="p">(),</span>
          <span class="nx">height</span> <span class="o">=</span> <span class="nx">win</span><span class="p">.</span><span class="nx">height</span><span class="p">();</span>

        <span class="k">if</span> <span class="p">((</span><span class="nx">width</span> <span class="o">!=</span> <span class="nx">windowWidth</span> <span class="o">||</span> <span class="nx">height</span> <span class="o">!=</span> <span class="nx">windowHeight</span><span class="p">))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-398">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-398">&#182;</a>               </div>               <p>update the new dimensions</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">windowWidth</span> <span class="o">=</span> <span class="nx">width</span><span class="p">;</span>
          <span class="nx">windowHeight</span> <span class="o">=</span> <span class="nx">height</span><span class="p">;</span>
          <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">timer</span><span class="p">)</span>
          <span class="nx">timer</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">win</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;resize&quot;</span><span class="p">);</span>
          <span class="p">},</span> <span class="mi">1</span><span class="p">);</span>

        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-399">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-399">&#182;</a>               </div>               <h2>jquery/event/swipe/swipe.js</h2>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">isPhantom</span> <span class="o">=</span> <span class="sr">/Phantom/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">userAgent</span><span class="p">),</span>
    <span class="nx">supportTouch</span> <span class="o">=</span> <span class="o">!</span><span class="nx">isPhantom</span> <span class="o">&amp;&amp;</span> <span class="s2">&quot;ontouchend&quot;</span> <span class="k">in</span> <span class="nb">document</span><span class="p">,</span>
    <span class="nx">scrollEvent</span> <span class="o">=</span> <span class="s2">&quot;touchmove scroll&quot;</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-400">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-400">&#182;</a>               </div>               <p>Use touch events or map it to mouse events</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">touchStartEvent</span> <span class="o">=</span> <span class="nx">supportTouch</span> <span class="o">?</span> <span class="s2">&quot;touchstart&quot;</span> <span class="o">:</span> <span class="s2">&quot;mousedown&quot;</span><span class="p">,</span>
    <span class="nx">touchStopEvent</span> <span class="o">=</span> <span class="nx">supportTouch</span> <span class="o">?</span> <span class="s2">&quot;touchend&quot;</span> <span class="o">:</span> <span class="s2">&quot;mouseup&quot;</span><span class="p">,</span>
    <span class="nx">touchMoveEvent</span> <span class="o">=</span> <span class="nx">supportTouch</span> <span class="o">?</span> <span class="s2">&quot;touchmove&quot;</span> <span class="o">:</span> <span class="s2">&quot;mousemove&quot;</span><span class="p">,</span>
    <span class="nx">data</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">originalEvent</span><span class="p">.</span><span class="nx">touches</span> <span class="o">?</span> <span class="nx">event</span><span class="p">.</span><span class="nx">originalEvent</span><span class="p">.</span><span class="nx">touches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">:</span> <span class="nx">event</span><span class="p">;</span>
      <span class="k">return</span> <span class="p">{</span>
        <span class="nx">time</span><span class="o">:</span> <span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">).</span><span class="nx">getTime</span><span class="p">(),</span>
        <span class="nx">coords</span><span class="o">:</span> <span class="p">[</span><span class="nx">d</span><span class="p">.</span><span class="nx">pageX</span><span class="p">,</span> <span class="nx">d</span><span class="p">.</span><span class="nx">pageY</span><span class="p">],</span>
        <span class="nx">origin</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">)</span>
      <span class="p">};</span>
    <span class="p">};</span>

  <span class="kd">var</span> <span class="nx">swipe</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">swipe</span> <span class="o">=</span> <span class="p">{</span>

    <span class="nx">delay</span><span class="o">:</span> <span class="mi">500</span><span class="p">,</span>

    <span class="nx">max</span><span class="o">:</span> <span class="mi">320</span><span class="p">,</span>

    <span class="nx">min</span><span class="o">:</span> <span class="mi">30</span>
  <span class="p">};</span>

  <span class="nx">$</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">setupHelper</span><span class="p">([</span>

  <span class="s2">&quot;swipe&quot;</span><span class="p">,</span>

  <span class="s1">&#39;swipeleft&#39;</span><span class="p">,</span>

  <span class="s1">&#39;swiperight&#39;</span><span class="p">,</span>

  <span class="s1">&#39;swipeup&#39;</span><span class="p">,</span>

  <span class="s1">&#39;swipedown&#39;</span><span class="p">],</span> <span class="nx">touchStartEvent</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">ev</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span></pre></div>             </td>           </tr>                               <tr id="section-401">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-401">&#182;</a>               </div>               <p>update with data when the event was started</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">start</span> <span class="o">=</span> <span class="nx">data</span><span class="p">(</span><span class="nx">ev</span><span class="p">),</span>
      <span class="nx">stop</span><span class="p">,</span> <span class="nx">delegate</span> <span class="o">=</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">delegateTarget</span> <span class="o">||</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">,</span>
      <span class="nx">selector</span> <span class="o">=</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">handleObj</span><span class="p">.</span><span class="nx">selector</span><span class="p">,</span>
      <span class="nx">entered</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">moveHandler</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">start</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-402">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-402">&#182;</a>               </div>               <p>update stop with the data from the current event</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">stop</span> <span class="o">=</span> <span class="nx">data</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-403">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-403">&#182;</a>               </div>               <p>prevent scrolling</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">start</span><span class="p">.</span><span class="nx">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="nx">stop</span><span class="p">.</span><span class="nx">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-404">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-404">&#182;</a>               </div>               <p>Attach to the touch move events</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="nx">touchMoveEvent</span><span class="p">,</span> <span class="nx">moveHandler</span><span class="p">).</span><span class="nx">one</span><span class="p">(</span><span class="nx">touchStopEvent</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">unbind</span><span class="p">(</span><span class="nx">touchMoveEvent</span><span class="p">,</span> <span class="nx">moveHandler</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-405">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-405">&#182;</a>               </div>               <p>if start and stop contain data figure out if we have a swipe event</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">start</span> <span class="o">&amp;&amp;</span> <span class="nx">stop</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-406">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-406">&#182;</a>               </div>               <p>calculate the distance between start and stop data</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">deltaX</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">start</span><span class="p">.</span><span class="nx">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="nx">stop</span><span class="p">.</span><span class="nx">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
          <span class="nx">deltaY</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">start</span><span class="p">.</span><span class="nx">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="nx">stop</span><span class="p">.</span><span class="nx">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
          <span class="nx">distance</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">deltaX</span> <span class="o">*</span> <span class="nx">deltaX</span> <span class="o">+</span> <span class="nx">deltaY</span> <span class="o">*</span> <span class="nx">deltaY</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-407">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-407">&#182;</a>               </div>               <p>check if the delay and distance are matched</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">stop</span><span class="p">.</span><span class="nx">time</span> <span class="o">-</span> <span class="nx">start</span><span class="p">.</span><span class="nx">time</span> <span class="o">&lt;</span> <span class="nx">swipe</span><span class="p">.</span><span class="nx">delay</span> <span class="o">&amp;&amp;</span> <span class="nx">distance</span> <span class="o">&gt;=</span> <span class="nx">swipe</span><span class="p">.</span><span class="nx">min</span> <span class="o">&amp;&amp;</span> <span class="nx">distance</span> <span class="o">&lt;=</span> <span class="nx">swipe</span><span class="p">.</span><span class="nx">max</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">events</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;swipe&#39;</span><span class="p">];</span></pre></div>             </td>           </tr>                               <tr id="section-408">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-408">&#182;</a>               </div>               <p>check if we moved horizontally</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">if</span> <span class="p">(</span><span class="nx">deltaX</span> <span class="o">&gt;=</span> <span class="nx">swipe</span><span class="p">.</span><span class="nx">min</span> <span class="o">&amp;&amp;</span> <span class="nx">deltaY</span> <span class="o">&lt;</span> <span class="nx">swipe</span><span class="p">.</span><span class="nx">min</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-409">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-409">&#182;</a>               </div>               <p>based on the x coordinate check if we moved left or right</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">events</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">start</span><span class="p">.</span><span class="nx">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nx">stop</span><span class="p">.</span><span class="nx">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">?</span> <span class="s2">&quot;swipeleft&quot;</span> <span class="o">:</span> <span class="s2">&quot;swiperight&quot;</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-410">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-410">&#182;</a>               </div>               <p>check if we moved vertically</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">if</span> <span class="p">(</span><span class="nx">deltaY</span> <span class="o">&gt;=</span> <span class="nx">swipe</span><span class="p">.</span><span class="nx">min</span> <span class="o">&amp;&amp;</span> <span class="nx">deltaX</span> <span class="o">&lt;</span> <span class="nx">swipe</span><span class="p">.</span><span class="nx">min</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-411">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-411">&#182;</a>               </div>               <p>based on the y coordinate check if we moved up or down</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">events</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">start</span><span class="p">.</span><span class="nx">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nx">stop</span><span class="p">.</span><span class="nx">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">?</span> <span class="s2">&quot;swipedown&quot;</span> <span class="o">:</span> <span class="s2">&quot;swipeup&quot;</span><span class="p">);</span>
          <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-412">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-412">&#182;</a>               </div>               <p>trigger swipe events on this guy</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">delegate</span><span class="p">,</span> <span class="nx">events</span><span class="p">,</span> <span class="nx">selector</span><span class="p">),</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">entered</span><span class="p">,</span> <span class="nx">ev</span><span class="p">,</span> <span class="p">{</span>
              <span class="nx">start</span><span class="o">:</span> <span class="nx">start</span><span class="p">,</span>
              <span class="nx">end</span><span class="o">:</span> <span class="nx">stop</span>
            <span class="p">})</span>
          <span class="p">})</span>

        <span class="p">}</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-413">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-413">&#182;</a>               </div>               <p>reset start and stop</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">start</span> <span class="o">=</span> <span class="nx">stop</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
    <span class="p">})</span>
  <span class="p">});</span>

<span class="p">})(</span><span class="k">this</span><span class="p">,</span> <span class="nx">jQuery</span><span class="p">);</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 